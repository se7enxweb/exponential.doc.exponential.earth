<!DOCTYPE html>
<html>

<!-- Mirrored from doc.ez.no/pages/diffpagesbyversion.action?pageId=12125301&originalVersion=5&revisedVersion=10 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 15:16:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <title>Page Comparison - Persistence cache (v.5 vs v.10) - Exponential 5.1 - eZ Documentation</title>

        

                        
    
                        
    
                        
    

    <meta http-equiv="X-UA-Compatible" content="IE=EDGE,chrome=IE7">
<meta charset="UTF-8">
<meta id="confluence-context-path" name="confluence-context-path" content="">
<meta id="confluence-base-url" name="confluence-base-url" content="../index.html">

<meta id="atlassian-token" name="atlassian-token" content="494111f00e28ced96046bfb6fbe8f75e18d44b71">

<meta id="confluence-space-key" name="confluence-space-key" content="EZP51">
<script type="text/javascript">
        var contextPath = '';
</script>

    

<!-- include system css resources -->


    <link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/f10c36425b731f08af1bde9c7e745307/_/download/contextbatch/css/pagediffs/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/f10c36425b731f08af1bde9c7e745307/_/download/contextbatch/css/pagediffs/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/0530abbfd1f6123e0fbc7e3ab0d2fc5c/_/download/contextbatch/css/atl.confluence.plugins.pagetree-desktop%2cmain/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/e6a8343e61db195b04f1598119e4df48/_/download/contextbatch/css/atl.general/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/47016f6b93087cd2003bf867318254ee/_/download/contextbatch/css/theme.doc/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/5.3.3-m6/_/download/batch/confluence.extra.jira_web-resources-adg/confluence.extra.jira_web-resources-adg.css" media="all">
<link type="text/css" rel="stylesheet" href="../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/16/_/styles/colors556c.css?spaceKey=EZP51" media="all">
<link type="text/css" rel="stylesheet" href="../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/16/_/styles/custom556c.css?spaceKey=EZP51" media="all">

<!-- end system css resources -->

    <meta name="robots" content="noindex,nofollow">
    <meta name="robots" content="noarchive">
    <meta name="confluence-request-time" content="1413903496762">
        
    
        
            <meta name="ajs-is-confluence-admin" content="false">
            <meta name="ajs-connection-timeout" content="10000">
            <meta name="ajs-use-keyboard-shortcuts" content="true">
            <meta name="ajs-keyboardshortcut-hash" content="ec556f85a7b4fc86b37ab7a78ce3d8b0">
            <meta id="team-calendars-has-jira-link" content="true">
            <meta name="ajs-team-calendars-display-time-format" content="displayTimeFormat12">
            <meta id="team-calendars-user-timezone" content="UTC">
            <script type="text/x-template" id="team-calendars-messages" title="team-calendars-messages">
    <fieldset class="i18n hidden">
                    <input type="hidden" name="calendar3.month.short.april" value="Apr">
                    <input type="hidden" name="calendar3.month.short.november" value="Nov">
                    <input type="hidden" name="calendar3.month.long.november" value="November">
                    <input type="hidden" name="calendar3.day.short.friday" value="Fri">
                    <input type="hidden" name="calendar3.month.long.february" value="February">
                    <input type="hidden" name="calendar3.month.short.february" value="Feb">
                    <input type="hidden" name="calendar3.day.long.wednesday" value="Wednesday">
                    <input type="hidden" name="calendar3.month.long.december" value="December">
                    <input type="hidden" name="calendar3.day.short.sunday" value="Sun">
                    <input type="hidden" name="calendar3.month.long.april" value="April">
                    <input type="hidden" name="calendar3.month.long.july" value="July">
                    <input type="hidden" name="calendar3.month.long.september" value="September">
                    <input type="hidden" name="calendar3.month.short.august" value="Aug">
                    <input type="hidden" name="calendar3.month.short.june" value="Jun">
                    <input type="hidden" name="calendar3.month.short.may" value="May">
                    <input type="hidden" name="calendar3.day.short.tuesday" value="Tue">
                    <input type="hidden" name="calendar3.day.short.wednesday" value="Wed">
                    <input type="hidden" name="calendar3.day.long.thursday" value="Thursday">
                    <input type="hidden" name="calendar3.month.long.march" value="March">
                    <input type="hidden" name="calendar3.month.long.october" value="October">
                    <input type="hidden" name="calendar3.day.short.saturday" value="Sat">
                    <input type="hidden" name="calendar3.month.short.january" value="Jan">
                    <input type="hidden" name="calendar3.month.long.may" value="May">
                    <input type="hidden" name="calendar3.month.long.january" value="January">
                    <input type="hidden" name="calendar3.month.short.october" value="Oct">
                    <input type="hidden" name="calendar3.day.short.thursday" value="Thu">
                    <input type="hidden" name="calendar3.day.long.friday" value="Friday">
                    <input type="hidden" name="calendar3.day.long.sunday" value="Sunday">
                    <input type="hidden" name="calendar3.month.long.june" value="June">
                    <input type="hidden" name="calendar3.month.long.august" value="August">
                    <input type="hidden" name="calendar3.day.long.tuesday" value="Tuesday">
                    <input type="hidden" name="calendar3.day.long.saturday" value="Saturday">
                    <input type="hidden" name="calendar3.month.short.september" value="Sep">
                    <input type="hidden" name="calendar3.day.long.monday" value="Monday">
                    <input type="hidden" name="calendar3.month.short.july" value="Jul">
                    <input type="hidden" name="calendar3.month.short.march" value="Mar">
                    <input type="hidden" name="calendar3.day.short.monday" value="Mon">
                    <input type="hidden" name="calendar3.month.short.december" value="Dec">
            </fieldset>
</script>

            

    
            
    
    
            <meta name="ajs-page-id" content="12125301">
            <meta name="ajs-content-type" content="page">
            <meta name="ajs-page-title" content="Persistence cache">
            <meta name="ajs-parent-page-title" content="Cache">
            <meta name="ajs-parent-page-id" content="12125298">
            <meta name="ajs-space-key" content="EZP51">
            <meta name="ajs-space-name" content="Exponential 5.1">
            <meta name="ajs-from-page-title" content="">
            <meta name="ajs-can-remove-page" content="false">
            <meta name="ajs-context-path" content="">
            <meta name="ajs-base-url" content="https://doc.ez.no">
            <meta name="ajs-version-number" content="5.4.4">
            <meta name="ajs-build-number" content="4733">
            <meta name="ajs-remote-user" content="">
            <meta name="ajs-current-user-fullname" content="">
            <meta name="ajs-current-user-avatar-url" content="">
            <meta name="ajs-static-resource-url-prefix" content="/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_">
            <meta name="ajs-global-settings-attachment-max-size" content="10485760">
            <meta name="ajs-user-locale" content="en_GB">
            <meta name="ajs-enabled-dark-features" content="sync.event">
            <meta name="ajs-atl-token" content="494111f00e28ced96046bfb6fbe8f75e18d44b71">
            <meta name="ajs-confluence-flavour" content="VANILLA">
            <meta name="ajs-editor.loader.resources" content="&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=https://doc.ez.no/pages/"/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/ff74d20045a1ee5a81efff6a44eea98b/_/download/contextbatch/css/editor,macro-browser,fullpage-editor,-atl.general/batch.css" media=&quot;all&quot;&gt;
&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=https://doc.ez.no/pages/"/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/ff74d20045a1ee5a81efff6a44eea98b/_/download/contextbatch/css/editor,macro-browser,fullpage-editor,-atl.general/batch.css?media=%28max-width%3A+1450px%29%22 media=&quot;(max-width: 1450px)&quot;&gt;
&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=https://doc.ez.no/pages/"/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/ff74d20045a1ee5a81efff6a44eea98b/_/download/contextbatch/css/editor,macro-browser,fullpage-editor,-atl.general/batch.css?media=print%22 media=&quot;print&quot;&gt;
&lt;!--[if lt IE 9]&gt;
&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=https://doc.ez.no/pages/"/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/ff74d20045a1ee5a81efff6a44eea98b/_/download/contextbatch/css/editor,macro-browser,fullpage-editor,-atl.general/batch.css?conditionalComment=lt+IE+9%22 media=&quot;all&quot;&gt;
&lt;![endif]--&gt;
&lt;!--[if IE]&gt;
&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=https://doc.ez.no/pages/"/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/ff74d20045a1ee5a81efff6a44eea98b/_/download/contextbatch/css/editor,macro-browser,fullpage-editor,-atl.general/batch.css?ieonly=true%22 media=&quot;all&quot;&gt;
&lt;![endif]--&gt;
&lt;script type=&quot;text/javascript&quot; src=https://doc.ez.no/pages/"/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/ff74d20045a1ee5a81efff6a44eea98b/_/download/contextbatch/js/editor,macro-browser,fullpage-editor,-atl.general/batch.js" &gt;&lt;/script&gt;
">
            <meta name="ajs-date.format" content="MMM dd, yyyy">
    
    <link rel="shortcut icon" href="https://doc.ez.no/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://doc.ez.no/favicon.ico">

<link rel="search" type="application/opensearchdescription+xml" href="https://doc.ez.no/opensearch/osd.action" title="eZ Documentation"/>

    <!-- include system javascript resources -->
    <script type="text/javascript" src="https://doc.ez.no/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/js/batch.js" ></script>
<!--[if lte IE 8]>
<script type="text/javascript" src="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/js/batch.js?conditionalComment=lte+IE+8" ></script>
<![endif]-->
<script type="text/javascript" src="https://doc.ez.no/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/f10c36425b731f08af1bde9c7e745307/_/download/contextbatch/js/pagediffs/batch.js" ></script>
<script type="text/javascript" src="https://doc.ez.no/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/0530abbfd1f6123e0fbc7e3ab0d2fc5c/_/download/contextbatch/js/atl.confluence.plugins.pagetree-desktop,main/batch.js" ></script>
<script type="text/javascript" src="https://doc.ez.no/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/js/page/batch.js" ></script>
<script type="text/javascript" src="https://doc.ez.no/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/e6a8343e61db195b04f1598119e4df48/_/download/contextbatch/js/atl.general/batch.js" ></script>
<script type="text/javascript" src="https://doc.ez.no/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.js" ></script>
<script type="text/javascript" src="https://doc.ez.no/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.mywork.mywork-confluence-host-plugin:mw-header-anchor/com.atlassian.mywork.mywork-confluence-host-plugin:mw-header-anchor.js" ></script>

    

        
    <!-- end system javascript resources -->

        
        

    
                <link rel="canonical" href="https://doc.ez.no/display/EZP51/Persistence+cache">
        <link rel="shortlink" href="https://doc.ez.no/x/dQS5">
    <meta name="wikilink" content="[EZP51:Persistence cache]">
    <meta name="page-version" content="10">

</head>

<body             onload="placeFocus()"
     id="com-atlassian-confluence" class="theme-documentation  aui-theme-default aui-layout">

        
    <div id="full-height-container">
    <div id="header-precursor">
        
                    </div>






<header id="header" role="banner">
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation"><div class="aui-header-inner"><div class="aui-header-before"><a class="aui-dropdown2-trigger app-switcher-trigger" aria-owns="app-switcher" aria-haspopup="true" tabindex="0"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a><div id="app-switcher" class="aui-dropdown2 aui-style-default"><div class="app-switcher-loading">Loading&hellip;</div></div><script>
            (function (NL) {
                var initialise = function () {
                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.
                    window.atlassian = window.atlassian || window.aui;
                    new NL.AppSwitcher({
                        dropdownContents: '#app-switcher'
                    });
                };
                if (NL.AppSwitcher) {
                    initialise();
                } else {
                    NL.onInit = initialise;
                }
            }(window.NL = (window.NL || {})));
            window.NL.isUserAdmin = false</script></div><div class="aui-header-primary"><h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://doc.ez.no/"><img src="https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/logo/confluence-logo.png" alt="eZ Documentation" /></a></h1><ul class="aui-nav">
                            <li>
            
        
        
<a  id="space-directory-link" href="https://doc.ez.no/spacedirectory/view.action"  class=" aui-nav-imagelink"   title="Spaces">
            <span>Spaces</span>
    </a>
        </li>
                            <li id="browseMenu" role="menu">
            
    
        <a id="browse-menu-link" class="aui-nav-link aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-owns="browse-menu-link-content" title="Browse">
        <span class="browse">Browse</span>
    </a>
    <nav id="browse-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                    <div class="aui-dropdown2-section">
                <ul  id="browse-menu-link-leading" class="aui-list-truncate section-leading first">
                                            <li>
    
            
<a  id="space-pages-link" href="https://doc.ez.no/pages/listpages.action?key=EZP51" class="    "      title="Browse pages in the Exponential 5.1 space" >
        Pages
</a>
</li>
                                            <li>
    
            
<a  id="space-blogposts-link" href="https://doc.ez.no/pages/viewrecentblogposts.action?key=EZP51" class="    "      title="Browse blogs in the Exponential 5.1 space" >
        Blog
</a>
</li>
                                            <li>
    
            
<a  id="space-labels-link" href="https://doc.ez.no/labels/listlabels-heatmap.action?key=EZP51" class="    "      title="Browse labels in the Exponential 5.1 space" >
        Labels
</a>
</li>
                                            <li>
    
            
<a  id="space-advanced-link" href="https://doc.ez.no/spaces/viewspacesummary.action?key=EZP51" class="    "      title="Browse additional space functions in the Exponential 5.1 space" >
        Space Operations
</a>
</li>
                                    </ul>
            </div>
            </nav>
    
        </li>
        </ul>
</div><div class="aui-header-secondary"><ul class="aui-nav">
                <li>
<form id="quick-search" class="aui-quicksearch dont-default-focus header-quicksearch" action="https://doc.ez.no/dosearchsite.action" method="get">
    <fieldset>
                    <input type='hidden' name='where' value='EZP51'/>
                            <input type="hidden" name="spaceSearch" value="true"/>
                <label for="quick-search-query" class="assistive">Quick Search</label>
        <input id="quick-search-query" class="text app-search search quick-search-query" type="text"
               accessKey="q" autocomplete="off" name="queryString" title="Quick Search"  placeholder="Search space" />
        <input id="quick-search-submit" class="quick-search-submit" type="submit" value="Search"/>

        <div class="aui-dd-parent quick-nav-drop-down"></div>
    </fieldset>
    <div class="hidden parameters">
                    <!-- putMetadata failed to add value for key "quick-nav-enabled" so rendering metadata inline - see server debug log for details -->
        <meta name="ajs-quick-nav-enabled" content="true">
                </div>
</form>
</li>
    <li>    
        <a id="help-menu-link" class="aui-nav-link aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-owns="help-menu-link-content" title="Help">
        <span class="aui-icon aui-icon-small aui-iconfont-help">Help</span>
    </a>
    <nav id="help-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                    <div class="aui-dropdown2-section">
                <ul  id="help-menu-link-leading" class="aui-list-truncate section-leading first">
                                            <li>
    
            
<a  id="confluence-help-link" href="http://docs.atlassian.com/confluence/docs-54/Getting+Help+And+Support" class="    "      title="Visit the Confluence documentation home"  target="_blank"
>
        Online Help
</a>
</li>
                                            <li>
    
                
<a  id="keyboard-shortcuts-link" href="#" class="    "      title="View available keyboard shortcuts" >
        Keyboard Shortcuts
</a>
</li>
                                            <li>
    
            
<a  id="feed-builder-link" href="https://doc.ez.no/dashboard/configurerssfeed.action" class="    "      title="Create your custom RSS feed." >
        Feed Builder
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="http://docs.atlassian.com/confluence/docs-54/whatsnew/iframe" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
                
<a  id="gadget-directory-link" href="#" class="   user-item administration-link "      title="Browse gadgets provided by Confluence" >
        Available Gadgets
</a>
</li>
                                            <li>
    
            
<a  id="confluence-about-link" href="https://doc.ez.no/aboutconfluencepage.action" class="    "      title="Get more information about Confluence" >
        About Confluence
</a>
</li>
                                    </ul>
            </div>
            </nav>
    </li>
    <li>    
    </li>
                <li>                                    <li>
    
            
<a  id="login-link" href="https://doc.ez.no/login.action?os_destination=%2Fpages%2Fdiffpagesbyversion.action%3FpageId%3D12125301%26originalVersion%3D5%26revisedVersion%3D10" class="   user-item login-link "      title="" >
        Log in
</a>
</li>
                        </li>
</ul>
</div></div><!-- .aui-header-inner--></nav><!-- .aui-header -->
    <br class="clear">
</header>

    <div id="splitter">
    <div id="splitter-sidebar"  class="padding-div" >
        
        <p>&nbsp;<br/>
<strong>Navigation</strong><br/>
&bull; <a href="https://confluence.ez.no/display/MAIN" class="external-link" rel="nofollow">Exponential Platform Documentation</a><br/>
&nbsp;</p>
    

                    
    


<div class="plugin_pagetree">

        
        
    <ul class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
        <div class="plugin_pagetree_children">
        </div>
    </ul>

    <fieldset class="hidden">
        <input type="hidden" name="treeId" value="">
        <input type="hidden" name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false&amp;expandCurrent=false">
        <input type="hidden" name="treePageId" value="12125301">

        <input type="hidden" name="noRoot" value="false">
        <input type="hidden" name="rootPageId" value="12125259">

        <input type="hidden" name="rootPage" value="">
        <input type="hidden" name="startDepth" value="0">
        <input type="hidden" name="spaceKey" value="EZP51" >

        <input type="hidden" name="i18n-pagetree.loading" value="Loading...">
        <input type="hidden" name="i18n-pagetree.error.permission" value="Unable to load page tree. It seems that you do not have permission to view the root page.">
        <input type="hidden" name="i18n-pagetree.eeror.general" value="There was a problem retrieving the page tree. Please check the server log file for more information.">
        <input type="hidden" name="loginUrl" value="/login.action?os_destination=%2Fpages%2Fdiffpagesbyversion.action%3FpageId%3D12125301%26originalVersion%3D5%26revisedVersion%3D10">
        <input type="hidden" name="mobile" value="false">

                <fieldset class="hidden">
                                                <input type="hidden" name="ancestorId" value="12125298">
                                    <input type="hidden" name="ancestorId" value="12125297">
                                    <input type="hidden" name="ancestorId" value="12125296">
                                    <input type="hidden" name="ancestorId" value="12125294">
                                    <input type="hidden" name="ancestorId" value="12125259">
                                    </fieldset>
    </fieldset>
</div>



            </div>
    <div id="splitter-content">

                    <script type="text/javascript" src="https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/5.4.4/_/download/resources/com.atlassian.confluence.plugins.doctheme:resources/doc-theme.js"></script>
    
                        
        <div id="theme-header">
            <div class="sectionColumnWrapper"><div class="sectionMacro">
<div class="sectionMacroRow"><div class="columnMacro" style="width:1%;min-width:1%;max-width:1%;"></div>
<div class="columnMacro"><div class="panel" style="background-color: whitesmoke;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: whitesmoke;">
<p>This is the documentation for <strong>Exponential Platform 5.1</strong>. It is scheduled to be moved into the <a href="https://doc.ez.no/display/EZP">5.x documentation</a>, so please go there for most up-to-date documentation.</p>
</div></div></div>
<div class="columnMacro" style="width:1%;min-width:1%;max-width:1%;"></div></div></div></div>
        </div>
    
            
<div id="main"  class="aui-page-panel" >
    <div id="main-header">
        
        
    <div id="navigation" class="content-navigation view-information">
                    <ul class="ajs-menu-bar">
                            <li class="ajs-button normal">

    
        
                            
    
    
    <a  id="viewPageLink" href="https://doc.ez.no/display/EZP51/Persistence+cache" rel="nofollow"  class="view"   title="">
                <span>View Page</span>    </a>
</li>
                        
                    
        <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action ajs-menu-title aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-owns="action-menu" data-container="#navigation"><span><span>Tools</span></span></a>         <div id="action-menu" class="aui-dropdown2 aui-style-default">
                            <ul  id="action-menu-primary"                     class="section-primary first aui-dropdown2-section">
                                            <li>

    
        
                            
    
    
    <a  id="view-attachments-link" href="https://doc.ez.no/pages/viewpageattachments.action?pageId=12125301" rel="nofollow"  class="action-view-attachments"  accessKey="t"  title="View Attachments">
                <span>A<u>t</u>tachments (0)</span>    </a>
</li>
                                        <li>

    
        
                            
    
    
    <a  id="action-view-history-link" href="https://doc.ez.no/pages/viewpreviousversions.action?pageId=12125301" rel="nofollow"  class="action-view-history"   title="">
                <span>Page History</span>    </a>
</li>
                                        <li>

    
        
                            
    
    
    <a  id="action-page-permissions-link" href="https://doc.ez.no/pages/viewinfo.action?pageId=12125301" rel="nofollow"  class="action-page-permissions"   title="Edit restrictions">
                <span>Restrictions</span>    </a>
</li>
                                </ul>
                            <ul  id="action-menu-secondary"                     class="section-secondary aui-dropdown2-section">
                                            <li>

    
        
                            
    
    
    <a  id="view-page-info-link" href="https://doc.ez.no/pages/viewinfo.action?pageId=12125301" rel="nofollow"  class="action-view-info"   title="">
                <span>Page Information</span>    </a>
</li>
                                        <li>

    
        
                            
    
    
    <a  id="link-to-page-link" href="https://doc.ez.no/pages/viewinfo.action?pageId=12125301" rel="nofollow"  class=""   title="Link to this Page">
                <span>Link to this Page…</span>    </a>
</li>
                                        <li>

    
        
                            
    
    
    <a  id="view-in-hierarchy-link" href="https://doc.ez.no/pages/listpages-dirview.action?key=EZP51&amp;openId=12125301#selectedPageInHierarchy" rel="nofollow"  class=""   title="">
                <span>View in Hierarchy</span>    </a>
</li>
                                        <li>

    
        
                            
    
    
    <a  id="action-view-source-link" href="https://doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12125301" rel="nofollow"  class="action-view-source popup-link"   title="">
                <span>View Source</span>    </a>
</li>
                                        <li>

    
        
                            
    
    
    <a  id="action-export-pdf-link" href="https://doc.ez.no/spaces/flyingpdf/pdfpageexport.action?pageId=12125301" rel="nofollow"  class=""   title="">
                <span>Export to PDF</span>    </a>
</li>
                                        <li>

    
        
                            
    
    
    <a  id="action-export-word-link" href="https://doc.ez.no/exportword?pageId=12125301" rel="nofollow"  class="action-export-word"   title="">
                <span>Export to Word</span>    </a>
</li>
                                </ul>
                    </div>
    </li>
            </ul>
    </div>

        
                <div id="title-heading" class="pagetitle with-breadcrumbs">
        
                            <div class="space-logo " data-key="EZP51" data-name="Exponential 5.1" data-entity-type="confluence.space">
            <a><img class="logo space custom" src="https://doc.ez.no/download/attachments/12125253/EZP51?version=2&amp;modificationDate=1370705476000&amp;api=v2" alt=""></a>
        </div>            
                            <div id="breadcrumb-section">
                    
    
    
    <ol id="breadcrumbs">
                    
                
        <li class="first" >
                

                    <span class=""><a href="https://doc.ez.no/display/EZP51">Exponential 5.1</a></span>
                                                <li id="ellipsis" title="Show all breadcrumbs"><span><strong>&#8230;</strong></span></li>
                                    
                
        <li class="hidden-crumb" >
                

                    <span class=""><a href="https://doc.ez.no/display/EZP51/eZ+Publish+Documentation">Exponential Documentation</a></span>
                                        
                
        <li class="hidden-crumb" >
                

                    <span class=""><a href="https://doc.ez.no/display/EZP51/Developer+Guide">Developer Guide</a></span>
                                        
                
        <li class="hidden-crumb" >
                

                    <span class=""><a href="https://doc.ez.no/display/EZP51/Developing+with+eZ+Publish+5">Developing with Exponential 5</a></span>
                                        
                
        <li class="hidden-crumb" >
                

                    <span class=""><a href="https://doc.ez.no/display/EZP51/MVC+and+Application">MVC and Application</a></span>
                                        
                
        <li class="hidden-crumb" >
                

                    <span class=""><a href="https://doc.ez.no/display/EZP51/Cache">Cache</a></span>
                            
                
        <li>
                

                    <span class=""><a href="https://doc.ez.no/display/EZP51/Persistence+cache">Persistence cache</a></span>
                </ol>


                </div>
            
            <h1 id="title-text" class="with-breadcrumbs">
                            Page History
                        </h1>
        </div>
    </div>

    

    
    
    
    
    

    

    
                
    
        




        




    

    

    







    
    
        
    
    
                    
    

    


<div id="content" class="page view-information">
    

<div id="action-messages">
                        </div>



        <script type="text/x-template" title="searchResultsGrid">
    <table class="aui">
        <thead>
            <tr class="header">
                <th class="search-result-title">Page Title</th>
                <th class="search-result-space">Space</th>
                <th class="search-result-date">Updated</th>
            </tr>
        </thead>
    </table>
</script>
<script type="text/x-template" title="searchResultsGridCount">
    <p class="search-result-count">{0}</p>
</script>
<script type="text/x-template" title="searchResultsGridRow">
    <tr class="search-result">
        <td class="search-result-title"><a href="{1}" class="content-type-{2}"><span>{0}</span></a></td>
        <td class="search-result-space"><a class="space" href="/display/{4}/" title="{3}">{3}</a></td>
        <td class="search-result-date"><span class="date" title="{6}">{5}</span></td>
    </tr>
</script>
        
    
    
                            
    
                        
                    <div class="diff-menu">
                <h2 class="diff-title">Versions Compared</h2>

                <div class="page-navigation section">
                                <div class="old page-version article">
                <h3 class="version-title">
                    <a class="page version-navigation" href="https://doc.ez.no/pages/viewpage.action?pageId=14123051">
                        <span class="assistive">Old Version</span>
                        <span class="version"> 5 </span>
                    </a>
                </h3>
                <p class="metadata author"><span class="assistive">changes.mady.by.user </span>    <a href="https://doc.ez.no/display/~ricardo.correia@ez.no"
                       class="url fn"
                            >Ricardo Correia</a></p>
                <p class="metadata modified"><span class="assistive">Saved on </span><time datetime="2013-05-29 08:11:59.0">May 29, 2013</time></p>
            </div>
        
                    <span class="assistive">compared with</span>

                                <div class="new page-version article">
                <h3 class="version-title">
                    <a class="page version-navigation" href="https://doc.ez.no/pages/viewpage.action?pageId=12125301">
                        <span class="assistive">New Version</span>
                        <span class="version"> Current </span>
                    </a>
                </h3>
                <p class="metadata author"><span class="assistive">changes.mady.by.user </span>    <a href="https://doc.ez.no/display/~andre.romcke@ez.no"
                       class="url fn"
                            >André Rømcke</a></p>
                <p class="metadata modified"><span class="assistive">Saved on </span><time datetime="2013-09-12 13:59:20.0">Sep 12, 2013</time></p>
            </div>
        
                    <div class="diff-navigation nav">
                        <ul>
                                                    <li><a class="previous version-navigation" href="https://doc.ez.no/pages/diffpages.action?originalId=12781720&amp;pageId=14123051">
                                <span>Previous Change: Difference between versions 4 and 5</span>
                            </a></li>
                                                                           <li><a class="all version-navigation" href="https://doc.ez.no/pages/viewpreviousversions.action?pageId=12125301">
                                <span>View Page History</span>
                           </a></li>
                        </ul>
                    </div>
                </div>

                        <div class="legend">
            <h2 class="legend-title">Key</h2>
            <ul>
                <li><span class="diff-html-added">This line was added.</span></li>
                <li><span class="diff-html-removed">This line was removed.</span></li>
                <li><span class="diff-html-changed">Formatting was changed.</span></li>
            </ul>
        </div>
    
                            <div id="version-comment" class="noteMacro">
        <strong>Comment:</strong>
        Migrated to Confluence 5.3<br />
    </div>
                </div>
                                                                
    
<div id="page-diffs" class="wiki-content">
            <table class="diff-macro diff-block-context"><thead><tr><th class="diff-macro-title"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/info.png);"> </span>Info</th></tr></thead><tbody><tr><td class="diff-macro-body">Persistence cache is a new feature introduced in 5.1. It does not exists in previous versions.</td></tr></tbody></table><p class="diff-block-context"><table class="diff-macro bodyless"><thead><tr><th class="diff-macro-title"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/toc.png);"> </span>Table of Contents</th></tr></thead></table></p><h3 id="Persistencecache-TechNote" class="diff-block-target diff-block-context"><span class="diff-html-removed" id="removed-diff-0">Tech Note</span></h3><p class="diff-block-target diff-block-context"><span class="diff-html-removed">Current implementation uses a caching library called </span><a href="http://stash.tedivm.com/" class="external-link" rel="nofollow"><span class="diff-html-removed">Stash</span></a><span class="diff-html-removed">, via </span><a href="https://github.com/tedivm/TedivmStashBundle" class="external-link" rel="nofollow"><span class="diff-html-removed">Stash-bundle</span></a><span class="diff-html-removed">. If this changes, then the configuration format will most likely change as well. </span><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">Stash supports the following cache handlers: </span></span><strong style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">FileSystem</span></strong><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">, </span></span><strong style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">Memcache</span></strong><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">, </span></span><strong style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">APC</span></strong><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">, </span></span><strong style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">Sqlite</span></strong><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">, </span></span><strong style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">XCache</span></strong><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed"> and </span></span><strong style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">BlackHole</span></strong><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">.</span></span></p><h1 id="Persistencecache-Configuration" class="diff-block-target diff-block-context"><span class="diff-html-removed">Configuration</span></h1><p class="diff-block-target diff-block-context"><span class="diff-html-removed">During Setup wizard and manually using </span><code><span class="diff-html-removed">exponential:configure</span></code><span class="diff-html-removed"> console command a default configuration is generated currently </span><strong><span class="diff-html-removed">using FileSystem</span></strong><span class="diff-html-removed">, using </span><code><span class="diff-html-removed">%kernel.cache_dir%/stash</span></code><span class="diff-html-removed"> to store cache files. It falls back to </span><em><span class="diff-html-removed">BlackHole</span></em><span class="diff-html-removed">, a non caching cache handler.</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-removed">The configuration is placed in exponential/config/exponential.yml, and looks like:</span></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/plugins/servlet/confluence/placeholder/macro-icon?name=code);"> </span>Code Block</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-removed">title</span></th><td><span class="diff-html-removed">Default exponential.yml</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-removed">stash:
    caches:
        default:
            handlers:
                - FileSystem
            inMemory: false
            registerDoctrineAdapter: false</span></pre></td></tr></tbody></table><p class="diff-block-target diff-block-context"><span class="diff-html-removed">The default settings used during setup wizard as found in </span><code><span class="diff-html-removed">exponential/config/exponential_setup.yml</span></code><span class="diff-html-removed">:</span></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/plugins/servlet/confluence/placeholder/macro-icon?name=code);"> </span>Code Block</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-removed">title</span></th><td><span class="diff-html-removed">exponential_setup.yml</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-removed">stash:
    caches:
        default:
            handlers:
                - BlackHole
            inMemory: true
            registerDoctrineAdapter: false</span></pre></td></tr></tbody></table><p class="diff-block-target diff-block-context"><span class="diff-html-removed">This setting works across all installs and just caches objects within the same request thanks to the </span><code><span class="diff-html-removed">inMemory: true</span></code><span class="diff-html-removed"> setting.</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-removed">If you want to change to another handler, see below for what kind of settings you have available.</span></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/note.png);"> </span>Note</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-removed">title</span></th><td><span class="diff-html-removed">Note for multiple sites installation</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><p><span class="diff-html-removed">As cache configuration is global to the application, it's currently not possible to have different cache configuration by siteaccess. As such, when having multiple websites </span><strong><span class="diff-html-removed">using different content repositories</span></strong><span class="diff-html-removed">, you must only use the </span><code><span class="diff-html-removed">BlackHole</span></code><span class="diff-html-removed"> handler with </span><code><span class="diff-html-removed">inMemory</span></code><span class="diff-html-removed"> caching:</span></p><table class="diff-macro diff-html-removed"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/plugins/servlet/confluence/placeholder/macro-icon?name=code);"> </span>Code Block</span></th></tr></thead><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-removed">stash:
    caches:
        default:
            handlers: [BlackHole]
            inMemory: true
            registerDoctrineAdapter: false</span></pre></td></tr></tbody></table><p><span class="diff-html-removed">This will result to the same persistence cache strategy as in Exponential 4.x.</span></p></td></tr></tbody></table><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/note.png);"> </span>Note</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-removed">title</span></th><td><span class="diff-html-removed">Note for "inMemory" cache with long running scripts</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><p><span class="diff-html-removed">Use of </span><code><span class="diff-html-removed">inMemory</span></code><span class="diff-html-removed"> caching with BlackHole or any other cache handler should not be used for long running scripts as it will over time return stale data (inMemory cache is not shared across requests/processes, so invalidation does not happen)!</span></p></td></tr></tbody></table><h3 id="Persistencecache-AfterupgradingExponential" class="diff-block-target diff-block-context"><span class="diff-html-removed">After upgrading Exponential</span></h3><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/note.png);"> </span>Note</span></th></tr></thead><tbody><tr><td class="diff-macro-body"><p><strong><span class="diff-html-removed">Important note:</span></strong><span class="diff-html-removed"> After performing an upgrade please be aware that the persistence cache won't be set, as this is a new feature introduced in Exponential 5.1.</span></p></td></tr></tbody></table><p class="diff-block-target diff-block-context"><span class="diff-html-removed">To enable persistence cache you should either regenerate your </span><code><span class="diff-html-removed">yml</span></code><span class="diff-html-removed"> configurations or add the cache section into your </span><code><span class="diff-html-removed">exponential.yml</span></code><span class="diff-html-removed"> file manually, as exemplified above.</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-removed">Also please note that regenerating the </span><code><span class="diff-html-removed">yml</span></code><span class="diff-html-removed"> configurations will remove any customizations done.</span><br /><span class="diff-html-removed">To avoid configuration loss be sure to use the </span><code><span class="diff-html-removed">--backup</span></code><span class="diff-html-removed">parameter when running the </span><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">exponential:configure </span></span><span style="font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">console command, as shown in the following example:</span></span></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/noformat.png);"> </span>No Format</span></th></tr></thead><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-removed">cd /&lt;ezp5-root&gt;
php exponential/console exponential:configure --backup --env=prod &lt;group&gt; &lt;admin-siteaccess&gt;</span></pre></td></tr></tbody></table><h2 id="Persistencecache-Stashhandlersconfiguration" class="diff-block-target diff-block-context"><span class="diff-html-removed">Stash handlers configuration</span></h2><h3 id="Persistencecache-Generalsettings" class="diff-block-target diff-block-context"><span class="diff-html-removed">General settings</span></h3><p class="diff-block-target diff-block-context"><span class="diff-html-removed">To check which cache settings are available for your installation, run the following command in your terminal :</span></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/plugins/servlet/confluence/placeholder/macro-icon?name=code);"> </span>Code Block</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-removed">language</span></th><td><span class="diff-html-removed">bash</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-removed">php exponential/console config:dump-reference stash</span></pre></td></tr></tbody></table><h3 id="Persistencecache-FileSystem" class="diff-block-target diff-block-context"><span><span class="diff-html-removed">FileSystem</span></span></h3><p class="diff-block-target diff-block-context"><span class="diff-html-removed">This cache handler is using local filesystem, by default the Symfony cache folder, as this is per server, it </span><strong><span class="diff-html-removed">does not support multi server (cluster) setups</span></strong><span class="diff-html-removed">!</span></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/note.png);"> </span>Note</span></th></tr></thead><tbody><tr><td class="diff-macro-body"><strong><span class="diff-html-removed">We strongly discourage you from storing cache files on NFS</span></strong><span class="diff-html-removed">, as it defeats the purpose of the cache: speed</span></td></tr></tbody></table><p class="diff-block-target diff-block-context"><strong><span style="color: rgb(51,51,51);font-size: 10.0pt;line-height: 13.0pt;"><span class="diff-html-removed">Available settings</span></span></strong></p><div class="table-wrap diff-block-target diff-block-context"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><code><strong><span class="diff-html-removed">path</span></strong></code></td><td class="confluenceTd"><span class="diff-html-removed">The path where the cache is placed, default is </span><code><span class="diff-html-removed">%kernel.cache_dir%/stash</span></code><span class="diff-html-removed">, effectively </span><code><span class="diff-html-removed">exponential/cache/&lt;env&gt;/stash</span></code></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">dirSplit</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">Number of times the cache key should be split up to avoid having to many files in each folder, default is 2.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">filePermissions</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">The permissions of the cache file, default is 0660.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">dirPermissions</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">The permission of the cache file directories (see dirSplit), default is 0770.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">memKeyLimit</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">Limit on how many key to path entries are kept in memory during execution at a time to avoid having to recalculate the path on key lookups, default 200.</span></td></tr></tbody></table></div><h3 id="Persistencecache-APC" class="diff-block-target diff-block-context"><span class="diff-html-removed">APC</span></h3><p class="diff-block-target diff-block-context"><span class="diff-html-removed">This cache handler is using shard memory using APC's user cache feature, as this is per server, it </span><strong><span class="diff-html-removed">does not support multi server (cluster) setups</span></strong><span class="diff-html-removed">, unless you use PHP-FPM on a dedicated server (this way, user cache can be shared among all the workers in one pool).</span></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/note.png);"> </span>Note</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-removed">title</span></th><td><span class="diff-html-removed">Limitation</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><p><span class="diff-html-removed">As APC user cache is not shared between processes, it is not possible to clear the user cache from CLI, even if you set </span><span style="color: rgb(0,0,0);"><code><span class="diff-html-removed">apc.enable_cli</span></code><span class="diff-html-removed"> to On</span></span><span class="diff-html-removed">. </span><br /><span class="diff-html-removed">Hence publishing content from a command line script won't let you properly clear SPI cache.</span></p></td></tr></tbody></table><p class="diff-block-target diff-block-context"><span class="diff-html-removed">Please also note that the default value for </span><code><span class="diff-html-removed">apc.shm_size</span></code><span class="diff-html-removed"> is 128MB. However, 256MB is recommended for APC to work properly. For more details please refer to the </span><a href="http://www.php.net/manual/en/apc.configuration.php#ini.apc.shm-size" class="external-link" rel="nofollow"><span class="diff-html-removed">APC configuration manual</span></a><span class="diff-html-removed">.</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-removed"> </span></p><p class="diff-block-target diff-block-context"><strong><span class="diff-html-removed">Available settings</span></strong></p><div class="table-wrap diff-block-target diff-block-context"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><code><strong><span class="diff-html-removed">ttl</span></strong></code></td><td class="confluenceTd"><span class="diff-html-removed">The time to live of the cache in seconds, default set to 500 (8.3 minutes)</span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">namespace</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">A namespace to prefix cache keys with to avoid key conflicts with other Exponential sites on same Exponential installation, default is </span><code><span class="diff-html-removed">null</span></code><span class="diff-html-removed">.</span></td></tr></tbody></table></div><h3 id="Persistencecache-Memcache" class="diff-block-target diff-block-context"><span class="diff-html-removed">Memcache</span></h3><p class="diff-block-target diff-block-context"><span class="diff-html-removed">This cache handler is using </span><a href="http://memcached.org/" class="external-link" rel="nofollow"><span class="diff-html-removed">Memcached, a distributed caching solution</span></a><span class="diff-html-removed">, </span><strong><span class="diff-html-removed">this is the only supported cache solution for multi server (cluster) setups</span></strong><span class="diff-html-removed">!</span></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/info.png);"> </span>Info</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-removed">title</span></th><td><span class="diff-html-removed">Note</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><p><span class="diff-html-removed">Stash supports both the php </span><a href="http://php.net/memcache" class="external-link" rel="nofollow"><span class="diff-html-removed">Memcache</span></a><span class="diff-html-removed"> and </span><a href="http://php.net/memcached" class="external-link" rel="nofollow"><span class="diff-html-removed">Memcached</span></a><span class="diff-html-removed"> extensions. </span><strong><span class="diff-html-removed">However </span><u><span class="diff-html-removed">Memcached is recommended</span></u></strong><span class="diff-html-removed"> as it is much more advanced and supports all settings below.</span></p><p><span class="diff-html-removed">If you have both extensions installed, </span><strong><span class="diff-html-removed">Stash will automatically choose Memcached</span></strong><span class="diff-html-removed">.</span></p></td></tr></tbody></table><div class="table-wrap diff-block-target diff-block-context"><table class="confluenceTable"><tbody><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">servers</span></strong></code></td><td colspan="1" class="confluenceTd"><p><span class="diff-html-removed">Array of Memcached servers, with host/IP, port and weight</span></p><p><code><strong><span class="diff-html-removed">server</span></strong></code><span class="diff-html-removed">: Host or IP of your Memcached server</span><br /><code><strong><span class="diff-html-removed">port</span></strong></code><span class="diff-html-removed">: Port where Memcached is listening to (defaults to 11211)</span><br /><code><strong><span class="diff-html-removed">weight</span></strong></code><span class="diff-html-removed">: Weight of the server, when using several Memcached servers</span></p></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">prefix_key</span></strong></code></td><td colspan="1" class="confluenceTd"><span><span class="diff-html-removed">A namespace to prefix cache keys with to avoid key conflicts with other Exponential sites on same Exponential installation (default is an empty string). </span></span><br /><span><span class="diff-html-removed">Must be the same on all server with the same installation.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-prefix-key" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed">.</span></span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">compression</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default true. </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-compression" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span class="diff-html-removed">.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">libketama_compatible</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default false.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-libketama-compatible" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">buffer_writes</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default false.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-buffer-writes" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">binary_protocol</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default false.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-binary-protocol" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">no_block</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default false.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-no-block" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">tcp_nodelay</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default false.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-tcp-nodelay" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">connection_timeout</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default 1000.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-connection-timeout" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">retry_timeout</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default 0.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-memcached-timeout" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">send_timeout</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default 0.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-send-timeout" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">recv_timeout</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default 0.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-recv-timeout" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">poll_timeout</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default 1000.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-poll-timeout" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">cache_lookups</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default false.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-cache-lookups" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong><span class="diff-html-removed">server_failure_limit</span></strong></code></td><td colspan="1" class="confluenceTd"><span class="diff-html-removed">default 0.</span><span><span class="diff-html-removed"> </span></span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-server-failure-limit" class="external-link" rel="nofollow"><span class="diff-html-removed">See Memcached option</span></a><span><span class="diff-html-removed"> </span></span></td></tr></tbody></table></div><p class="diff-block-target diff-block-context"><span class="diff-html-removed">For in-depth information on the settings, see: </span><a href="http://php.net/Memcached" class="external-link" rel="nofollow"><span class="diff-html-removed">http://php.net/Memcached</span></a></p><table class="diff-macro diff-html-removed diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-removed"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/info.png);"> </span>Info</span></th></tr></thead><tbody><tr><td class="diff-macro-body"><p><span class="diff-html-removed">When using Memcache handler, </span><strong><span class="diff-html-removed">it's strongly recommended to also use </span><code><span class="diff-html-removed">inMemory</span></code><span class="diff-html-removed"> cache</span></strong><span class="diff-html-removed"> (see example below). </span><br /><span class="diff-html-removed">This will help reducing network traffic between your webserver and your Memcached server.</span></p></td></tr></tbody></table><h4 id="Persistencecache-ExamplewithMemcache" class="diff-block-target diff-block-context"><span class="diff-html-removed">Example with Memcache</span></h4><p class="diff-context-placeholder">...</p><h1 id="Persistencecache-Introduction" class="diff-block-target diff-block-context"><span class="diff-html-added" id="added-diff-0">Introduction</span></h1><p class="diff-block-target diff-block-context"><span class="diff-html-added"> </span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added">This page describes how Persistence cache works, and how to reuse the cache service it uses.</span></p><p class="diff-block-target diff-block-context"><strong><span class="diff-html-added">Configuration</span></strong></p><p class="diff-block-target diff-block-context"><span class="diff-html-added">For configuring the cache service, look at the </span><a class="confluence-link unresolved" href="#"><span class="diff-html-added">Persistence cache configuration</span></a><span class="diff-html-added"> page.</span></p><h1 id="Persistencecache-Persistentcache" class="diff-block-target diff-block-context"><span class="diff-html-added">Persistent cache</span></h1><p class="diff-block-target diff-block-context"><span class="diff-html-added diff-html-image-container"><img class="confluence-embedded-image image-left" src="https://doc.ez.no/plugins/servlet/confluence/placeholder/unknown-attachment?locale=en_GB&amp;version=2" title="SPI Cache.png" /><span class="diff-image-overlay diff-added-image">Image Added</span></span></p><h4 id="Persistencecache-Layers" class="diff-block-target diff-block-context"><span class="diff-html-added">Layers</span></h4><p class="diff-block-target diff-block-context"><span class="diff-html-added">Persistence cache can best be described as a implementation of SPI\Persistence that wraps around the main implementation (currently: "Legacy Storage Engine").</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added">As shown in the illustration this is done in the exact same way as the SignalSlot feature is a custom implementation of API\Repository wraps around the main Repository. In the case of Persistence Cache, instead of sending events on calls passed on to the wrapped implementation, most of the load calls are cached, and calls that perform changes purges the affected caches. This is done using a Cache service which is provided by StashBundle; this Service wraps around the Stash library to provide Symfony logging / debugging functionality, and allows configuration on cache handlers (Memcached, Apc, Filesystem, ..) to be configured using Symfony configuration. For how to reuse this Cache service in your own custom code, see below.</span></p><h4 id="Persistencecache-Transparentcache" class="diff-block-target diff-block-context"><span class="diff-html-added">Transparent cache</span></h4><p class="diff-block-target diff-block-context"><span class="diff-html-added">The persistence cache, just like the HTTP cache, tries to follow principles of "Transparent caching", this can shortly be described as a cache which is invisible to the end user and to the admin/editors of Exponential where content is always returned "fresh". In other words there should not be a need to manually clear the cache like was frequently the case with Exponential 4.x (aka "legacy"). This is possible thanks to an interface that follows CRUD (Create Read Update Delete) operations per domain, and number of other operations capable of affecting a certain domain is kept to a minimum.</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added"> </span></p><h5 id="Persistencecache-Entitystoredonlyonce" class="diff-block-target diff-block-context"><span class="diff-html-added">Entity stored only once</span></h5><p class="diff-block-target diff-block-context"><span class="diff-html-added">To make the transparent caching principle as effective as possible, entities are as much as possible only stored once in cache by their primary id. Lookup by a</span><span><span><span class="diff-html-added">lternative identifiers (identifier, remoteId, ..) is only cached with the identifier as cache key and primary id as it's cache value, and </span></span></span><span class="diff-html-added">compositions</span><span><span><span class="diff-html-added"> (list of objects) usually keep only the array of primary id's as their cache value.</span></span></span></p><p class="diff-block-target diff-block-context"><span><span class="diff-html-added">This means a couple of things:</span></span></p><ul class="diff-block-target diff-block-context"><li><span><span class="diff-html-added">Memory consumption is kept low</span></span></li><li><span class="diff-html-added">Cache purging logic is kept simple ( Example: $sectionService-&gt;delete( 3 ) clears "section/3" cache entry )</span></li><li><span class="diff-html-added">Lookup by identifier and list of objects needs several cache lookups to be able to assemble the result value</span></li><li><span class="diff-html-added">Cache warmup usually takes several page loads to reach full as identifier is first cached, then the object</span></li></ul><h4 id="Persistencecache-Whatiscached?" class="diff-block-target diff-block-context"><span class="diff-html-added">What is cached?</span></h4><p class="diff-block-target diff-block-context"><span class="diff-html-added">Persistence cache aimed in its first iteration for caching all SPI\Persistence calls used in a normal page load, including everything needed for permission checking and url alias lookups.</span><br /><span class="diff-html-added">However Search queries are currently not cached as it is more difficult to make sure they stay fresh unless all search cache is purged on every modification, or a complicated search cache walking purge system is implemented that is able to detect which search result to clear (this is what is planned for future versions, but it is planned to be done when there is a background process system in place).</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added">Anyway, the following SPI calls are not currently cached:</span></p><ul class="diff-block-target diff-block-context"><li><span class="diff-html-added">ObjectStateHandler</span></li><li><span class="diff-html-added">TrashHandler</span></li><li><span class="diff-html-added">UrlWildCardHandler</span></li><li><span class="diff-html-added">SearchHandler::*</span></li><li><span class="diff-html-added">transactions</span></li></ul><p class="diff-block-target diff-block-context"><span class="diff-html-added">For more details on which calls are cached or not, and where to contribute additional caches, check out the </span><a href="https://github.com/ezsystems/exponential-kernel/tree/master/eZ/Publish/Core/Persistence/Cache" class="external-link" rel="nofollow"><span class="diff-html-added">source</span></a><span class="diff-html-added">.</span></p><h4 id="Persistencecache-Legacykernelcachepurging" class="diff-block-target diff-block-context"><span class="diff-html-added">Legacy kernel cache purging</span></h4><p class="diff-block-target diff-block-context"><span class="diff-html-added">Currently with the Dual-kernel Exponential has in version 5.x, the "Transparent caching principle" referred to above has one major obstacle. Exponential 4.x ("legacy") kernel was not made for such a thing and has a lot of API's that can make changes to the data in the database and hence make the persistence cache "stale" (aka out of date).</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added">A couple of things are in place to try to avoid this from happening / making it less of a problem:</span></p><ul class="diff-block-target diff-block-context"><li><span class="diff-html-added">The Persistence cache has a expiry time configurable in exponential.yml</span></li><li><span class="diff-html-added">LegacyBundle (the bundle that exposes legacy to Symfony and integrates Symfony with legacy) has a PersistenceCachePurger</span></li></ul><h5 id="Persistencecache-PersistenceCachePurger" class="diff-block-target diff-block-context"><span class="diff-html-added">PersistenceCachePurger</span></h5><p class="diff-block-target diff-block-context"><a href="https://github.com/ezsystems/exponential-kernel/blob/master/eZ/Bundle/EzPublishLegacyBundle/Cache/PersistenceCachePurger.php" class="external-link" rel="nofollow"><span class="diff-html-added">PersistenceCachePurger</span></a><span class="diff-html-added"> is setup by LegacyBundle to receive all relevant </span><a href="https://github.com/ezsystems/exponential-legacy/blob/master/doc/features/5.0/event.txt" class="external-link" rel="nofollow"><span class="diff-html-added">cache</span></a><span class="diff-html-added"> </span><a href="https://github.com/ezsystems/exponential-legacy/blob/master/doc/features/5.1/event.txt" class="external-link" rel="nofollow"><span class="diff-html-added">events</span></a><span class="diff-html-added"> triggered by legacy kernel, and clear relevant Persistence cache based on the incoming data.</span><br /><span class="diff-html-added">This means a "Clear all cache" operation done in legacy will also clear all persistence cache, it also means relevant content cache is cleared on publishing, so all code using the api's covered by these events should in effect be cache safe in regards to persistence cache.</span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added">So, in case of stale persistence cache, a clear all cache in legacy admin interface is thus still possible, however a manual cache clear is also possible but how to do it depends on which cache handler is currently used. </span></p><h1 id="Persistencecache-ReusingCacheservice" class="diff-block-target diff-block-context"><span class="diff-html-added">Reusing Cache service</span></h1><p class="diff-block-target diff-block-context"><span class="diff-html-added">Using the cache service allows you to use a interface  and not have to care about if the system has been configured to place the cache in Memcached, Apc or on File system. And as Exponential requries that instances uses a cluster aware cache, you can safly assume your cache is shared across all Exponential web servers.</span></p><table class="diff-macro diff-html-added diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-added"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/warning.png);"> </span>Warning</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-added">title</span></th><td><span class="diff-html-added">Interface warning</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><p><span class="diff-html-added">Current implementation uses a caching library called </span><a class="external-link" href="http://stash.tedivm.com/" rel="nofollow"><span class="diff-html-added">Stash</span></a><span class="diff-html-added">, via </span><a class="external-link" href="https://github.com/tedivm/TedivmStashBundle" rel="nofollow"><span class="diff-html-added">Stash-bundle</span></a><span class="diff-html-added">. If this changes, then the Interface of the cache service will most likely change as well.</span></p></td></tr></tbody></table><table class="diff-macro diff-html-added diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-added"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/warning.png);"> </span>Warning</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-added">title</span></th><td><span class="diff-html-added">Cache key warning</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><p><span class="diff-html-added">When reusing the cache service within your own code, it is very important to not conflict with the cache keys used by Exponential, hence why example of usage starts with a unique "myApp" key for the namespace of your own cache, you must do the same!</span></p><p><span class="diff-html-added">Also, this means that when Exponential clears all cache, it will also wipe out your custom cache as well!</span></p></td></tr></tbody></table><table class="diff-macro diff-html-added diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-added"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/images/icons/macrobrowser/dropdown/warning.png);"> </span>Warning</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-added">title</span></th><td><span class="diff-html-added">Multi site warning</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><p><span class="diff-html-added">Be aware that in some edge cases as of Exponential 5.1, we recommend that the cache system is practically disabled using a </span><em><span class="diff-html-added">Blackhole</span></em><span class="diff-html-added"> driver. This is the case in multi repository (one Exponential install, several databases) because the current configuration does not support setting cache key prefixes pr database (the current configuration is global to installation and not possible to set pr site / site group).</span></p><p><span class="diff-html-added">In this case the cache service will only keep your cache during the request, if the recommended InMemory setting is enabled.</span></p></td></tr></tbody></table><h2 id="Persistencecache-GetCacheservice" class="diff-block-target diff-block-context"><span class="diff-html-added">Get Cache service</span></h2><h3 id="Persistencecache-ViaDependencyinjection" class="diff-block-target diff-block-context"><span class="diff-html-added">Via Dependency injection</span></h3><p class="diff-block-target diff-block-context"><span class="diff-html-added">In Exponential 5.x Symfony2 stack you can simply define that you require the "cache" service in your configuration like so:</span></p><table class="diff-macro diff-html-added diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-added"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/plugins/servlet/confluence/placeholder/macro-icon?name=code);"> </span>Code Block</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-added">title</span></th><td><span class="diff-html-added">yml configuration</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-added">    myApp.myService</span>:
        <span class="diff-html-removed" id="removed-diff-1">default</span><span class="diff-html-added" id="added-diff-1">class</span>: <span class="diff-html-added" id="added-diff-2">%myApp.myService.class%</span>
        <span class="diff-html-removed" id="removed-diff-2">   handlers</span><span class="diff-html-added" id="added-diff-3">arguments</span>:
<span class="diff-html-removed" id="removed-diff-3">[</span> <span class="diff-html-removed" id="removed-diff-4">Memcache</span> <span class="diff-html-removed" id="removed-diff-5">]</span>          <span class="diff-html-removed" id="removed-diff-6">   inMemory: true
            registerDoctrineAdapter: false
            Memcache:
                prefix_key: ezdemo_
                retry_timeout: 1
                servers:
    </span><span class="diff-html-added" id="added-diff-4">- @stash.default_cache</span></pre></td></tr></tbody></table><p class="diff-block-target diff-block-context"><span class="diff-html-added">The "cache" service is an instance of the following class: Tedivm\StashBundle\Service\CacheService</span></p><h3 id="Persistencecache-ViaSymfony2Container" class="diff-block-target diff-block-context"><span class="diff-html-added">Via Symfony2 Container</span></h3><p class="diff-block-target diff-block-context"><span class="diff-html-added">Like any other service, it is possible to get the "cache" service via container as well like so:</span></p><table class="diff-macro diff-html-added diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-added"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/plugins/servlet/confluence/placeholder/macro-icon?name=code);"> </span>Code Block</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-added">title</span></th><td><span class="diff-html-added">getting the cache service in php</span></td></tr><tr><th><span class="diff-html-added">language</span></th><td><span class="diff-html-added">php</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-added">/** @var $cacheService \Tedivm\StashBundle\Service\CacheService */
$cacheService = $container-&gt;get( 'stash.default_cache' );</span></pre></td></tr></tbody></table><h3 id="Persistencecache-InlegacyviaSymfony2Container" class="diff-block-target diff-block-context"><span class="diff-html-added">In legacy via Symfony2 Container</span></h3><p class="diff-block-target diff-block-context"><span class="diff-html-added">When Exponential legacy runs via Exponential 5.x Symfony2 stack, you will be able to get the service container in the following way:</span></p><table class="diff-macro diff-html-added diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-added"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/plugins/servlet/confluence/placeholder/macro-icon?name=code);"> </span>Code Block</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-added">title</span></th><td><span class="diff-html-added">Getting cache service in legacy</span></td></tr><tr><th><span class="diff-html-added">language</span></th><td><span class="diff-html-added">php</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-added">// From a legacy module or any PHP code running in legacy context.
$container = ezpKernel::instance()-&gt;getServiceContainer();
 
/** @var $cacheService \Tedivm\StashBundle\Service\CacheService */
$cacheService = $container-&gt;get( 'stash.default_cache' );</span></pre></td></tr></tbody></table><h2 id="Persistencecache-Usingthecacheservice" class="diff-block-target diff-block-context"><span class="diff-html-added">Using the cache service</span></h2><p class="diff-block-target diff-block-context"><span class="diff-html-added">Example usage of the cache service:</span></p><table class="diff-macro diff-html-added diff-block-target diff-block-context"><thead><tr><th class="diff-macro-title"><span class="diff-html-added"><span class="icon macro-placeholder-icon" style="background-image: url(https://doc.ez.no/s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/_/plugins/servlet/confluence/placeholder/macro-icon?name=code);"> </span>Code Block</span></th></tr></thead><tbody><tr><td class="diff-macro-properties"><table><tbody><tr><th><span class="diff-html-added">title</span></th><td><span class="diff-html-added">Actuall example from cache use in exponential-kernel</span></td></tr><tr><th><span class="diff-html-added">language</span></th><td><span class="diff-html-added">php</span></td></tr></tbody></table></td></tr></tbody><tbody><tr><td class="diff-macro-body"><pre><span class="diff-html-added">    $cacheItem = $cacheService-&gt;getItem( 'myApp', 'object', $id );
    if ( $cacheItem-&gt;isMiss() )
    {</span>
        <span class="diff-html-added" id="added-diff-5">$myObject</span> <span class="diff-html-added" id="added-diff-6">=</span> <span class="diff-html-removed" id="removed-diff-7">     -
 </span><span class="diff-html-added" id="added-diff-7">$container-&gt;get('my_app.backend_service')-&gt;loadObject( $id )</span>
        <span class="diff-html-added" id="added-diff-8">$cacheItem-&gt;set(</span> <span class="diff-html-added" id="added-diff-9">$myObject</span> <span class="diff-html-added" id="added-diff-10">);</span>
    <span class="diff-html-added" id="added-diff-11">}</span>
    <span class="diff-html-added" id="added-diff-12">else</span>
 <span class="diff-html-removed" id="removed-diff-8">server:</span> <span class="diff-html-removed" id="removed-diff-9">127.0.0.1</span>  <span class="diff-html-added" id="added-diff-13">{</span>
        <span class="diff-html-added" id="added-diff-14">$myObject</span> <span class="diff-html-added" id="added-diff-15">=</span> <span class="diff-html-added" id="added-diff-16">$cacheItem-&gt;get();</span>
    <span class="diff-html-added" id="added-diff-17">}</span>
    <span class="diff-html-removed" id="removed-diff-10">  port: 11211</span><span class="diff-html-added" id="added-diff-18">return $myObject;</span></pre></td></tr></tbody></table><p class="diff-block-target diff-block-context"><span><span class="diff-html-added">For more info on usage, take a look at </span></span><a href="http://stash.tedivm.com/" class="external-link" rel="nofollow"><span class="diff-html-added">Stash's documentation</span></a><span><span class="diff-html-added">.</span></span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added"> </span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added"> </span></p><p class="diff-block-target diff-block-context"><span class="diff-html-added"> </span></p>
</div>
    
    

            
</div>


    




    
    

    
    
    







</div>
  
        <div id="theme-footer">
            <div class="sectionColumnWrapper"><div class="sectionMacro">
<div class="sectionMacroRow"><div class="columnMacro"></div>
<div class="columnMacro">
<div class="panel" style="background-color: #ecf0f1;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #ecf0f1;">
<p>Where Content Means Business</p>
</div></div></div>
<div class="columnMacro"></div></div></div></div>
        </div>
    
    </div>
</div>


        
            <div id="footer">

    <section class="footer-body">

                                                <p class="license license-opensource">
                  Powered by a free <b>Atlassian Confluence Open Source Project License</b> granted to Exponential. <a href="http://www.atlassian.com/c/conf/11461">Evaluate Confluence today</a>.<br>
                </p>
                        
    

    <ul id="poweredby">
        <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="hover-footer-link">Atlassian Confluence</a> <span id='footer-build-information'>5.4.4</span>, <a href="http://www.atlassian.com/software/confluence/overview/team-collaboration-software?utm_source=confluence-footer" class="hover-footer-link">Team Collaboration Software</a></li>
        <li class="print-only">Printed by Atlassian Confluence 5.4.4, Team Collaboration Software.</li>
        <li class="noprint"><a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" class="hover-footer-link">Report a bug</a></li>
        <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="hover-footer-link">Atlassian News</a></li>
    </ul>

    

            <script>
AJS.toInit(function(){
 if(AJS.params.spaceKey &&
    AJS.params.spaceKey === 'MAIN' ||
    AJS.params.spaceKey === 'EZMA' ||
    AJS.params.spaceKey === 'ODC' ||
    AJS.params.spaceKey === 'EZP50' ||
    AJS.params.spaceKey === 'EZP51' ||
    AJS.params.spaceKey === 'EZP52' ||
    AJS.params.spaceKey === 'EZPCLOUD' ||
    AJS.params.spaceKey === 'EZP' ||
    AJS.params.spaceKey === 'EZRECO'
){

(function()
{var isSecure=('https:'==document.location.protocol);var ff=document.createElement('script');ff.type='text/javascript';ff.async=true;ff.src=(isSecure?'https':'http')+'://'+(isSecure?'secure.':'lb.')+'liveviewer.ez.no/statjs/sst-120-1304513615/stat.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ff,s);}
)();

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-303624-13', 'ez.no');
  ga('send', 'pageview');
}}
);
</script>
    
    </section>

</div>

            
    </div>
</body>

<!-- Mirrored from doc.ez.no/pages/diffpagesbyversion.action?pageId=12125301&originalVersion=5&revisedVersion=10 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 15:16:45 GMT -->
</html>
