                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=30711160 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:00:59 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage8b14.html?pageId=30711160" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/colors82a8.css?spaceKey=TECHDOC" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/custom82a8.css?spaceKey=TECHDOC" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p> </p><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="b74c67f8-87ba-43bf-9865-d756393e195c" data-macro-schema-version="1"></p><h2>Introduction</h2><p>Search <a class="confluence-link" href="../../display/TECHDOC/Criteria%2breference.html" data-linked-resource-id="30711488" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Criteria reference" data-base-url="https://doc.ez.no">Criteria</a> and <a class="confluence-link" href="../../display/TECHDOC/Sort%2bClauses%2breference.html" data-linked-resource-id="30711489" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Sort Clauses reference" data-base-url="https://doc.ez.no">Sort Clauses</a> are <code>value</code> object classes used for building Search Query, to define filter criteria and ordering of the result set. eZ Platform (and Exponential Platform 5.x)  provides a number of standard Criteria and Sort Clauses that you can use out of the box and that should cover the majority of use cases.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="49d786bf-6dee-48e2-82e2-456a4c629206" data-macro-parameters="language=php|linenumbers=true|title=Example of standard ContentId criterion" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bcc.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPUV4YW1wbGUgb2Ygc3RhbmRhcmQgQ29udGVudElkIGNyaXRlcmlvbnxsaW5lbnVtYmVycz10cnVlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php

namespace eZ\Publish\API\Repository\Values\Content\Query\Criterion;

use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\Operator\Specifications;
use eZ\Publish\API\Repository\Values\Content\Query\CriterionInterface;

/**
 * A criterion that matches content based on its id
 *
 * Supported operators:
 * - IN: will match from a list of ContentId
 * - EQ: will match against one ContentId
 */
class ContentId extends Criterion implements CriterionInterface
{
    /**
     * Creates a new ContentId criterion
     *
     * @param int|int[] $value One or more content Id that must be matched.
     *
     * @throws \InvalidArgumentException if a non numeric id is given
     * @throws \InvalidArgumentException if the value type doesn't match the operator
     */
    public function __construct( $value )
    {
        parent::__construct( null, null, $value );
    }

    public function getSpecifications()
    {
        $types = Specifications::TYPE_INTEGER | Specifications::TYPE_STRING;
        return array(
            new Specifications( Operator::IN, Specifications::FORMAT_ARRAY, $types ),
            new Specifications( Operator::EQ, Specifications::FORMAT_SINGLE, $types ),
        );
    }

    public static function createFromQueryBuilder( $target, $operator, $value )
    {
        return new self( $value );
    }
}</pre></td></tr></table><h2>Search Engine Handling of Criteria and Sort Clauses</h2><p>As <a class="confluence-link" href="../../display/TECHDOC/Criteria%2breference.html" data-linked-resource-id="30711488" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Criteria reference" data-base-url="../../index.html">Criterions</a> and <a class="confluence-link" href="../../display/TECHDOC/Sort%2bClauses%2breference.html" data-linked-resource-id="30711489" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Sort Clauses reference" data-base-url="../../index.html">Sort Clauses</a> are <code>value</code> objects which are used to define the Query from API perspective, they are are common for all storage engines. Each storage engine needs to implement its own <code>handler</code> for corresponding Criterion and Sort Clause <code>value</code> object, which will be used to translate the value object into storage specific search query.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="6523eb04-c680-4591-b018-f8e6b7d39220" data-macro-parameters="language=php|linenumbers=true|title=Example of ContentId criterion handler in Legacy Storage Engine" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingaa8c.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPUV4YW1wbGUgb2YgQ29udGVudElkIGNyaXRlcmlvbiBoYW5kbGVyIGluIExlZ2FjeSBTdG9yYWdlIEVuZ2luZXxsaW5lbnVtYmVycz10cnVlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php

namespace eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler;

use eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler;
use eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriteriaConverter;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\Core\Persistence\Database\SelectQuery;

/**
 * Content ID criterion handler
 */
class ContentId extends CriterionHandler
{
    /**
     * Check if this criterion handler accepts to handle the given criterion.
     *
     * @param \eZ\Publish\API\Repository\Values\Content\Query\Criterion $criterion
     *
     * @return boolean
     */
    public function accept( Criterion $criterion )
    {
        return $criterion instanceof Criterion\ContentId;
    }


    /**
     * Generate query expression for a Criterion this handler accepts
     *
     * accept() must be called before calling this method.
     *
     * @param \eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriteriaConverter $converter
     * @param \eZ\Publish\Core\Persistence\Database\SelectQuery $query
     * @param \eZ\Publish\API\Repository\Values\Content\Query\Criterion $criterion
     *
     * @return \eZ\Publish\Core\Persistence\Database\Expression
     */
    public function handle( CriteriaConverter $converter, SelectQuery $query, Criterion $criterion )
    {
        return $query->expr->in(
            $this->dbHandler->quoteColumn( "id", "ezcontentobject" ),
            $criterion->value
        );
    }
}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="10937478-df1b-4584-8952-f7ae0206cb5c" data-macro-parameters="language=php|linenumbers=true|title=Example of ContentId criterion handler in Solr Storage engine" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinga654.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPUV4YW1wbGUgb2YgQ29udGVudElkIGNyaXRlcmlvbiBoYW5kbGVyIGluIFNvbHIgU3RvcmFnZSBlbmdpbmV8bGluZW51bWJlcnM9dHJ1ZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php

namespace EzSystems\EzPlatformSolrSearchEngine\Query\Content\CriterionVisitor;

use EzSystems\EzPlatformSolrSearchEngine\Query\CriterionVisitor;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\Operator;

/**
 * Visits the ContentId criterion
 */
class ContentIdIn extends CriterionVisitor
{
    /**
     * CHeck if visitor is applicable to current criterion
     *
     * @param Criterion $criterion
     *
     * @return boolean
     */
    public function canVisit( Criterion $criterion )
    {
        return
            $criterion instanceof Criterion\ContentId &amp;&amp;
            ( ( $criterion->operator ?: Operator::IN ) === Operator::IN ||
              $criterion->operator === Operator::EQ );
    }


    /**
     * Map field value to a proper Solr representation
     *
     * @param Criterion $criterion
     * @param CriterionVisitor $subVisitor
     *
     * @return string
     */
    public function visit( Criterion $criterion, CriterionVisitor $subVisitor = null )
    {
        return '(' .
            implode(
                ' OR ',
                array_map(
                    function ( $value )
                    {
                        return 'id:"' . $value . '"';
                    },
                    $criterion->value
                )
            ) .
            ')';
    }
}</pre></td></tr></table><h2>Custom Criteria and Sort Clauses</h2><p>Sometimes you will find that standard <a class="confluence-link" href="../../display/TECHDOC/Criteria%2breference.html" data-linked-resource-id="30711488" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Criteria reference" data-base-url="../../index.html">Criteria</a> and <a class="confluence-link" href="../../display/TECHDOC/Sort%2bClauses%2breference.html" data-linked-resource-id="30711489" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Sort Clauses reference" data-base-url="../../index.html">Sort Clauses</a> provided with Exponential are not sufficient for you needs. Most often this will be the case if you have developed a custom <a class="confluence-link" href="../../login8826.html?pageId=23528556" data-linked-resource-id="23528556" data-linked-resource-version="1" data-linked-resource-type="page" data-linked-resource-default-alias="Fieldtype" data-base-url="../../index.html">FieldType</a> using external storage, which therefore can not be searched using standard Field Criterion.</p><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="9ffc24fa-6793-4bff-bf1e-5d9d67ec2f63" data-macro-parameters="title=On use of Field Criterion/SortClause with large databases" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd24b.png?definition=e3dhcm5pbmc6dGl0bGU9T24gdXNlIG9mIEZpZWxkIENyaXRlcmlvbi9Tb3J0Q2xhdXNlIHdpdGggbGFyZ2UgZGF0YWJhc2VzfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Field Criterion/SortClause does not perform well by design when using SQL database, so if you have a large database and want to use them you either need to use Solr search engine, or develop your own Custom Criterion / Sort Clause to avoid use of attributes (Fields) database table, and instead uses a custom simplified table which can handle the amount of data you have.</p></td></tr></table><p>In this case you can implement a custom Criterion or Sort Clause, together with the corresponding handlers for the storage engine you are using.</p><h2>Difference between Content and Location Search</h2><p>These are two basic types of searches, you can either search for Locations or for Content. Each has dedicated methods in Search Service:</p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Type of search</th><th class="confluenceTh">Method in Search Service</th></tr><tr><td class="confluenceTd">Content</td><td class="confluenceTd"><code>findContent()</code></td></tr><tr><td colspan="1" class="confluenceTd">Content</td><td colspan="1" class="confluenceTd"><code>findSingle()</code></td></tr><tr><td class="confluenceTd">Location</td><td class="confluenceTd"><code>findLocations()</code></td></tr></tbody></table><p>All Criterions and Sort Clauses will be accepted with Location Search, but not all of them can be used with Content Search. Reason for this is that while one Location always has exactly one Content item, one Content item can have multiple Locations. In this context some Criterions and Sort Clauses would produce ambiguous queries and such will therefore not be accepted by Content Search.</p><p>Content Search will explicitly refuse to accept Criterions and Sort Clauses implementing these abstract classes:</p><ul><li><pre>eZ\Publish\API\Repository\Values\Content\Query\<span>Criterion\</span>Location</pre></li><li><pre>eZ\Publish\API\Repository\Values\Content\SortClause\<span>Criterion\</span>Location</pre></li></ul><h2>How to configure your own Criterion and Sort Clause Handlers</h2><p>After you have implemented your Criterion / Sort Clause and its handler, you will need to configure the handler for the service container using dedicated service tags for each type of search. Doing so will automatically register it and handle your Criterion / Search Clause when it is given as a parameter to one of the Search Service methods.</p><p>Available tags for Criterion handlers in Legacy Storage Engine are:</p><ul><li><code>exponential.<span>search</span>.legacy.gateway.criterion_handler.content</code></li><li><code>exponential.<span>search</span>.legacy.gateway.criterion_handler.location</code></li></ul><p>Available tags for Sort Clause handlers in Legacy Storage Engine are:</p><ul><li><code>exponential.<span>search</span>.legacy.gateway.sort_clause_handler.content</code></li><li><code>exponential.<span>search</span>.legacy.gateway.sort_clause_handler.location</code></li></ul><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="4e30ca1d-3fda-40b9-806b-1f14859480e9" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>You will find all the native handlers and the tags for the Legacy Storage Engine available in the eZ/Publish/Core/settings/storage_engines/legacy<span class="separator">/</span><strong class="final-path">search_query_handlers.yml</strong> file.</p></td></tr></table><h3>Example of registering ContentId Criterion handler, common for both Content and Location Search</h3><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="7369ddb2-7cd7-4492-9aa8-2a2360f9b9ca" data-macro-parameters="language=bash|title=Registering Criterion handler" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading9daf.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1SZWdpc3RlcmluZyBDcml0ZXJpb24gaGFuZGxlcn0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>services:
    exponential.search.legacy.gateway.criterion_handler.common.content_id:
        class: eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler\ContentId
        arguments: [@exponential.api.storage_engine.legacy.dbhandler]
        tags:
          - {name: exponential.search.legacy.gateway.criterion_handler.content}
          - {name: exponential.search.legacy.gateway.criterion_handler.location}</pre></td></tr></table><h3>Example of registering Depth Sort Clause handler for Location Search</h3><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="2dbe7578-e062-4eca-82aa-9c01836f9d57" data-macro-parameters="language=bash|title=Registering Sort Clause handler" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1b59.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1SZWdpc3RlcmluZyBTb3J0IENsYXVzZSBoYW5kbGVyfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential.search.legacy.gateway.sort_clause_handler.location.depth:
    class: eZ\Publish\Core\Search\Legacy\Content\Location\Gateway\SortClauseHandler\Location\Depth
    arguments: [@exponential.api.storage_engine.legacy.dbhandler]
    tags:
        - {name: exponential.search.legacy.gateway.sort_clause_handler.location}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="76a20654-ed97-4df4-a361-0710c29d9ecb" data-macro-parameters="title=See also" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57-2.png?definition=e2luZm86dGl0bGU9U2VlIGFsc299&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>See also <a href="http://symfony.com/doc/current/book/service_container.html#service-parameters">Symfony documentation about Service Container</a> for passing parameters</p></td></tr></table><p> </p><h5>Related topics:</h5><ul><li><a class="confluence-link" href="../../display/TECHDOC/Criteria%2breference.html" data-linked-resource-id="30711488" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Criteria reference" data-base-url="../../index.html">Criteria reference</a></li><li><a class="confluence-link" href="../../display/TECHDOC/Sort%2bClauses%2breference.html" data-linked-resource-id="30711489" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Sort Clauses reference" data-base-url="../../index.html">Sort Clauses reference</a></li></ul>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=30711160 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:01:00 GMT -->
</html>
