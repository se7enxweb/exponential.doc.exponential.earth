                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=8323282 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:07:26 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage65fa.html?pageId=8323282" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/51/_/styles/colorsb538.css?spaceKey=EZP" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/51/_/styles/customb538.css?spaceKey=EZP" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p>Sessions are handled by the Symfony2 framework, specifically API and underlying session handlers provided by HTTP Fundation component[1][2], this is further enhanced in Exponential with support for SiteAccess aware <a class="confluence-link" href="../../display/EZP/Session%2bcookie%2bconfiguration.html" data-linked-resource-id="19891597" data-linked-resource-version="11" data-linked-resource-type="page" data-linked-resource-default-alias="Session cookie configuration" data-base-url="https://doc.ez.no">session cookie configuration</a>.</p><p><em>Use of Memcached (or experimentally using PDO) as session handler is a requirement in Cluster setup, for details see below, for an overview of clustering feature see <a href="../../display/EZP/Clustering.html">Clustering</a>. </em></p><h1>Session handlers</h1><p>In Symfony, session handler is configured using <code>framework.session.handler_id.</code> Symfony can be configured to use <span style="line-height: 1.4285715;">custom handlers[2]</span>, or just fallback to what is configured in PHP by setting it to null (<code>~</code>).</p><h2>Default configuration</h2><h4>Prior to 5.4 / 2014.11</h4><p>Before 5.4 Exponential uses default <a href="http://symfony.com/doc/master/reference/configuration/framework.html">Framework Bundle configuration</a>, which on Symfony 2.3 implies Symfony's <em style="line-height: 1.4285715;">NativeFileSessionHandler</em>[3] (<code>session.handler.native_file</code> service). This handler forces PHP's builtin &quot;files&quot; session save handler, and specifically configures it to use <code style="line-height: 1.4285715;">session.save_path</code> set to <code style="line-height: 1.4285715;">exponential/sessions</code> by default <code style="line-height: 1.4285715;">(exponential/cache/&lt;env&gt;/sessions</code> before 5.3).</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=powershell|title=Default config.yml session configuration in 5.3 / 2014.03" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinga375.png?definition=e2NvZGU6bGFuZ3VhZ2U9cG93ZXJzaGVsbHx0aXRsZT1EZWZhdWx0IGNvbmZpZy55bWwgc2Vzc2lvbiBjb25maWd1cmF0aW9uIGluIDUuMyAvIDIwMTQuMDN9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>framework:
    session:
        save_path: "%kernel.root_dir%/sessions"
        # The session name defined here will be overridden by the one defined in your exponential.yml, for your SiteAccess.
        # Default session name is "eZSESSID{siteaccess_hash}" (unique session name per SiteAccess).
        # See exponential.yml.example for an example on how to configure this.</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-parameters="title=Session Garbage collection on Debian &amp; Ubuntu" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading89ca.png?definition=e2luZm86dGl0bGU9U2Vzc2lvbiBHYXJiYWdlIGNvbGxlY3Rpb24gb24gRGViaWFuICYgVWJ1bnR1fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Debian based Linux distros <a href="https://bugs.launchpad.net/ubuntu/+source/php5/+bug/316441">disables</a> <a href="http://php.net/manual/en/session.configuration.php#ini.session.gc-probability">session.gc_probability</a> by default and uses cronjob instead to clear sessions files. As we use custom save_path for sessions here that would normally be a problem, however default Symfony configuration makes sure to re enable this in <code>framework.session.gc_probability</code> so with default Symfony and PHP settings it should garbage collecting sessions files roughly every 100th time on average (1% probability by default).</p></td></tr></table><h4>As of 5.4 / 2014.11</h4><p>Uses same default configuration as recent versions of Symfony standard distribution, this makes sure you can configure sessions purely in php by default, and allows Debian/Ubuntu session file cleanup cronjob to work as intended.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=powershell|title=Default config.yml session configuration as of 5.4 / 2014.11" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb2f5.png?definition=e2NvZGU6bGFuZ3VhZ2U9cG93ZXJzaGVsbHx0aXRsZT1EZWZhdWx0IGNvbmZpZy55bWwgc2Vzc2lvbiBjb25maWd1cmF0aW9uIGFzIG9mIDUuNCAvIDIwMTQuMTF9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>framework:
    session:
        # handler_id set to null will use default session handler from php.ini
        handler_id:  ~</pre></td></tr></table><h2>Recommendations for production setup</h2><h3>Single server setup</h3><p>For single server, default handler should be preferred.</p><h3>Cluster setup</h3><p>For <a class="confluence-link" href="../../display/EZP/Clustering.html" data-linked-resource-id="25985700" data-linked-resource-version="9" data-linked-resource-type="page" data-linked-resource-default-alias="Clustering" data-base-url="../../index.html">Cluster</a> setup we need to configure Sessions to use a backend that is shared between web servers, and supports locking. Only options out of the box supporting this in Symfony is native PHP memcached session save handler provided by php-memcache<u>d</u> extension, and Symfony session handler for PDO (database).</p><h4>Storing sessions in Memcached using php-memcached</h4><p>For setting up Exponential using this memcached you'll need to configure the session save handler settings in php.ini as documented <a href="http://php.net/manual/en/memcached.sessions.php">here</a>, optionally tweak <a href="http://fr2.php.net/manual/en/memcached.configuration.php">php-memcached session settings</a>, and use default configuration as of Exponential 5.4 / 2014.11 documented above.</p><h4>Alternative storing sessions in database using PDO</h4><p>While not currently our recommendation from performance perspective, for setups where Database is preferred for storing Sessions, you may use Symfony's PdoSessionHandler.<br />Below is an configuration example for Exponential, but please refer to <a href="http://symfony.com/doc/current/cookbook/configuration/pdo_session_storage.html">documented in Symfony Cookbook documentation</a> for full documentation.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=powershell" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading59dd.png?definition=e2NvZGU6bGFuZ3VhZ2U9cG93ZXJzaGVsbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>framework:
    session:
        # ...
        handler_id: session.handler.pdo

parameters:
    pdo.db_options:
        db_table:    session
        db_id_col:   session_id
        db_data_col: session_value
        db_time_col: session_time

services:
    pdo:
        class: PDO
        arguments:
            dsn:      "mysql:dbname=&lt;mysql_database>"
            user:     &lt;mysql_user>
            password: &lt;mysql_password>

    session.handler.pdo:
        class:     Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler
        arguments: ["@pdo", "%pdo.db_options%"]</pre></td></tr></table><h2>Further Symfony references</h2><ol><li><a href="http://symfony.com/doc/current/cookbook/session/index.html">Cookbook Session recipes (symfony.com)</a></li><li> <a href="http://symfony.com/doc/current/components/http_foundation/index.html">HTTP Fundation Component documentation (symfony.com)</a></li><li>Source code of <a href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Session/Storage/Handler/NativeFileSessionHandler.php">NativeFileSessionHandler (github.com)</a>, </li><li><a href="http://symfony.com/doc/current/cookbook/configuration/pdo_session_storage.html">Cookbook Configuration recipe for setting-up PdoSessionHandler (symfony.com)</a>, aka <code>session.handler.pdo</code> service</li></ol><p> </p><p> </p><p> </p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=8323282 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:07:28 GMT -->
</html>
