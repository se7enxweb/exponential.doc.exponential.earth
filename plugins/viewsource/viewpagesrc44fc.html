                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=8323433 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:01:55 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage44fc.html?pageId=8323433" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/51/_/styles/colorsb538.css?spaceKey=EZP" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/51/_/styles/customb538.css?spaceKey=EZP" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p>Exponential 5 has a strong focus on backwards compatibility and thus lets you reuse code you might have written for 4.x, including templates and modules.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="6f4f886b-c868-4780-a249-fe56845f17f4" data-macro-parameters="title=Hint" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb960.png?definition=e2luZm86dGl0bGU9SGludH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Read <a class="confluence-link" href="../../pages/viewpageb2b6.html?pageId=2720567" data-linked-resource-id="2720567" data-linked-resource-version="37" data-linked-resource-type="page" data-linked-resource-default-alias="Intro for Exponential 4.x/3.x developers" data-base-url="../../index.html">Intro for Exponential 4.x/3.x developers</a> to have an overview of common concepts and terminology changes, it also have a sub page comparing 4.x with 5.x.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="1159a823-a805-41e4-b87b-c30822c3c393" data-macro-parameters="title=Looking for 4.x documentation ?" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingf16b.png?definition=e2luZm86dGl0bGU9TG9va2luZyBmb3IgNC54IGRvY3VtZW50YXRpb24gP30&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>You will find the 4.x documentation in the <a href="../../Exponential/index.html">legacy part of the documentation</a>.</p></td></tr></table><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="e12de409-1319-4554-8d91-dede574b498a" data-macro-schema-version="1"></p><h2>Legacy Mode</h2><p>Legacy mode is a specific configuration mode where Exponential's behavior is the closest to v4.x. It might be used in some very specific use cases, such as <strong>running the admin interface</strong>.</p><h3>What it does</h3><ul><li><strong>Still runs through the whole Symfony kernel</strong>. As such, Symfony services can still be accessed from legacy stack.</li><li><strong>Disables the default router</strong> (standard Symfony routes won't work in this mode)</li><li><strong>Disables the UrlAliasRouter</strong>. As such, the <strong>ViewController will be bypassed</strong>.</li></ul><h3>What it doesn't do</h3><ul><li><strong>Increase performance</strong>. Legacy mode is actually <strong>painful for performances</strong> since it won't use the HttpCache mechanism.</li></ul><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="81518658-1358-4527-b3e9-2965bed1060e" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingca13.png?definition=e3dhcm5pbmd9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><span>In a migration context, </span> <strong>using Legacy Mode is never a good option</strong> <span> as it prevents all the performance goodness (e.g. Http Cache) to work.</span> <br /> <span>Always keep in mind that, </span> <strong>not running in legacy mode, if a content item still doesn't have a corresponding Twig template/controller, <a class="confluence-link" href="../../display/EZP/Legacy%2btemplate%2bfallback.html" data-linked-resource-id="8323369" data-linked-resource-version="20" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy template fallback" data-base-url="../../index.html">Exponential will always fallback to the legacy kernel, looking for a legacy template</a> </strong> <span>.</span></p><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="5d8f410b-1292-44c7-af04-27c01cf5186b" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading7f8c.png?definition=e3RpcH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>If you don't have anything <span>(e.g. pagelayout, config...) </span>migrated to Symfony stack, including Twig templates and Symfony controllers, <strong>it's usually better performance wise to use <em>pure legacy stack</em>, using <code>exponential_legacy/</code> folder as your DocumentRoot</strong>.</p><p>This way you will only use the legacy kernel and Exponential will have the same behavior as 4.x. However, note that <strong>you won't be able to use the Symfony stack features at all</strong>.</p></td></tr></table></td></tr></table><p> </p><h3>Allowing Symfony routes to work</h3><p><strong>Symfony routes are disabled in legacy mode</strong>, which implies admin interface as well.</p><p>If for some reason you need a Symfony route to work, you add it to a whitelist :</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="ce8e814f-df89-4dac-b7e9-f3dfad07d584" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ez_publish_legacy:
    # Routes that are allowed when legacy_mode is true.
    # Must be routes identifiers (e.g. "my_route_name").
    # Can be a prefix, so that all routes beginning with given prefix will be taken into account.
    legacy_aware_routes: ["my_route_name", "my_route_prefix_"]</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="18448b67-7a58-4e74-92c4-c6083f25e023" data-macro-parameters="title=Deprecation warning" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading2583.png?definition=e25vdGU6dGl0bGU9RGVwcmVjYXRpb24gd2FybmluZ30&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Configuration for legacy aware routes have changed as of 5.4.2. Prior to this version, configuration was the following:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="6c445a4f-8f2d-4c18-abf7-9f5f5ab8b5c2" data-macro-parameters="language=bash" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading174f.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential:
    router:
        default_router:
            # Routes that are allowed when legacy_mode is true.
            # Must be routes identifiers (e.g. "my_route_name").
            # Can be a prefix, so that all routes beginning with given prefix will be taken into account.
            legacy_aware_routes: ["my_route_name", "my_route_prefix_"]</pre></td></tr></table><p>Note that this notation doesn't work as of eZ Platform (kernel v6.0)</p></td></tr></table><p> </p><p>By default, <code>_exponentialLegacyTreeMenu</code> and all REST v2 (<code>exponential_rest_</code> prefix) routes are allowed.</p><h2>Legacy Template inclusion</h2><p><span>It is possible to include old templates (<strong>.tpl</strong>) into new ones.</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="f97bb365-d248-42ef-923c-57227c265edc" data-macro-parameters="title=Include a legacy template using the old template override mechanism" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb6a0.png?definition=e2NvZGU6dGl0bGU9SW5jbHVkZSBhIGxlZ2FjeSB0ZW1wbGF0ZSB1c2luZyB0aGUgb2xkIHRlbXBsYXRlIG92ZXJyaWRlIG1lY2hhbmlzbX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# Twig template #}
{# Following code will include my/old_template.tpl, exposing $someVar variable in it #}
{% include "design:my/old_template.tpl" with {"someVar": "someValue"} %}</pre></td></tr></table><p>Or if you want to <strong>include a legacy template by its path</strong>, relative to <code>exponential_legacy</code> folder:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="ab4bf881-9d10-46d5-903f-efa2085c50a3" data-macro-parameters="title=Exponential 5.1+" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading975f.png?definition=e2NvZGU6dGl0bGU9ZVogUHVibGlzaCA1LjErfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# Following code will include exponential_legacyextension/my_legacy_extension/design/standard/templates/my_old_template.tpl, exposing $someVar variable in it #}
{% include "file:extension/my_legacy_extension/design/standard/templates/my_old_template.tpl" with {"someVar": "someValue"} %}</pre></td></tr></table><h3>Template parameters</h3><p>Scalar and array parameters are passed to a legacy template <em>as-is</em>.</p><p>Objects, however, are being converted in order to comply the legacy <a href="https://github.com/ezsystems/exponential-kernel/blob/v2014.11.8/eZ/Publish/Core/MVC/Legacy/Templating/LegacyCompatible.php">eZ Template API</a>. By default <a href="https://github.com/ezsystems/exponential-kernel/blob/v2014.11.8/eZ/Publish/Core/MVC/Legacy/Templating/LegacyAdapter.php">a generic adapter</a> is used, exposing all public properties and getters. You can define your own converter by implementing <a href="https://github.com/ezsystems/exponential-kernel/blob/v2014.11.8/eZ/Publish/Core/MVC/Legacy/Templating/Converter/ObjectConverter.php">the appropriate interface</a> and declare it as a service with the <code>
    <strong>exponential_legacy.templating.converter</strong>
  </code> tag.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="d03a783b-0c9f-4860-bac1-4c8171040f53" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><code>Content </code>/ <code>Location</code> objects from the Public API <a href="https://github.com/ezsystems/exponential-kernel/blob/v2014.11.8/eZ/Publish/Core/MVC/Legacy/Templating/Converter/ApiContentConverter.php">are converted into <code>eZContentObject</code>/<code>eZContentObjectTreeNode</code> objects</a> (re-fetched). </p></td></tr></table><h2>Running legacy code</h2><p>Exponential 5 still relies on the legacy kernel (from 4.x) and runs it when needed <strong>inside an isolated PHP closure</strong>, making it <strong>sandboxed</strong>. This is available for your use as well through the <code>runCallback()</code> method.</p><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="ae6a4f63-7611-49ac-91c6-24df140bf99d" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingca13.png?definition=e3dhcm5pbmd9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>All calls from Platform/Symfony stack to legacy stack should be run inside a <code>runCallback</code>() call.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="47179c4b-632f-4324-b11c-439b816f08b5" data-macro-parameters="language=php|title=Simple legacy code example" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingcdd8.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPVNpbXBsZSBsZWdhY3kgY29kZSBleGFtcGxlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php
// Declare use statements for the classes you may need
use eZINI;

// Inside a controller extending eZ\Bundle\EzPublishCoreBundle\Controller
$settingName = 'MySetting';
$test = array( 'oneValue', 'anotherValue' );
$myLegacySetting = $this->getLegacyKernel()->runCallback(
    function () use ( $settingName, $test )
    {
        // Here you can reuse $settingName and $test variables inside the legacy context
        $ini = eZINI::instance( 'someconfig.ini' );
        return $ini->variable( 'SomeSection', $settingName );
    }
);</pre></td></tr></table><p>The example above is very simple and naive - in fact for accessing configuration settings from the Legacy Stack using the <a class="confluence-link" href="../../display/EZP/Legacy%2bconfiguration.html" data-linked-resource-id="2720546" data-linked-resource-version="10" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy configuration" data-base-url="../../index.html">ConfigResolver</a> is recommended.</p><p>Using the legacy closure, you'll be able to even run complex legacy features, like an <strong>eZ Find search</strong>:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="4de2db61-bd84-4f1e-a81d-3b2def876073" data-macro-parameters="language=php|title=Using eZ Find" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8151.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPVVzaW5nIGVaIEZpbmR9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>use eZFunctionHandler;

$searchPhrase = 'My search phrase';
$sort = array(
    'score'     => 'desc',
    'published' => 'desc'
);
$contentTypeIdenfiers = array( 'folder', 'article' );
$mySearchResults = $this->getLegacyKernel()->runCallback(
    function () use ( $searchPhrase, $sort, $contentTypeIdenfiers )
    {
        // eZFunctionHandler::execute is the equivalent for a legacy template fetch function
        // The following is the same than fetch( 'ezfind', 'search', hash(...) )
        return eZFunctionHandler::execute(
            'ezfind',
            'search',
            array(
                'query'     => $searchPhrase,
                'sort_by'   => $sort,
                'class_id'  => $contentTypeIdenfiers
            )
        );
    }
);</pre></td></tr></table><h2>Legacy modules</h2><h3>Routing fallback &amp; sub-requests</h3><p>Any route that is not declared in Exponential 5 in an included <code>routing.yml</code> and that is not a valid <em>UrlAlias</em> <strong>will automatically fallback to Exponential legacy</strong> (including admin interface).</p><p><strong>This allows all your old modules to work as before</strong>, out-of-the-box (including kernel modules), and also allows you to reuse this code from your templates using sub requests:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="7ecc4b07-8063-40e8-b3b7-05a19f030408" data-macro-parameters="language=html/xml|title=Template legacy module sub-request" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb54c.png?definition=e2NvZGU6bGFuZ3VhZ2U9aHRtbC94bWx8dGl0bGU9VGVtcGxhdGUgbGVnYWN5IG1vZHVsZSBzdWItcmVxdWVzdH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{{ render( url( 'ez_legacy', {'module_uri': '/content/view/sitemap/2'} ) ) }}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="ca22d36f-c0ba-4bda-9d5d-68b69a58f070" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>If your module uses ezjscore to insert CSS or JS, you need to add calls to <a class="confluence-link" href="../../display/EZP/ez_legacy_render_js.html" data-linked-resource-id="22937630" data-linked-resource-version="4" data-linked-resource-type="page" data-linked-resource-default-alias="ez_legacy_render_js" data-base-url="../../index.html">ez_legacy_render_js</a> and/or <a class="confluence-link" href="../../display/EZP/ez_legacy_render_css.html" data-linked-resource-id="22937634" data-linked-resource-version="1" data-linked-resource-type="page" data-linked-resource-default-alias="ez_legacy_render_css" data-base-url="../../index.html">ez_legacy_render_css</a> to the twig template rendering the &lt;head&gt; of your page.</p></td></tr></table><p> </p><h3>Using Exponential 5 and Symfony features in Legacy</h3><p>If for some reason you need to develop a legacy module and access to Exponential 5 / Symfony features (i.e. when developing an extension for admin interface), you'll be happy to know that you actually have access to all services registered in the whole framework, including bundles, through the service container.</p><p>The example below shows how to retrieve the content repository and the logger.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="930a0a6c-beab-4baf-8c21-d6c11fd4efdb" data-macro-parameters="language=php|title=Retrieve services from the container" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1a72.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPVJldHJpZXZlIHNlcnZpY2VzIGZyb20gdGhlIGNvbnRhaW5lcn0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>// From a legacy module or any PHP code running in legacy context.
$container = ezpKernel::instance()->getServiceContainer();

/** @var $repository \eZ\Publish\API\Repository\Repository */
$repository = $container->get( 'exponential.api.repository' );
/** @var $logger \Symfony\Component\HttpKernel\Log\LoggerInterface|\Psr\Log\LoggerInterface */
// PSR LoggerInterface is used in Exponential 5.1 / Symfony 2.2
$logger = $container->get( 'logger' );</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="fbf00c8b-882e-413e-9e28-93aec16655f3" data-macro-parameters="title=Tip" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading6668.png?definition=e3RpcDp0aXRsZT1UaXB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>The example above works in legacy modules and CLI scripts</p></td></tr></table><p> </p><h3>Running legacy scripts and cronjobs</h3><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="016db2c6-a808-4f06-96cb-9b13e073ad84" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Note: This feature has been introduced in Exponential 5.1.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="dd1d8e93-4163-4159-8657-db0525572ac0" data-macro-parameters="title=Important" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading5653.png?definition=e25vdGU6dGl0bGU9SW1wb3J0YW50fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><strong>Running legacy scripts and cronjobs through the Symfony stack is highly recommended !</strong> <br /> <span>Otherwise, features from the Symfony stack cannot be used (i.e. HTTP cache purge) and cache clearing. NB: Some script we know won't affect cache, are still documented to be executed the direct way.</span></p></td></tr></table><p><span style="font-size: 10.0pt;line-height: 13.0pt;">Legacy scripts can be executed form the Symfony CLI, by using the </span> <code style="font-size: 10.0pt;line-height: 13.0pt;">exponential:legacy:script</code> <span style="font-size: 10.0pt;line-height: 13.0pt;"> command, specifying the path to the script as argument.</span></p><p>The command will need to be executed from Exponential's 5 root, and the path to the desired script must exist in the <code>exponential_legacy</code> folder.<br />Here's a usage example:</p><table class="wysiwyg-macro" data-macro-name="noformat" data-macro-id="2ce7543e-d6c6-47e2-9bcc-94fa8a679501" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console --env=prod exponential:legacy:script bin/php/ezpgenerateautoloads.php</pre></td></tr></table><p>Here we made sure to specify <span style="color: rgb(51,51,53);">--env=prod, this is needed for all legacy scripts that clear cache, otherwise they will will clear dev environment cache instead of prod for Symfony stack.</span></p><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="e8f36b74-5f74-4b23-a820-914b9f2b27b6" data-macro-parameters="title=Options and arguments" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading9322.png?definition=e3dhcm5pbmc6dGl0bGU9T3B0aW9ucyBhbmQgYXJndW1lbnRzfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Always pass the legacy script options and arguments <strong>AFTER</strong> script path, otherwise they will be lost.</p></td></tr></table><h4>Script help</h4><p>If you want to access the script's help please be aware that you will need to use the newly introduced <code>--legacy-help</code> option, since --help is already reserved for the CLI help.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="55de8ca5-3adb-47fc-b18a-e4e014e5c173" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><span>The </span> <code>--legacy-help</code> <span> option should be added </span> <u>before</u> <span> the path to the script for this to work.</span></p></td></tr></table><p> </p><p><br />Here's an example:</p><table class="wysiwyg-macro" data-macro-name="noformat" data-macro-id="2d861d2b-5855-418b-95c3-6cec60d78c73" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console --env=prod exponential:legacy:script --legacy-help bin/php/ezpgenerateautoloads.php</pre></td></tr></table><p>The same logic will apply for cronjob execution.<br />Legacy cronjobs are triggered by the <code>runcronjobs.php</code> legacy script, which expects the name of the cronjob to run as a parameter.<br />This is how you can run cronjobs from the Symfony CLI:</p><table class="wysiwyg-macro" data-macro-name="noformat" data-macro-id="c8da1a83-ea9f-4008-89db-ec65524de884" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console --env=prod exponential:legacy:script runcronjobs.php frequent</pre></td></tr></table><p>Also, if you require using additional script options, please be sure to use the long name, such as <code>--siteaccess</code> or <code>--debug</code> to avoid conflicts between script and CLI options.<br />For more details regarding legacy cronjobs execution please refer to the <a href="../../Exponential/Technical-manual/5.x/Features/Cronjobs/Running-cronjobs.html">Running cronjobs</a> chapter existing in doc.ez.no.</p><h2>Legacy bundles</h2><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="5690c2b1-ad4c-423f-ae4e-09099d536405" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Available starting from v5.3 / 2014.03.</p></td></tr></table><p>Most customization work on Exponential legacy was done through Extensions. Due to the current dual-kernel architecture, many features written for the new stack will require some matching legacy code (a FieldType will require the equivalent datatype, a feature might require back-office customization...). In order to facilitate this, legacy bundles were implemented.</p><p>They allow you to place a legacy extension (or several) within a Symfony 2 bundle. Any such extension will be installed inside <code>exponential_legacy/extension</code>, and automatically enabled as long as the bundle is registered.</p><h3>Creating a legacy bundle extension</h3><p>Example: <a href="https://github.com/ezsystems/CommentsBundle">https://github.com/ezsystems/CommentsBundle</a></p><p>Legacy extensions must:</p><ul style="list-style-type: square;"><li>be placed within the bundle, within an <code>exponential_legacy</code> subfolder</li><li>must be contained in their own subfolder: <code style="line-height: 1.4285715;">Acme/AcmeBundle/exponential_legacy/acmeextension</code></li><li>must contain an <code>extension.xml</code> file</li></ul><p>A symlink (by default) will be created in <code>exponential_legacy/extension</code> pointing to the <code>acmeextension</code> folder. Starting from there, it will behave like any regular legacy extension.</p><h3>Alternative: referencing an existing legacy extension via composer</h3><p>Example: <a href="https://github.com/ezsystems/ngsymfonytools-bundle">https://github.com/ezsystems/ngsymfonytools-bundle</a>.</p><p>An alternative use-case is also covered: you have an existing legacy extension, and a new stack bundle depends on it. It is possible to reference this legacy extension, without copying anything from it, and have it automatically installed and enabled when the bundle is installed and registered.</p><p>To do so, the bundle's Bundle class must implement an extra interface, <code>eZ\Bundle\EzPublishLegacyBundle\LegacyBundles\LegacyBundleInterface</code> <span>. This interface specifies a <code>getLegacyExtensionsNames()</code> method, that is expected to return an array of legacy extensions names. Those legacy extension names will be enabled in legacy.</span></p><p><span>In ngsymfonytoolsbundle, we have two things:</span></p><ul style="list-style-type: square;"><li><span> <code>composer.json</code> <a href="https://github.com/ezsystems/ngsymfonytools-bundle/blob/master/composer.json#L12">requires</a> the legacy extension<br />When the bundle is installed using composer, the legacy extension gets installed inside legacy </span></li><li>EzSystemsNgsymfonytoolsBundle.php implements <code>getLegacyExtensionsNames()</code>, and returns <code>array( 'ngsymfonytools' )</code>, automatically enabling the extension in legacy.</li></ul><h3>Running the legacy bundle install script manually</h3><p>By default, <code>exponential-community/composer.json</code> will call the legacy bundle install script after update and install. If for some reason, you want to do it manually, it looks a lot like asset install scripts:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="2d4b12e4-c33d-4859-94eb-4fa6a015826c" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console exponential:legacybundles:install_extensions</pre></td></tr></table><p> By default, it will create an absolute symlink, but options exist to use a hard copy (<code>–copy</code>) or a relative link (<code>--relative</code>).<br />The script will also avoid overwriting existing targets if they aren't links to the bundle. The <code style="line-height: 1.4285715;">--force</code> option will make the script <em>erase</em> existing targets before copying/linking.</p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=8323433 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:01:59 GMT -->
</html>
