                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=30711240 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 08:35:19 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpageead3.html?pageId=30711240" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/colors82a8.css?spaceKey=TECHDOC" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/custom82a8.css?spaceKey=TECHDOC" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="9424a25e-a0b6-4767-8f2d-5b577cde6496" data-macro-schema-version="1"></p><h1>Introduction</h1><p>This page describes how Persistence cache works, and how to reuse the cache service it uses.</p><p><strong>Configuration</strong></p><p>For configuring the cache service, look at the <a class="confluence-link" href="../../display/TECHDOC/Persistence%2bcache%2bconfiguration.html" data-linked-resource-id="30711188" data-linked-resource-version="8" data-linked-resource-type="page" data-linked-resource-default-alias="Persistence cache configuration" data-base-url="https://doc.ez.no">Persistence&nbsp;cache configuration</a> page, for re-using the internal cache service see <a class="confluence-link" href="../../display/TECHDOC/Using%2bCache%2bservice.html" data-linked-resource-id="31425411" data-linked-resource-version="4" data-linked-resource-type="page" data-linked-resource-default-alias="Using Cache service" data-base-url="https://doc.ez.no">Using Cache service</a>.</p><h1>Persistent cache</h1><p><img class="confluence-embedded-image image-left" src="../../download/attachments/30711240/SPI%20Cache207c.png?version=1&amp;modificationDate=1370128139000&amp;api=v2" data-image-src="/download/attachments/30711240/SPI%20Cache.png?version=1&amp;modificationDate=1370128139000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="30711241" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="SPI Cache.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="30711240" data-linked-resource-container-version="14" title="TECHDOC > Persistence cache > SPI Cache.png" data-location="TECHDOC > Persistence cache > SPI Cache.png" data-image-height="491" data-image-width="315"></p><h4>Layers</h4><p>Persistence cache can best be described as an implementation of <code>SPI\Persistence</code> that decorates the main backend implementation <em>(currently: &quot;Legacy Storage Engine&quot;)</em>.</p><p>As shown in the illustration, this is done in the exact same way as the SignalSlot feature is a custom implementation of API\Repository decorating the main Repository. In the case of Persistence Cache, instead of sending events on calls passed on to the decorated implementation, most of the load calls are cached, and calls that perform changes purge the affected caches. This is done using a Cache service which is provided by StashBundle; this Service wraps around the Stash library to provide Symfony logging / debugging functionality, and allows cache handlers <em>(Memcached, Redis, Filesystem, etc.)</em> to be configured using Symfony configuration. For how to reuse this Cache service in your own custom code, see below.</p><h4>Transparent cache</h4><p>With the persistence cache, just like with the HTTP cache, eZ Platform tries to follow principles of &quot;Transparent caching&quot;, this can shortly be described as a cache which is invisible to the end user and to the admin/editors of eZ Platform where content is always returned &quot;fresh&quot;. In other words, there should be no need to manually clear the cache like it was frequently the case with Exponential 4.x. This is possible thanks to an interface that follows CRUD <em>(Create Read Update Delete)</em> operations per domain, and the fact that the number of other operations capable of affecting a certain domain is kept to a minimum.</p><h5>Entity stored only once</h5><p>To make the transparent caching principle as effective as possible, entities are, as much as possible, only stored once in cache by their primary id. Lookup by a<span><span>lternative identifiers (<code>identifier</code>, <code>remoteId</code>, etc.) is only cached with the identifier as cache key and primary <code>id</code> as its cache value, and </span></span>compositions<span><span><em> (list of objects)</em> usually keep only the array of primary id's as their cache value.</span></span></p><p><span>This means a couple of things:</span></p><ul><li><span>Memory consumption is kept low</span></li><li>Cache purging logic is kept simple (For example: <code>$sectionService-&gt;delete( 3 )</code> clears &quot;section/3&quot; cache entry)</li><li>Lookup by <code>identifier</code> and list of objects needs several cache lookups to be able to assemble the result value</li><li>Cache warmup usually takes several page loads to reach full as identifier is first cached, then the object</li></ul><h4>What is cached?</h4><p>Persistence cache aims at caching most <code>SPI\Persistence</code> calls used in common page loads, including everything needed for permission checking and url alias lookups.</p><p>Notes:</p><ul><li><code>UrlWildCardHandler</code> is not currently cached</li><li>Currently in case of transactions this is handled very simply by clearing all cache on rollback, this can be improved in the future if needed.</li><li>Some tree/batch operations will cause clearing all persistence cache, this will be improved in the future when we change to a cache service cable of cache tagging.</li><li>Search is not defined as Persistence and the queries themselves are not planned to be cached. Use <a class="confluence-link" href="../../display/TECHDOC/Solr%2bBundle.html" data-linked-resource-id="30711302" data-linked-resource-version="23" data-linked-resource-type="page" data-linked-resource-default-alias="Solr Bundle" data-base-url="https://doc.ez.no">Solr</a> which does this for you to improve scale and offload your database.</li></ul><p><em>For further details on which calls are cached or not, and where/how to contribute additional caches, check out the <a href="https://github.com/ezsystems/exponential-kernel/tree/master/eZ/Publish/Core/Persistence/Cache" style="line-height: 1.4285715;">source</a>.</em></p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=30711240 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 08:35:20 GMT -->
</html>
