                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=30711196 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:02:44 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage1a34.html?pageId=30711196" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/colors82a8.css?spaceKey=TECHDOC" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/custom82a8.css?spaceKey=TECHDOC" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="2d3e990b-9e33-4022-9820-4c88ba994f72" data-macro-schema-version="1"></p><h2>Description</h2><p>Before 5.4, if you wanted to implement a service needing siteaccess-aware settings (e.g. language settings), you needed to inject the whole <code>ConfigResolver</code> (<code>exponential.config.resolver</code>) and get the needed settings from it. This was neither very convenient nor explicit.</p><p>The goal of this feature is to allow developers to inject these dynamic settings explicitly from their service definition (yml, xml, annotation, etc.).</p><h2>Usage</h2><h3>Syntax</h3><p>Static container parameters follow the <code>%&lt;parameter_name&gt;%</code> syntax in Symfony.</p><p>Dynamic parameters have the following: <code>$&lt;parameter_name&gt;[; &lt;namespace&gt;[; &lt;scope&gt;]]$</code>, default namespace being <code>ezsettings</code>, and default scope being the current siteaccess.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="3d20d8bd-20e8-451f-9f4b-a07c44de9f07" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body">For more information, see <a href="https://confluence.ez.no/display/EZP/Configuration#Configuration-DynamicconfigurationwiththeConfigResolver">ConfigResolver documentation</a>.</td></tr></table><h3>DynamicSettingParser</h3><p>This feature also introduces a <em>DynamicSettingParser</em> service that can be used for adding support of the dynamic settings syntax.<br /> This service has <code>exponential.config.dynamic_setting.parser</code> for ID and implements<code> eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\SiteAccessAware\DynamicSettingParserInterface</code>.</p><h2>Limitations</h2><p>A few limitations still remain:</p><ul class="task-list"><li><span>It is not possible to use dynamic settings in your semantic configuration (e.g. <code>config.yml</code> or <code>ezplatform.yml</code>)Â <span>as they are meant primarily for parameter injection in services.</span></span></li><li>It is not possible to define an array of options having dynamic settings. They will not be parsed. Workaround is to use separate arguments/setters.</li><li>Injecting dynamic settings in request listeners is <strong>not recommended</strong>, as it won't be resolved with the correct scope (request listeners are <strong>instantiated before SiteAccess match</strong>). Workaround is to inject the ConfigResolver instead, and resolving the setting in your <code>onKernelRequest</code> method (or equivalent).</li></ul><h2>Examples</h2><h3>Injecting an eZ parameter</h3><p>Defining a simple service needing <code>languages</code> parameter (i.e. prioritized languages).</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="424a1aa4-c5d2-41a7-9edb-b9f7df80321c" data-macro-parameters="title=Note" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading4925.png?definition=e25vdGU6dGl0bGU9Tm90ZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Internally, <code>languages</code> parameter is defined as <code>ezsettings.&lt;siteaccess_name&gt;.languages</code>, <code>ezsettings</code> being eZ internal <em>namespace</em>.</p></td></tr></table><h3><strong style="color: rgb(0,98,147);font-size: 16.0px;line-height: 1.5625;">Before 5.4<br /></strong></h3><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="65f519ea-c340-40cd-b93b-06297349014c" data-macro-parameters="theme=RDark" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading372f.png?definition=e2NvZGU6dGhlbWU9UkRhcmt9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>parameters:
    acme_test.my_service.class: Acme\TestBundle\MyServiceClass

services:
    acme_test.my_service:
        class: %acme_test.my_service.class%
        arguments: [@exponential.config.resolver]

namespace Acme\TestBundle;</pre></td></tr></table><p><strong><br /></strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="9519786f-00ea-477e-9f39-9e178d7760a7" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>use eZ\Publish\Core\MVC\ConfigResolverInterface;

class MyServiceClass
{
    /**
 * Prioritized languages
 *
 * @var array
 */
    private $languages;

    public function __construct( ConfigResolverInterface $configResolver )
    {
        $this->languages = $configResolver->getParameter( 'languages' );
    }
}</pre></td></tr></table><h3><strong style="color: rgb(0,98,147);font-size: 16.0px;line-height: 1.5625;">After, with setter injection (preferred)</strong></h3><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="e78978ed-e8c6-4bbb-b30c-3edda61e7e2b" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>parameters:
    acme_test.my_service.class: Acme\TestBundle\MyServiceClass

services:
    acme_test.my_service:
        class: %acme_test.my_service.class%
        calls:
            - [setLanguages, ["$languages$"]]
</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="a8237de4-d8f3-4b44-af61-d2128f371466" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\TestBundle;

class MyServiceClass
{
    /**
 * Prioritized languages
 *
 * @var array
 */
    private $languages;

    public function setLanguages( array $languages = null )
    {
        $this->languages = $languages;
    }
}</pre></td></tr></table><p>Â </p><div class="highlight highlight-php"><p>Â </p><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="b2bf7539-9201-4ab0-bab6-c4de41629fcf" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingca13.png?definition=e3dhcm5pbmd9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><strong>Important</strong>: Ensure you always add <code>null</code> as a default value, especially if the argument is type-hinted.</p></td></tr></table><h3><strong style="color: rgb(0,98,147);font-size: 16.0px;line-height: 1.5625;">After, with constructor injection</strong></h3></div><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="1ebd8783-f2a8-4cb6-a3d8-88f4a818b8a2" data-macro-parameters="language=bash" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading174f.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>parameters:
    acme_test.my_service.class: Acme\TestBundle\MyServiceClass

services:
    acme_test.my_service:
        class: %acme_test.my_service.class%
        arguments: ["$languages$"]</pre></td></tr></table><p>Â </p><div class="highlight highlight-yaml"><p>Â </p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="cd96beac-3fe6-4ca8-9f63-0d255dc4a38f" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\TestBundle;

class MyServiceClass
{
    /**
 * Prioritized languages
 *
 * @var array
 */
    private $languages;

    public function __construct( array $languages )
    {
        $this->languages = $languages;
    }
}</pre></td></tr></table><p>Â </p></div><div class="highlight highlight-php"><p>Â </p><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="56fd5c5b-a4f3-4d4a-8f3f-1b91e8836a7c" data-macro-parameters="title=Tip" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading6668.png?definition=e3RpcDp0aXRsZT1UaXB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Setter injection for dynamic settings should always be preferred, as it makes it possible to update your services that depend on them when ConfigResolver is updating its scope (e.g. when previewing content in a given SiteAccess). <strong>However, only one dynamic setting should be injected by setter</strong><span>.</span></p><p><strong>Constructor injection will make your service be reset in that case.</strong></p></td></tr></table><h3><span style="color: rgb(0,98,147);">Injecting 3rd party parameters</span></h3></div><div class="highlight highlight-yaml"><p>Â </p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="4928771a-fd96-4f2e-99e7-cd4bd334312b" data-macro-parameters="language=bash" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading174f.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>parameters:
    acme_test.my_service.class: Acme\TestBundle\MyServiceClass
    # "acme" is our parameter namespace.
    # Null is the default value.
    acme.default.some_parameter: ~
    acme.ezdemo_site.some_parameter: foo
    acme.ezdemo_site_admin.some_parameter: bar
Â 
services:
    acme_test.my_service:
        class: %acme_test.my_service.class%
        # The following argument will automatically resolve to the right value, depending on the current SiteAccess.
        # We specify "acme" as the namespace we want to use for parameter resolving.
        calls:
            - [setSomeParameter, ["$some_parameter;acme$"]]</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="3cbf5a9f-8cf9-4b65-8c92-8e10a0f5916d" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\TestBundle;
class MyServiceClass
{
    private $myParameter;
    public function setSomeParameter( $myParameter = null )
    {
        // Will be "foo" for ezdemo_site, "bar" for ezdemo_site_admin, or null if another SiteAccess.
        $this->myParameter = $myParameter;
    }
}</pre></td></tr></table><p>Â </p></div><div class="highlight highlight-php"><pre>Â </pre></div>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=30711196 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:02:45 GMT -->
</html>
