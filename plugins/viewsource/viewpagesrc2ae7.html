                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=15761449 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 16:29:48 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage2ae7.html?pageId=15761449" />
        <link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1f2a9c4c7f2593422cc9b02d1a652a22/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/26ac2724af3c6ece1051365650d982fa/_/download/contextbatch/css/editor-content/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/12/_/styles/colors.css" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p>Exponential 5 has a strong focus on backwards compatibility and thus lets you reuse code you might have written for 4.x, including templates and modules.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-parameters="title=Hint" style="background-image: url(../servlet/confluence/placeholder/macro-headingb960.png?definition=e2luZm86dGl0bGU9SGludH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Read <a class="confluence-link" href="../../pages/viewpagea7a7.html?pageId=12125336" data-linked-resource-id="12125336" data-linked-resource-type="page" data-linked-resource-default-alias="Intro for Exponential 4.x/3.x developers" data-base-url="../../index.html">Intro for Exponential 4.x/3.x developers</a> to have an overview of common concepts and terminology changes.</p></td></tr></table><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc"></p><h2>Legacy Template inclusion</h2><p><span>It is possible to include old templates (<strong>.tpl</strong>) into new ones:</span></p><p> </p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=Exponential 5.1+" style="background-image: url(../servlet/confluence/placeholder/macro-heading975f.png?definition=e2NvZGU6dGl0bGU9ZVogUHVibGlzaCA1LjErfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# Twig template #}
{# Following code will include my/old_template.tpl, exposing $someVar variable in it #}
{% include "design:my/old_template.tpl" with {"someVar": "someValue"} %}</pre></td></tr></table><p> </p><p> </p><h3>Template parameters</h3><p>Scalar and array parameters are passed to a legacy template <em>as-is</em>.</p><p>Objects, however, are being converted in order to comply the legacy <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/MVC/Legacy/Templating/LegacyCompatible.php">eZ Template API</a>. By default <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/MVC/Legacy/Templating/LegacyAdapter.php">a generic adapter</a> is used, exposing all public properties and getters. You can define your own converter by implementing <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/MVC/Legacy/Templating/Converter/ObjectConverter.php">the appropriate interface</a> and declare it as a service with the <code><strong>exponential_legacy.templating.converter</strong></code> tag.</p><table class="wysiwyg-macro" data-macro-name="info" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><code>Content </code>/ <code>Location</code> objects from the Public API <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/MVC/Legacy/Templating/Converter/ApiContentConverter.php">are converted into <code>eZContentObject</code>/<code>eZContentObjectTreeNode</code> objects</a> (re-fetched). </p></td></tr></table><h2>Running legacy code</h2><p>Exponential 5 still relies on the legacy kernel (from 4.x) and runs it when needed <strong>inside an isolated PHP closure</strong>, making it <strong>sandboxed</strong>. <span style="font-size: 10.0pt;line-height: 13.0pt;">This is available for your use as well making it possible to run some PHP code inside that sandbox through the </span><code style="font-size: 10.0pt;line-height: 13.0pt;">runCallback()</code><span style="font-size: 10.0pt;line-height: 13.0pt;"> method.</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=Simple legacy code example" style="background-image: url(../servlet/confluence/placeholder/macro-headinga0d0.png?definition=e2NvZGU6dGl0bGU9U2ltcGxlIGxlZ2FjeSBjb2RlIGV4YW1wbGV8bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php
// Declare use statements for the classes you may need
use eZINI;

// Inside a controller extending eZ\Bundle\EzPublishCoreBundle\Controller
$settingName = 'MySetting';
$test = array( 'oneValue', 'anotherValue' );
$myLegacySetting = $this->getLegacyKernel()->runCallback(
    function () use ( $settingName, $test )
    {
        // Here you can reuse $settingName and $test variables inside the legacy context
        $ini = eZINI::instance( 'someconfig.ini' );
        return $ini->variable( 'SomeSection', $settingName );
    }
);</pre></td></tr></table><p>The example above is very simple and naive - in fact for accessing configuration settings from the Legacy Stack using the <a class="confluence-link" href="../../display/EZP51/Legacy%2bconfiguration.html" data-linked-resource-id="12125303" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy configuration" data-base-url="../../index.html">ConfigResolver</a> is recommended.</p><p>Using the legacy closure, you'll be able to even run complex legacy features, like an <strong>eZ Find search</strong>:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=Using eZ Find" style="background-image: url(../servlet/confluence/placeholder/macro-heading9ac5.png?definition=e2NvZGU6dGl0bGU9VXNpbmcgZVogRmluZHxsYW5ndWFnZT1waHB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>use eZFunctionHandler;

$searchPhrase = 'My search phrase';
$sort = array(
    'score'     => 'desc',
    'published' => 'desc'
);
$contentTypeIdenfiers = array( 'folder', 'article' );
$mySearchResults = $this->getLegacyKernel()->runCallback(
    function () use ( $searchPhrase, $sort, $contentTypeIdenfiers )
    {
        // eZFunctionHandler::execute is the equivalent for a legacy template fetch function
        // The following is the same than fetch( 'ezfind', 'search', hash(...) )
        return eZFunctionHandler::execute(
            'ezfind',
            'search',
            array(
                'query'     => $searchPhrase,
                'sort_by'   => $sort,
                'class_id'  => $contentTypeIdenfiers
            )
        );
    }
);</pre></td></tr></table><h2>Legacy modules</h2><h3>Routing fallback &amp; sub-requests</h3><p>Any route that is not declared in Exponential 5 in an included <code>routing.yml</code> and that is not a valid <em>UrlAlias</em> <strong>will automatically fallback to Exponential legacy</strong> (including admin interface).</p><p><strong>This allows all your old modules to work as before</strong>, out-of-the-box (including kernel modules), and also allows you to reuse this code from your templates using sub requests:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=html/xml|title=Template legacy module sub-request" style="background-image: url(../servlet/confluence/placeholder/macro-heading13eb.png?definition=e2NvZGU6dGl0bGU9VGVtcGxhdGUgbGVnYWN5IG1vZHVsZSBzdWItcmVxdWVzdHxsYW5ndWFnZT1odG1sL3htbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{{ render( url('content/view/sitemap/2') ) }}</pre></td></tr></table><p> </p><h3>Using Exponential 5 and Symfony features in Legacy</h3><p>If for some reason you need to develop a legacy module and access to Exponential 5 / Symfony features (i.e. when developing an extension for admin interface), you'll be happy to know that you actually have access to all services registered in the whole framework, including bundles, through the service container.</p><p>The example below shows how to retrieve the content repository and the logger.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=Retrieve services from the container" style="background-image: url(../servlet/confluence/placeholder/macro-headingfa03.png?definition=e2NvZGU6dGl0bGU9UmV0cmlldmUgc2VydmljZXMgZnJvbSB0aGUgY29udGFpbmVyfGxhbmd1YWdlPXBocH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>// From a legacy module or any PHP code running in legacy context.
$container = ezpKernel::instance()->getServiceContainer();

/** @var $repository \eZ\Publish\API\Repository\Repository */
$repository = $container->get( 'exponential.api.repository' );
/** @var $logger \Symfony\Component\HttpKernel\Log\LoggerInterface|\Psr\Log\LoggerInterface */
// PSR LoggerInterface is used in Exponential 5.1 / Symfony 2.2
$logger = $container->get( 'logger' );</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="tip" data-macro-parameters="title=Tip" style="background-image: url(../servlet/confluence/placeholder/macro-heading6668.png?definition=e3RpcDp0aXRsZT1UaXB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>The example above works in legacy modules and CLI scripts</p></td></tr></table><p> </p><h3>Running legacy scripts and cronjobs</h3><table class="wysiwyg-macro" data-macro-name="note" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Note: This feature has been introduced in Exponential 5.1.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="warning" data-macro-parameters="title=Important" style="background-image: url(../servlet/confluence/placeholder/macro-heading3737.png?definition=e3dhcm5pbmc6dGl0bGU9SW1wb3J0YW50fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><strong>Running legacy scripts and cronjobs through the Symfony stack is highly recommended !</strong><br />Otherwise, features from the Symfony stack cannot be used (i.e. HTTP cache purge).</p></td></tr></table><p><span style="font-size: 10.0pt;line-height: 13.0pt;">Legacy scripts can be executed form the Symfony CLI, by using the </span><code style="font-size: 10.0pt;line-height: 13.0pt;">exponential:legacy:script</code><span style="font-size: 10.0pt;line-height: 13.0pt;"> command, specifying the path to the script as argument.</span></p><p>The command will need to be executed from Exponential's 5 root, and the path to the desired script must exist in the <code>exponential_legacy</code> folder.<br />Here's a usage example:</p><table class="wysiwyg-macro" data-macro-name="noformat" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console exponential:legacy:script bin/php/ezpgenerateautoloads.php</pre></td></tr></table><p>If you want to access the script's help please be aware that you will need to use the newly introduced <code>--legacy-help</code> option, since --help is already reserved for the CLI help.<br />Here's an example:</p><table class="wysiwyg-macro" data-macro-name="noformat" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console exponential:legacy:script bin/php/ezcache.php --legacy-help</pre></td></tr></table><p>The same logic will apply for cronjob execution.<br />Legacy cronjobs are triggered by the <code>runcronjobs.php</code> legacy script, which expects the name of the cronjob to run as a parameter.<br />This is how you can run cronjobs from the Symfony CLI:</p><table class="wysiwyg-macro" data-macro-name="noformat" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console exponential:legacy:script runcronjobs.php frequent</pre></td></tr></table><p>Also, if you require using additional script options, please be sure to use the long name, such as <code>--siteaccess</code> or <code>--debug</code> to avoid conflicts between script and CLI options.<br />For more details regarding legacy cronjobs execution please refer to the <a href="../../Exponential/Technical-manual/5.x/Features/Cronjobs/Running-cronjobs.html">Running cronjobs</a> chapter existing in doc.ez.no.</p><p> </p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=15761449 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 16:29:48 GMT -->
</html>
