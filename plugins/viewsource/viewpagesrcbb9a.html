                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=30711131 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:50:15 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpagebb9a.html?pageId=30711131" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/colors82a8.css?spaceKey=TECHDOC" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/custom82a8.css?spaceKey=TECHDOC" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro3122.png?definition=e3RvYzp0eXBlPWZsYXR9&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="b80d7ea4-e031-45e1-b32b-2bb88b03d988" data-macro-parameters="type=flat" data-macro-schema-version="1"></p><h2>Adding a new Location to a Content item</h2><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="25645e64-a33a-4698-8e45-b04bf48aa507" data-macro-parameters="title=Full code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingecc6.png?definition=e2luZm86dGl0bGU9RnVsbCBjb2RlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/AddLocationToContentCommand.php">https://github.com/ezsystems/CookbookBundle/blob/master/Command/AddLocationToContentCommand.php</a></p></td></tr></table><p>We have seen earlier how you can create a Location for a newly created <code><a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Content.html">Content</a></code>. It is of course also possible to add a new <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Location.html"><code>Location</code></a> to an existing <code><a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Content.html">Content</a></code>.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="1d2b4042-29c4-4623-8d0a-3978784bb0bb" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>try
{
    $locationCreateStruct = $locationService->newLocationCreateStruct( $parentLocationId );
    $contentInfo = $contentService->loadContentInfo( $contentId );
    $newLocation = $locationService->createLocation( $contentInfo, $locationCreateStruct );
    print_r( $newLocation );
}
// Content or location not found
catch ( \eZ\Publish\API\Repository\Exceptions\NotFoundException $e )
{
    $output->writeln( $e->getMessage() );
}
// Permission denied
catch ( \eZ\Publish\API\Repository\Exceptions\UnauthorizedException $e )
{
    $output->writeln( $e->getMessage() );
}</pre></td></tr></table><p>This is the required code. As you can see, both the ContentService and the LocationService are involved. Errors are handled the usual way, by intercepting the Exceptions the used methods may throw.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="7b34c449-14f4-45f5-b45e-4f94884bdf0e" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$locationCreateStruct = $locationService->newLocationCreateStruct( $parentLocationId );</pre></td></tr></table><p>Like we do when creating a new Content item, we need to get a new <code><a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/LocationCreateStruct.html">LocationCreateStruct</a></code>. We will use it to set our new <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Location.html"><code>Location</code></a>'s properties. The new Location's parent ID is provided as a parameter to <code><a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/ContentService#method_newLocationCreateStruct" /><code><a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/LocationService.html#method_newLocationCreateStruct"><code>LocationService::newLocationCreateStruct</code></a></code></code>.</p><p>In this example, we use the default values for the various <code>LocationCreateStruct</code> properties. We could of course have set custom values, like setting the Location as hidden ($location-&gt;hidden = true), or changed the remoteId (<code>$location-&gt;remoteId = $myRemoteId</code>).</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="fafdd9f6-9e61-4374-8b58-02733ce9d460" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$contentInfo = $contentService->loadContentInfo( $contentId );</pre></td></tr></table><p>To add a Location to a Content item, we need to specify the Content, using a <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/ContentInfo.html"><code>ContentInfo</code></a> object. We load one using <code><a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentService.html#method_loadContentInfo">ContentService::loadContentInfo()</a></code>, using the Content ID as the argument.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="054a1c33-e680-472b-8a6b-a8b4ecca4bea" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$newLocation = $locationService->createLocation( $contentInfo, $locationCreateStruct );</pre></td></tr></table><p>We finally use <code>LocationService::createLocation()</code>, providing the <code>ContentInfo</code> obtained above, together with our <code>LocationCreateStruct</code>. The method returns the newly created Location Value Object.</p><h2>Hide/Unhide Location</h2><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="acbe1f6f-02fc-44b6-8ae0-6453d1015306" data-macro-parameters="title=Full code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingecc6.png?definition=e2luZm86dGl0bGU9RnVsbCBjb2RlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/HideLocationCommand.php">https://github.com/ezsystems/CookbookBundle/blob/master/Command/HideLocationCommand.php</a></p></td></tr></table><p>We mentioned earlier that a Location's visibility could be set while creating the Location, using the hidden property of the LocationCreateStruct. Changing a Location's visibility may have a large impact in the Repository: doing so will affect the Location's subtree visibility. For this reason, a <code>LocationUpdateStruct</code> doesn't let you toggle this property. You need to use the <code>LocationService</code> to do so.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="e01e6897-c5db-48e2-bad6-c3a0a6bb1496" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$hiddenLocation = $locationService->hideLocation( $location );
$unhiddenLocation = $locationService->unhideLocation( $hiddenLocation );</pre></td></tr></table><p>There are two methods for this: <code>LocationService::hideLocation</code>, and <code>LocationService::unhideLocation()</code>. Both expect the <code>LocationInfo</code> as their argument, and return the modified Location Value Object.</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="f73b08c3-65cf-49c7-8492-6c564a76fb01" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>The explanation above is valid for most Repository objects. Modification of properties that affect other parts of the system will require that you use a custom service method.</p></td></tr></table><h2>Deleting a Location</h2><p>Deleting Locations can be done in two ways: delete, or trash. </p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="a1f0110d-4ccc-4c11-ad0e-d3596f4e399c" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$locationService->deleteLocation( $locationInfo );</pre></td></tr></table><p><a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/LocationService.html#method_deleteLocation"><code>LocationService::deleteLocation()</code></a> will permanently delete the Location, as well as all its descendants. Content that has only one Location will be permanently deleted as well. Those with more than one won't be, as they are still referenced by at least one Location.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="8a7f7ddc-76a3-40b7-be22-b01527d28d2f" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$trashService->trash( $locationInfo );</pre></td></tr></table><p><code><a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/TrashService.html#method_trash">TrashService::trash()</a></code> will send the Location as well as all its descendants to the Trash, where they can be found and restored until the Trash is emptied. Content isn't affected at all, since it is still referenced by the trash items.</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="5683919f-ab5e-40dd-af95-b6863bb530ed" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>The <code><a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/TrashService.html">TrashService</a></code> can be used to list, restore and delete Locations that were previously sent to Trash using <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/TrashService.html#method_trash"><code>TrashService::trash()</code></a>.</p></td></tr></table><h2>Setting a content item's main Location</h2><p>This is done using the <code>ContentService</code>, by updating the <code>ContentInfo</code> with a <code>ContentUpdateStruct</code> that sets the new main location:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="a6b3ee7c-6ecf-4585-8166-fea47f3657f6" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$repository = $this->getContainer()->get( 'exponential.api.repository' );
$contentService = $repository->getContentService();
$contentInfo = $contentService->loadContentInfo( $contentId );

$contentUpdateStruct = $contentService->newContentMetadataUpdateStruct();
$contentUpdateStruct->mainLocationId = 123;

$contentService->updateContentMetadata( $contentInfo, $contentUpdateStruct );</pre></td></tr></table><p>Credits to <a class="confluence-link confluence-userlink user-mention" data-username="arnottg" href="../../login47b7.html" data-linked-resource-id="13467887" data-linked-resource-version="1" data-linked-resource-type="userinfo" userkey="8aff630541b7a8370141b7a906690034" data-linked-resource-default-alias="Gareth Arnott" data-base-url="../../index.html">Gareth Arnott</a> for the snippet.</p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=30711131 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:50:15 GMT -->
</html>
