                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12781235 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 13:48:02 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage868d.html?pageId=12781235" />
        <link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1f2a9c4c7f2593422cc9b02d1a652a22/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/26ac2724af3c6ece1051365650d982fa/_/download/contextbatch/css/editor-content/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/12/_/styles/colors.css" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macrob964.png?definition=e2V4Y2VycHQtaW5jbHVkZTplWiBQdWJsaXNoIERvY3VtZW50YXRpb259&amp;locale=en_GB&amp;version=2" data-macro-name="excerpt-include" data-macro-default-parameter="Exponential Documentation"></p><p>For better integration between 5.x (symfony based) kernel and legacy (4.x) kernel, injection is used to inject <a class="confluence-link" href="../../display/EZP51/Legacy%2bconfiguration%2binjection.html" data-linked-resource-id="12125304" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy configuration injection" data-base-url="../../index.html">settings</a>, <a class="confluence-link" href="../../display/EZP51/Legacy%2bsession%2binjection.html" data-linked-resource-id="12125313" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy session injection" data-base-url="../../index.html">session</a> and <a class="confluence-link" href="../../display/EZP51/Legacy%2bsiteaccess%2binjection.html" data-linked-resource-id="12125315" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy siteaccess injection" data-base-url="../../index.html">current siteaccess</a> from 5.x into legacy using an event: kernel.event_subscriber</p><p>This page describe how you can do that.  </p><h2>Adding a kernel.event_subscriber</h2><p>A legacy kernel event subscriber is added by tagging your event subscriber service.<br /><br />Bellow is an example of yml configuration involved:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=kernel.event_subscriber" style="background-image: url(../servlet/confluence/placeholder/macro-heading72ac.png?definition=e2NvZGU6dGl0bGU9a2VybmVsLmV2ZW50X3N1YnNjcmliZXJ9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>    my_app.legacy_mapper.something:
        class: %my_app.legacy_mapper.something.class%
        arguments: [@service_container]
        tags:
            - { name: kernel.event_subscriber }</pre></td></tr></table><p> </p><p>The class refered to as <span style="font-size: 10.0pt;line-height: 13.0pt;">%</span><span style="font-size: 10.0pt;line-height: 13.0pt;">my_app.legacy_mapper.something</span><span style="font-size: 10.0pt;line-height: 13.0pt;">.class% can look like this:</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=my_app.legacy_mapper.something.class" style="background-image: url(../servlet/confluence/placeholder/macro-headingf51e.png?definition=e2NvZGU6dGl0bGU9bXlfYXBwLmxlZ2FjeV9tYXBwZXIuc29tZXRoaW5nLmNsYXNzfGxhbmd1YWdlPXBocH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace MyApp\LegacyMapper;
use eZ\Publish\Core\MVC\Legacy\LegacyEvents;
use eZ\Publish\Core\MVC\Legacy\Event\PreBuildKernelWebHandlerEvent;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;
/**
 * Maps something into Legacy kernel
 */
class Something implements EventSubscriberInterface
{
    /**
     * @var \Symfony\Component\DependencyInjection\ContainerInterface
     */
    private $container;
 
   /**
    * @param \Symfony\Component\DependencyInjection\ContainerInterface $container
    */
    public function __construct( ContainerInterface $container )
    {
        $this->container = $container;
    }
    public static function getSubscribedEvents()
    {
        return array(
            LegacyEvents::PRE_BUILD_LEGACY_KERNEL_WEB => array( 'onBuildKernelWebHandler', 128 )
        );
    }
    /**
     * Maps matched siteaccess to the legacy parameters
     *
     * @param \eZ\Publish\Core\MVC\Legacy\Event\PreBuildKernelWebHandlerEvent $event
     *
     * @return void
     */
    public function onBuildKernelWebHandler( PreBuildKernelWebHandlerEvent $event )
    {
        // Do something, see eZ\Bundle\EzPublishLegacyBundle\LegacyMapper\* for examples
        // Example for injecting some settings:
 
        $settings = array(
            'site.ini/Block/Setting' => $this->container->getParameter( 'some.setting' ),
            'site.ini/Block/Setting2' => $this->configResolver->getParameter( 'some.setting2' )
        );
 
        $event->getParameters()->set(
            "injected-settings",
            $settings + (array)$event->getParameters()->get( "injected-settings" )
        );
    }
}

</pre></td></tr></table><p><span style="font-size: 10.0pt;line-height: 13.0pt;"><br /></span></p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12781235 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 13:48:02 GMT -->
</html>
