                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=15204463 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:08:12 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage6b00.html?pageId=15204463" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/51/_/styles/colorsb538.css?spaceKey=EZP" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/51/_/styles/customb538.css?spaceKey=EZP" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p><img class="editor-inline-macro" height="18" width="88" src="../servlet/status-macro/placeholdercba1.png?title=EZP+5.2+%2F+2013.07&amp;colour=Yellow" data-macro-name="status" data-macro-id="7b4a3d01-c191-4244-b106-562a008ab734" data-macro-parameters="colour=Yellow|title=EZP 5.2 / 2013.07" data-macro-schema-version="1"></p><table class="wysiwyg-macro" data-macro-name="excerpt" data-macro-id="89330d0e-2c8a-4c3e-a09d-40ffca11582d" data-macro-parameters="atlassian-macro-output-type=BLOCK" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading08d0.png?definition=e2V4Y2VycHQ6YXRsYXNzaWFuLW1hY3JvLW91dHB1dC10eXBlPUJMT0NLfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="c7fb7790-d42a-41ca-8c86-0fcd7234ee42" data-macro-parameters="title=Version compatibility" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading77d5.png?definition=e25vdGU6dGl0bGU9VmVyc2lvbiBjb21wYXRpYmlsaXR5fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>This recipe is compatible with <strong>Exponential 5.2 / 2013.07</strong></p></td></tr></table></td></tr></table><p> </p><h1>Custom tags</h1><p><strong>XMLText fieldtype</strong> supports a limited number of tags in its internal eZXML format to render HTML5. However, it is possible to extend the rendering by implementing <strong>custom tags</strong>.</p><p>As HTML5 rendering in Exponential is done through <a href="http://en.wikipedia.org/wiki/XSLT">XSLT</a>, you will need to create an XSL stylesheet to extend the rendering.</p><p> </p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="7ec92f38-ef20-41f0-90b2-48d9b7edb49a" data-macro-parameters="title=Note on legacy custom tags" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingeaa1.png?definition=e2luZm86dGl0bGU9Tm90ZSBvbiBsZWdhY3kgY3VzdG9tIHRhZ3N9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>To be able to edit a custom tag from admin interface, you'll still need to <a href="../../Exponential/Technical-manual/4.x/Reference/Datatypes/XML-block/Custom-tags.html">register your custom tag in the legacy kernel</a> (at least the configuration part, template not being mandatory for edition).</p></td></tr></table><p><br /><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="b9a5cfb3-0c6a-4d3b-9cbd-387fb1fb5039" data-macro-schema-version="1"></p><h2>Register your custom XSL stylesheet</h2><p>To activate your custom tag rendering, you need to create an XSL stylesheet and to register it properly:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="1b299a9d-0da1-4758-8034-83842eef07c1" data-macro-parameters="title=exponential.yml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bc7.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential:
    system:
        my_siteaccess:
            fieldtypes:
                ezxml:
                    custom_tags:
                        # Adding exponential/Resources/my_custom.xsl (priority defaults to 0).
                        - { path: %kernel.root_dir%/Resources/my_custom.xsl }
                        # Adding src/Acme/TestBundle/Resources/another_custom.xsl with priority 10.
                        - { path: %kernel.root_dir%/../src/Acme/TestBundle/Resources/another_custom.xsl, priority: 10 }</pre></td></tr></table><p>Each entry under <code>custom_tags</code> is a hash having the following properties:</p><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><code>path</code></th><td class="confluenceTd"><p><strong>Absolute path</strong> to the XSL to import.</p><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="81a45baf-20a8-448b-8ea6-74612c9aeb50" data-macro-parameters="title=Tip" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading6668.png?definition=e3RpcDp0aXRsZT1UaXB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><span style="color: rgb(0,51,102);">Use </span><code>%kernel.root_dir%</code><span style="color: rgb(0,51,102);"> parameter to start from </span><code>exponential/</code><span style="color: rgb(0,51,102);"> folder.</span></p></td></tr></table></td></tr><tr><td class="highlight-grey confluenceTd" data-highlight-colour="grey"><code><strong>priority</strong></code></td><td class="confluenceTd"><p>Priority of your stylesheet in the sequence of importing. The higher it is, the higher precedence it will have.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="e5f87d9f-6cc1-478b-85a7-ad41d76a10c3" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>In XSL imports, in case of template overrides, the last imported XSL always wins. Hence custom XSL are loaded in reverse priority order.</p></td></tr></table></td></tr></tbody></table><h3>Example of a custom XSL</h3><p>The following example shows how to render the <a href="https://github.com/lolautruche/jvEmbedTag/blob/master/design/standard/templates/content/datatype/view/ezxmltags/youtube.tpl">YouTube embed custom tag from jvEmbed legacy extension</a> (see also <a href="https://github.com/lolautruche/jvEmbedTag/blob/master/settings/content.ini.append.php">related legacy configuration for content</a>).</p><p>Note that all selected attributes are in <code>custom</code> namespace (this is the case for all custom tags attributes in internal eZXML).</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="d1ba8451-e851-44bb-8383-bf86263b80c7" data-macro-parameters="language=html/xml|title=youtube.xsl" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading4150.png?definition=e2NvZGU6bGFuZ3VhZ2U9aHRtbC94bWx8dGl0bGU9eW91dHViZS54c2x9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;xsl:stylesheet
        version="1.0"
        xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:xhtml="http://ez.no/namespaces/exponential3/xhtml/"
        xmlns:custom="http://ez.no/namespaces/exponential3/custom/"
        xmlns:image="http://ez.no/namespaces/exponential3/image/"
        exclude-result-prefixes="xhtml custom image">

    &lt;xsl:output method="html" indent="yes" encoding="UTF-8"/>
 
    &lt;!-- Template below will match the following custom tag: -->
    &lt;!-- &lt;custom name="youtube" custom:video="//www.youtube.com/embed/MfOnq-zXXBw" custom:videoWidth="640" custom:videoHeight="380"/> -->
    &lt;xsl:template match="custom[@name='youtube']">
        &lt;div class="jvembed jvembed-youtube">
            &lt;iframe>
                &lt;xsl:attribute name="width">&lt;xsl:value-of select="@custom:videoWidth"/>&lt;/xsl:attribute>
                &lt;xsl:attribute name="height">&lt;xsl:value-of select="@custom:videoHeight"/>&lt;/xsl:attribute>
                &lt;xsl:attribute name="src">&lt;xsl:value-of select="@custom:video"/>&lt;/xsl:attribute>
                &lt;xsl:attribute name="frameborder">0&lt;/xsl:attribute>
                &lt;xsl:attribute name="allowfullscreen"/>
            &lt;/iframe>
        &lt;/div>
    &lt;/xsl:template>
&lt;/xsl:stylesheet></pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="0bc11303-539d-4f77-9769-6163cb0f28f2" data-macro-parameters="title=Tip" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading6668.png?definition=e3RpcDp0aXRsZT1UaXB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>PHP functions are registered in the XSLTProcessor, so you can use global PHP functions and static method calls to enhance the XSLT process (using <code>php-function</code> and <code>php-functionString</code> XSLT functions, see <a href="http://php.net/manual/en/xsltprocessor.registerphpfunctions.php">further info</a>).</p><p>However, given this is only for static PHP code,<strong> it is only suitable for very simple use cases!</strong> For most use cases, where you need to inject some service for your logic, for instance Repository, you'll need to use <strong>Pre-Converters</strong> instead (see below).</p></td></tr></table><h2>Using Pre-converters</h2><p>Pre-converters are services that pre-process the internal XML before the XSLT rendering occurs. It can be useful if you need to manipulate the data stored in eZXML.</p><p>An example of use is <a href="https://github.com/lolautruche/EmbedTagBundle/blob/master/Converter/XmlText/VideoPreConverter.php">what is done in the EmbedTagBundle for videos</a> : video links are transformed in embed links.</p><p>Pre-converters receive the whole DOMDocument object for the current field. So you can easily do XPath queries and do some DOM manipulation against it.</p><h3>Registering a pre-converter</h3><p>All pre-converters need to:</p><ul><li>Implement <span><a><code>eZ\Publish\Core\FieldType\XmlText\Converter</code></a> interface.</span></li><li><span>Be registered as a service, with <code>exponential.ezxml.converter</code> tag.</span></li></ul><div><p> </p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="fbdb14bc-060e-4777-bd7f-9a26a2a257d3" data-macro-parameters="title=services.yml in a bundle" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading2258.png?definition=e2NvZGU6dGl0bGU9c2VydmljZXMueW1sIGluIGEgYnVuZGxlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>parameters:
    my.ezxml.pre_converter.class: Acme\TestBundle\XmlText\MyPreConverter
 
services:
    my.ezxml.pre_converter:
        class: %my.ezxml.pre_converter.class%
        arguments: [@someDependency, @someOtherDependency]
        tags:
            - { name: exponential.ezxml.converter }</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="03c1c3bd-8a84-4257-a37d-65ebe7a0addc" data-macro-parameters="language=php|title=MyPreConverter" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingcfaa.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPU15UHJlQ29udmVydGVyfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php

namespace Acme\TextBundle\XmlText;

use eZ\Publish\Core\FieldType\XmlText\Converter;
use DOMDocument;

class MyPreConverter implements Converter
{
    public function __construct( $someDependency, $someOtherDependency )
    {
        // ...
    }

    /**
     * Does a partial conversion work on $xmlDoc.
     *
     * @param \DOMDocument $xmlDoc
     *
     * @return null
     */
    public function convert( DOMDocument $xmlDoc )
    {
        // Do something on $xmlDoc
        // You can for example walk through the DOM, do XPath queries, add/modify attributes...
    }
}

</pre></td></tr></table><h2>Overriding existing XSL templates</h2><p>As XSL stylesheets apply for the whole resulted DOM, you can of course override existing templates. This is where the <code>priority</code> property in configuration takes its sense.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="addd6d96-105d-48dc-952f-e6413f487ddd" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Built-in XSL templates have <strong>0</strong> as priority</p></td></tr></table><p> </p><p>Consider the following example to switch from usage of <code>&lt;b&gt;</code> to <code>&lt;strong&gt;</code>:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="a3302656-fc36-4d2d-b44e-2772145f9b54" data-macro-parameters="language=html/xml|title=strong.xsl" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading75a6.png?definition=e2NvZGU6bGFuZ3VhZ2U9aHRtbC94bWx8dGl0bGU9c3Ryb25nLnhzbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;xsl:stylesheet
        version="1.0"
        xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:xhtml="http://ez.no/namespaces/exponential3/xhtml/"
        xmlns:custom="http://ez.no/namespaces/exponential3/custom/"
        xmlns:image="http://ez.no/namespaces/exponential3/image/"
        exclude-result-prefixes="xhtml custom image">
 
    &lt;!-- Original template transforms into &lt;b> -->
    &lt;xsl:template match="strong">
        &lt;strong>
            &lt;xsl:copy-of select="@*"/>
            &lt;xsl:apply-templates/>
        &lt;/strong>
    &lt;/xsl:template>

&lt;/xsl:stylesheet></pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="6a1acbe7-5a8c-4418-b80c-b25da3904422" data-macro-parameters="title=exponential.yml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bc7.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential:
    system:
        my_siteaccess:
            fieldtypes:
                ezxml:
                    custom_tags:
                        # Adding a higher priority to ensure built-in template will be overriden.
                        - { path: %kernel.root_dir%/Resources/strong.xsl, priority: 10 }</pre></td></tr></table></div>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=15204463 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:08:12 GMT -->
</html>
