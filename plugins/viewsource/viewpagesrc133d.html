                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=31428832 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:59:06 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage133d.html?pageId=31428832" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/colors82a8.css?spaceKey=TECHDOC" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/8/_/styles/custom82a8.css?spaceKey=TECHDOC" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p>This page explains how to update between minor or patch versions of eZ Platform.</p><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="96f014cd-86f2-4a62-bb54-a7ad3b04d18d" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading7f8c.png?definition=e3RpcH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>If you are looking for information on how to upgrade to eZ Platform from Exponential (4.x or 5.x), take look at the <a class="confluence-link" href="../../display/TECHDOC/Upgrade.html" data-linked-resource-id="30712109" data-linked-resource-version="15" data-linked-resource-type="page" data-linked-resource-default-alias="Upgrade" data-base-url="../../index.html">Upgrade</a> doc.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="7628c842-3db3-4aa8-ae05-76faba93c9b0" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>This instruction reflects a proposed git-based workflow for handling updates; feedback on how this works in practice and input on how to further improve/simplify it is welcome.</p></td></tr></table><p>In the instructions below, replace<code> &lt;version&gt;</code> with the version of eZ Platform you are updating to (for example: <code>v1.2.0</code>).</p><p>If you are testing a release candidate, use the<a href="https://github.com/ezsystems/ezplatform/releases"> latest rc tag</a> (for example: <code>v1.2.1-rc1</code>).</p><p> </p><h2>Update procedure</h2><p>Existing projects can easily be updated using Composer. From the project's root, create a new branch from the project's master, or from the branch you're upgrading on:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="6101b553-5e22-4dec-b3ea-6a88db2ed64e" data-macro-parameters="language=bash|title=From your master branch" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading7b81.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1Gcm9tIHlvdXIgbWFzdGVyIGJyYW5jaH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>git checkout -b &lt;branch_name></pre></td></tr></table><p>If it's not there, add <code>ezsystems/ezplatform</code> as an upstream remote:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="d9679aec-0c64-4842-a87a-037740396d17" data-macro-parameters="language=bash|title=From your new update branch" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinge13e.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1Gcm9tIHlvdXIgbmV3IHVwZGF0ZSBicmFuY2h9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>git remote add ezplatform http://github.com/ezsystems/ezplatform.git</pre></td></tr></table><p>Then pull the tag into your branch:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="27eb17a2-77dc-4b0f-a9fa-be2fc7b793a7" data-macro-parameters="language=bash|title=From your new update branch" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinge13e.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1Gcm9tIHlvdXIgbmV3IHVwZGF0ZSBicmFuY2h9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>git pull ezplatform &lt;version></pre></td></tr></table><p>You will get conflicts, and it is perfectly normal. The most common ones will be on <code>composer.json</code> and <code>composer.lock</code>.<br />The latter can be ignored, as it will be regenerated when we execute composer update later. The easiest is to checkout the version from the tag, and add it to the changes:</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="a98142c8-110a-45e4-bd50-a342ac53c9ad" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>If you get a <strong>lot</strong> of conflicts (on the <code>doc</code> folder for instance), and eZ Platform was installed from the <a href="http://share.ez.no/">share.ez.no</a> tarball, it might be because of incomplete history. You will have to run <code>git fetch ezplatform --unshallow</code> to load the full history, and run the merge again.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="f911a995-c9f0-43ab-a81a-2367adad5e32" data-macro-parameters="language=bash|title=From your new update branch" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinge13e.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1Gcm9tIHlvdXIgbmV3IHVwZGF0ZSBicmFuY2h9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>git checkout --theirs composer.lock &amp;&amp; git add composer.lock</pre></td></tr></table><p>You may also run <code>git remove composer.lock</code> if you do not keep a copy of it in the branch.</p><h3>Merging composer.json</h3><h4>Manual merging</h4><p>Conflicts in <code>composer.json</code> need to be fixed manually. If you're not familiar with the diff output, you may checkout the tag's version, and inspect the changes. It should be readable for most:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="a01dc9c6-a913-4c46-aded-cefba6faeff4" data-macro-parameters="language=bash|title=From your new update branch" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinge13e.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1Gcm9tIHlvdXIgbmV3IHVwZGF0ZSBicmFuY2h9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>git checkout --theirs composer.json &amp;&amp; git diff composer.json</pre></td></tr></table><p>You should see what was changed, as compared to your own version, in the diff output. The ezplatform update changes the requirements for all of the <code>ezsystems/</code> packages. Those changes should be left untouched. All of the other changes will be removals of what you added for your own project. Use <code>git checkout -p</code> to selectively cancel those changes:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="91385cea-1705-429b-880c-09d80206db44" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>git checkout -p composer.json</pre></td></tr></table><p>Answer <code>no</code> (do not discard) to the requirement changes of <code>ezsystems</code> dependencies. Answer <code>yes</code> (discard) to removals of your changes.</p><p>Once you are done, inspect the file, either using an editor or by running <code>git diff composer.json</code>. You may also test the file's sanity with <code>composer validate</code>, and test the dependencies by running <code>composer update --dry-run</code>. (will output what it would do to dependencies, without applying the changes.</p><p>Once finished, run <code>git add composer.json.</code></p><h4><span style="color: rgb(0,98,147);">Fixing other conflicts (if any)</span></h4><p>Depending on the local changes you have done, you may get other conflicts: configuration files, kernel... </p><p>There shouldn't be many, and you should be able to figure out which value is the right one for all of them:</p><ul><li>Edit the file, and identify the conflicting changes. If a setting you have modified has also been changed by us, you should be able to figure out which value is the right one.</li><li>Run <code>git add conflicting-file</code> to add the changes</li></ul><h3>Updating composer.lock</h3><p>At this point, you should have a composer.json file with the correct requirements. Run <code>composer update</code> to update the dependencies. </p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="f0b7e998-fc67-41ea-a004-a51133040432" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>composer update --with-dependencies ezsystems/exponential-kernel ezsystems/platform-ui-bundle ezsystems/behatbundle</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="8ffc1b37-de31-4ecc-94e7-d06782c4f558" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>In order to restrict the possibility of unforeseen updates of 3rd party packages, we recommend by default that <code>composer update</code> is restricted to the list of packages we have tested the update for. You may remove this restriction, but be aware that you might get a package combination we have not tested.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="3c662de4-5a0e-4590-916a-5339e486d8ea" data-macro-parameters="icon=false" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingf415.png?definition=e2luZm86aWNvbj1mYWxzZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><h3>When updating from 15.12.1 or earlier to 16.02 or later</h3><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="3c4a889a-737f-4a69-973d-831324282005" data-macro-parameters="title=On PHP conflict" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading989f.png?definition=e2luZm86dGl0bGU9T24gUEhQIGNvbmZsaWN0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Because from release 16.02 onwards eZ Platform is compatible only with PHP 5.5 and higher, the update command above will fail if you use an older PHP version. Please update PHP to proceed.</p></td></tr></table><h4>Database update</h4><p>The 16.02 release required an update to the database. Import <code>vendor/ezsystems/exponential-kernel/data/update/mysql/dbupdate-6.1.0-to-6.2.0.sql</code> into your database:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="0339bf6f-2b42-41a3-8f95-5575e7ec7ff5" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>mysql -u&lt;username> -p&lt;password> &lt;database_name> &lt; vendor/ezsystems/exponential-kernel/data/update/mysql/dbupdate-6.1.0-to-6.2.0.sql</pre></td></tr></table></td></tr></table><h3>Dump assets</h3><p>The web assets must be dumped again for the prod environment:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="8ddecac2-f6c0-4525-8270-8e0062dca7e4" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php app/console assetic:dump --env=prod web</pre></td></tr></table><h3>Commit, test and merge</h3><p>Once all the conflicts have been resolved, and <code>composer.lock</code> updated, the merge can be committed. Note that you may or may not keep <code>composer.lock</code>, depending on your version management workflow. If you do not wish to keep it, run <code>git reset HEAD &lt;file&gt;</code> to remove it from the changes. Run <code>git commit</code>, and adapt the message if necessary. You can now test the project, run integration tests... once the upgrade has been approved, go back to <code>master</code>, and merge your new update branch:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="817de460-3a72-4a6b-8cd8-fecc76a0ee28" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>git checkout master
git merge &lt;branch_name></pre></td></tr></table><p> </p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=31428832 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:59:07 GMT -->
</html>
