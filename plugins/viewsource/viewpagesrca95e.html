                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12781716 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 16:48:57 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpagea95e.html?pageId=12781716" />
        <link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1f2a9c4c7f2593422cc9b02d1a652a22/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/26ac2724af3c6ece1051365650d982fa/_/download/contextbatch/css/editor-content/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/12/_/styles/colors.css" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <table class="wysiwyg-macro" data-macro-name="info" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body">Persistence cache is a new feature introduced in 5.1. It does not exists in previous versions.</td></tr></table><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc"></p><h3>Tech Note</h3><p>Current implementation uses a caching library called <a href="http://stash.tedivm.com/">Stash</a>, via <a href="https://github.com/tedivm/TedivmStashBundle">Stash-bundle</a>. If this changes, then the configuration format will most likely change as well. <span style="font-size: 10.0pt;line-height: 13.0pt;">Stash supports the following cache handlers: </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">FileSystem</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">, </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">Memcache</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">, </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">APC</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">, </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">Sqlite</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">, </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">XCache</strong><span style="font-size: 10.0pt;line-height: 13.0pt;"> and </span><strong style="font-size: 10.0pt;line-height: 13.0pt;">BlackHole</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">.</span></p><h1>Configuration</h1><p>During Setup wizard and manually using <code>exponential:configure</code> console command a default configuration is generated currently <strong>using FileSystem</strong>, using <code>%kernel.cache_dir%/stash</code> to store cache files. It falls back to <em>BlackHole</em>, a non caching cache handler.</p><p>The configuration is placed in exponential/config/exponential.yml, and looks like:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=Default exponential.yml" style="background-image: url(../servlet/confluence/placeholder/macro-heading1220.png?definition=e2NvZGU6dGl0bGU9RGVmYXVsdCBlenB1Ymxpc2gueW1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            handlers:
                - FileSystem
            inMemory: false
            registerDoctrineAdapter: false</pre></td></tr></table><p>The default settings used during setup wizard as found in <code>exponential/config/exponential_setup.yml</code>:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=exponential_setup.yml" style="background-image: url(../servlet/confluence/placeholder/macro-heading73b8.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoX3NldHVwLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            handlers:
                - BlackHole
            inMemory: true
            registerDoctrineAdapter: false</pre></td></tr></table><p>This setting works across all installs and just caches objects within the same request thanks to the <code>inMemory: true</code> setting.</p><p>If you want to change to another handler, see below for what kind of settings you have available.</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=Note for multiple sites installation" style="background-image: url(../servlet/confluence/placeholder/macro-headingf8d5.png?definition=e25vdGU6dGl0bGU9Tm90ZSBmb3IgbXVsdGlwbGUgc2l0ZXMgaW5zdGFsbGF0aW9ufQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>As cache configuration is global to the application, it's currently not possible to have different cache configuration by siteaccess. As such, when having multiple websites <strong>using different content repositories</strong>, you must only use the <code>BlackHole</code> handler with <code>inMemory</code> caching:</p><table class="wysiwyg-macro" data-macro-name="code" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            handlers: [BlackHole]
            inMemory: true
            registerDoctrineAdapter: false</pre></td></tr></table><p>This will result to the same persistence cache strategy as in Exponential 4.x.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=Note for &quot;inMemory&quot; cache with long running scripts" style="background-image: url(../servlet/confluence/placeholder/macro-headinged13.png?definition=e25vdGU6dGl0bGU9Tm90ZSBmb3IgImluTWVtb3J5IiBjYWNoZSB3aXRoIGxvbmcgcnVubmluZyBzY3JpcHRzfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Use of <code>inMemory</code> caching with BlackHole or any other cache handler should not be used for long running scripts as it will over time return stale data (inMemory cache is not shared across requests/processes, so invalidation does not happen)!</p></td></tr></table><h3>After upgrading Exponential</h3><table class="wysiwyg-macro" data-macro-name="note" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><strong>Important note:</strong> After performing an upgrade please be aware that the persistence cache won't be set, as this is a new feature introduced in Exponential 5.1.</p></td></tr></table><p>To enable persistence cache you should either regenerate your <code>yml</code> configurations or add the cache section into your <code>exponential.yml</code> file manually, as exemplified above.</p><p>Also please note that regenerating the <code>yml</code> configurations will remove any customizations done.<br />To avoid configuration loss be sure to use the <code>--backup</code>parameter when running the <span style="font-size: 10.0pt;line-height: 13.0pt;">exponential:configure </span><span style="font-size: 10.0pt;line-height: 13.0pt;">console command, as shown in the following example:</span></p><table class="wysiwyg-macro" data-macro-name="noformat" style="background-image: url(../servlet/confluence/placeholder/macro-heading8813.png?definition=e25vZm9ybWF0fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>cd /&lt;ezp5-root>
php exponential/console exponential:configure --backup --env=prod &lt;group> &lt;admin-siteaccess></pre></td></tr></table><h2>Stash handlers configuration</h2><h3>General settings</h3><p>To check which cache settings are available for your installation, run the following command in your terminal :</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=bash" style="background-image: url(../servlet/confluence/placeholder/macro-heading174f.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console config:dump-reference stash</pre></td></tr></table><h3><span>FileSystem</span></h3><p>This cache handler is using local filesystem, by default the Symfony cache folder, as this is per server, it <strong>does not support multi server (cluster) setups</strong>!</p><table class="wysiwyg-macro" data-macro-name="note" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><strong>We strongly discourage you from storing cache files on NFS</strong>, as it defeats the purpose of the cache: speed</td></tr></table><p><strong><span style="color: rgb(51,51,51);font-size: 10.0pt;line-height: 13.0pt;"><br /></span></strong></p><p><strong><span style="color: rgb(51,51,51);font-size: 10.0pt;line-height: 13.0pt;">Available settings</span></strong></p><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><code><strong>path</strong></code></td><td class="confluenceTd">The path where the cache is placed, default is <code>%kernel.cache_dir%/stash</code>, effectively <code>exponential/cache/&lt;env&gt;/stash</code></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>dirSplit</strong></code></td><td colspan="1" class="confluenceTd">Number of times the cache key should be split up to avoid having to many files in each folder, default is 2.</td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>filePermissions</strong></code></td><td colspan="1" class="confluenceTd">The permissions of the cache file, default is 0660.</td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>dirPermissions</strong></code></td><td colspan="1" class="confluenceTd">The permission of the cache file directories (see dirSplit), default is 0770.</td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>memKeyLimit</strong></code></td><td colspan="1" class="confluenceTd">Limit on how many key to path entries are kept in memory during execution at a time to avoid having to recalculate the path on key lookups, default 200.</td></tr></tbody></table><h3>APC</h3><p>This cache handler is using shard memory using APC's user cache feature, as this is per server, it <strong>does not support multi server (cluster) setups</strong>, unless you use PHP-FPM on a dedicated server (this way, user cache can be shared among all the workers in one pool).</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=Limitation" style="background-image: url(../servlet/confluence/placeholder/macro-heading39e0.png?definition=e25vdGU6dGl0bGU9TGltaXRhdGlvbn0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>As APC user cache is not shared between processes, it is not possible to clear the user cache from CLI, even if you set <span style="color: rgb(0,0,0);"><code>apc.enable_cli</code> to On</span>. <br />Hence publishing content from a command line script won't let you properly clear SPI cache.</p></td></tr></table><p> </p><p><strong>Available settings</strong></p><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><code><strong>ttl</strong></code></td><td class="confluenceTd">The time to live of the cache in seconds, default set to 500 (8.3 minutes)</td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>namespace</strong></code></td><td colspan="1" class="confluenceTd">A namespace to prefix cache keys with to avoid key conflicts with other Exponential sites on same Exponential installation, default is <code>null</code>.</td></tr></tbody></table><h3>Memcache</h3><p>This cache handler is using <a href="http://memcached.org/">Memcached, a distributed caching solution</a>, <strong>this is the only supported cache solution for multi server (cluster) setups</strong>!</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-parameters="title=Note" style="background-image: url(../servlet/confluence/placeholder/macro-headingb7a0.png?definition=e2luZm86dGl0bGU9Tm90ZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Stash supports both the php <a href="http://php.net/memcache">Memcache</a> and <a href="http://php.net/memcached">Memcached</a> extensions. <strong>However <u>Memcached is recommended</u></strong> as it is much more advanced and supports all settings below.</p><p>If you have both extensions installed, <strong>Stash will automatically choose Memcached</strong>.</p></td></tr></table><table class="confluenceTable"><tbody><tr><td colspan="1" class="confluenceTd"><code><strong>servers</strong></code></td><td colspan="1" class="confluenceTd"><p>Array of Memcached servers, with host/IP, port and weight</p><p><code><strong>server</strong></code>: Host or IP of your Memcached server<br /><code><strong>port</strong></code>: Port where Memcached is listening to (defaults to 11211)<br /><code><strong>weight</strong></code>: Weight of the server, when using several Memcached servers</p></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>prefix_key</strong></code></td><td colspan="1" class="confluenceTd"><span>A namespace to prefix cache keys with to avoid key conflicts with other Exponential sites on same Exponential installation (default is an empty string). </span><br /><span>Must be the same on all server with the same installation.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-prefix-key">See Memcached option</a><span>.</span></span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>compression</strong></code></td><td colspan="1" class="confluenceTd">default true. <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-compression">See Memcached option</a>.</td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>libketama_compatible</strong></code></td><td colspan="1" class="confluenceTd">default false.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-libketama-compatible">See Memcached option</a></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>buffer_writes</strong></code></td><td colspan="1" class="confluenceTd">default false.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-buffer-writes">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>binary_protocol</strong></code></td><td colspan="1" class="confluenceTd">default false.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-binary-protocol">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>no_block</strong></code></td><td colspan="1" class="confluenceTd">default false.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-no-block">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>tcp_nodelay</strong></code></td><td colspan="1" class="confluenceTd">default false.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-tcp-nodelay">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>connection_timeout</strong></code></td><td colspan="1" class="confluenceTd">default 1000.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-connection-timeout">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>retry_timeout</strong></code></td><td colspan="1" class="confluenceTd">default 0.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-memcached-timeout">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>send_timeout</strong></code></td><td colspan="1" class="confluenceTd">default 0.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-send-timeout">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>recv_timeout</strong></code></td><td colspan="1" class="confluenceTd">default 0.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-recv-timeout">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>poll_timeout</strong></code></td><td colspan="1" class="confluenceTd">default 1000.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-poll-timeout">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>cache_lookups</strong></code></td><td colspan="1" class="confluenceTd">default false.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-cache-lookups">See Memcached option</a><span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code><strong>server_failure_limit</strong></code></td><td colspan="1" class="confluenceTd">default 0.<span> </span><a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-server-failure-limit">See Memcached option</a><span> </span></td></tr></tbody></table><p>For in-depth information on the settings, see: <a href="http://php.net/Memcached">http://php.net/Memcached</a></p><table class="wysiwyg-macro" data-macro-name="info" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>When using Memcache handler, <strong>it's strongly recommended to also use <code>inMemory</code> cache</strong> (see example below). <br />This will help reducing network traffic between your webserver and your Memcached server.</p></td></tr></table><h4>Example with Memcache</h4><table class="wysiwyg-macro" data-macro-name="code" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            handlers: [ Memcache ]
            inMemory: true
            registerDoctrineAdapter: false
            Memcache:
                prefix_key: ezdemo_
                retry_timeout: 1
                servers:
                    -
                        server: 127.0.0.1
                        port: 11211</pre></td></tr></table>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12781716 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 16:48:57 GMT -->
</html>
