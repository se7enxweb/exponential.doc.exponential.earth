                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=31432023 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:25:56 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage2b76.html?pageId=31432023" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/6/_/styles/colors74cd.css?spaceKey=DEVELOPER" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/6/_/styles/custom74cd.css?spaceKey=DEVELOPER" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <div class="contentLayout2">
<div class="columnLayout two-right-sidebar" data-layout="two-right-sidebar">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1>Introduction</h1><h2><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro3020.png?definition=e2FuY2hvcjpMb2NhdGlvbnN9&amp;locale=en_GB&amp;version=2" data-macro-name="anchor" data-macro-id="0ac674ed-86e6-4cc8-b062-496bfeac20ac" data-macro-default-parameter="Locations" data-macro-schema-version="1">Locations</h2><p>A Content item could not function in the system without having a place – a Location – assigned to it. When a new Content item is published, a new Location is automatically created and the item is placed in it.</p><p>Together, all Locations form a tree which is the basic way of organizing Content in the system and specific to eZ products. Every published Content item has a Location and, as a consequence, also a place in this tree.</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="4d1e249e-7755-4901-a599-45d86842ce41" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><sup>A Content item receives a Location only once it has been published. This means that a freshly created draft does not have a Location yet.</sup></p></td></tr></table><p>A Content item can have more than one Location. This can be used to have the same content in two or more places in the tree, for example an article at the same time on the front page and in the archive. Even in such a case, one of these places is always the Main Location.</p><p>The tree is hierarchical, with an empty root Location (which is not assigned any Content item) and a structure of dependent Locations below it. Every Location (aside from the root) has one parent Location and can have any number of children. There are no Locations outside this tree.</p><h3>Top level Locations</h3><p>Top level Locations are direct children of the root of the tree. The root has ID Location 1, is not related to any Content items and should not be used directly.</p><p>Under this root there are preset top level Locations in each installation which cannot be deleted:</p><p><img class="confluence-embedded-image" src="../../download/attachments/31432023/content_structure_media_library471a.png?version=1&amp;modificationDate=1464091568000&amp;api=v2" data-image-src="/download/attachments/31432023/content_structure_media_library.png?version=1&amp;modificationDate=1464091568000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="32112932" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="content_structure_media_library.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="31432023" data-linked-resource-container-version="48" title="Developer > Repository > content_structure_media_library.png" data-location="Developer > Repository > content_structure_media_library.png" data-image-height="98" data-image-width="531"></p><h4>Content</h4><p>&quot;Content&quot; is the top level Location for the actual contents of a site. This part of the tree is typically used for organizing folders, articles, information pages, etc. This means that it contains the actual content structure of the site, which can be viewed by selecting the &quot;Content structure&quot; tab in the Content mode interface. The default ID number of the &quot;Content&quot; Location is 2; it references a &quot;Folder&quot; Content item.</p><h4>Media</h4><p>&quot;Media&quot; is the top level Location which stores and organizes information that is frequently used by Content items located below the &quot;Content&quot; node. It usually contains images, animations, documents and other files. They can be viewed by selecting the &quot;Media library&quot; tab in the Content mode interface. The default ID number of the &quot;Media&quot; Location is 43; it references a &quot;Folder&quot; Content item.</p><h4>Users</h4><p><img class="confluence-embedded-image" src="../../download/attachments/31432023/admin_panel_users471a.png?version=1&amp;modificationDate=1464091568000&amp;api=v2" data-image-src="/download/attachments/31432023/admin_panel_users.png?version=1&amp;modificationDate=1464091568000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="32112931" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="admin_panel_users.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="31432023" data-linked-resource-container-version="48" title="Developer > Repository > admin_panel_users.png" data-location="Developer > Repository > admin_panel_users.png" data-image-height="97" data-image-width="347"></p><p>&quot;Users&quot; is the top level Location that contains the built-in system for managing user accounts. A user is simply a Content item of the &quot;User account&quot; Content Type. The users are organized within &quot;User group&quot; Content items below this Location. In other words, the &quot;Users&quot; Location contains the actual users and user groups, which can be viewed by selecting the &quot;Users&quot; tab in the Admin Panel. The default identification number of the &quot;Users&quot; Location is 5; it references a &quot;User group&quot; Content item.</p><h4>Other top level Locations</h4><p>Another top level location, with the ID 48, corresponds to &quot;Setup&quot; and is not regularly used to store content.</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="2b41cc83-f41d-4617-9d9f-9a194b2a4cae" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>You should not add any more content directly below Location 1, but instead store any content under one of those top-level Locations.</p></td></tr></table><h3>Location visibility</h3><p>Location visibility is a mechanism which allows you to control which parts of the content tree are available to the visitor.</p><p>Given that once a Content item is published, it cannot be un-published, limiting visibility is the only method used to withdraw content from the website without moving it to Trash. When the Location of a Content item is hidden, any access to it will be denied, preventing the system from displaying it.</p><p>Visibility needs not be set individually for every Location. Instead, when a Location is hidden, all of its descendants in the tree will be hidden as well. This means that a Location can have one of three different visibility statuses:</p><ul><li><div> Visible</div></li><li><div> Hidden</div></li><li><div> Hidden by superior</div></li></ul><p>By default all Locations are Visible. If a Location is made invisible manually, its status is set to Hidden. At the same time all Locations under it will change status to Hidden by superior.</p><p>From the visitor's perspective a Location behaves the same whether its status is Hidden or Hidden by superior – it will be unavailable in the website. The difference is that a Location Hidden by superior cannot be revealed manually. It will only become visible once all of its ancestor Locations are made Visible again.</p><p>A Hidden by superior status does not override a Hidden status. This means that if a Location is Hidden manually and later one of its ancestors is Hidden as well, the first Location's status does not change – it remains Hidden (not Hidden by superior). If the ancestor Location is made visible again, the first Location still remains Hidden.</p><p>The way visibility works can be illustrated using the following scenarios:</p><h5>Hiding a visible Location</h5><p><img class="confluence-embedded-image" alt="Hiding a visible Location" src="../../download/attachments/31432023/node_visibility_hidef4ff.png?version=1&amp;modificationDate=1464091569000&amp;api=v2" data-image-src="/download/attachments/31432023/node_visibility_hide.png?version=1&amp;modificationDate=1464091569000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="32112933" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="node_visibility_hide.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="31432023" data-linked-resource-container-version="48" title="Developer > Repository > node_visibility_hide.png" data-location="Developer > Repository > node_visibility_hide.png" data-image-height="600" data-image-width="1133"></p><p>When you hide a Location that was visible before, it will get the status Hidden. Underlying Locations will be marked Hidden by superior. The visibility status of underlying Locations that were already Hidden or Hidden by superior will not be changed.</p><h5>Hiding a Location which is Hidden by superior</h5><p><img class="confluence-embedded-image" alt="Hiding a Location which is Hidden by superior" src="../../download/attachments/31432023/node_visibility_hide_invisiblef4ff.png?version=1&amp;modificationDate=1464091569000&amp;api=v2" data-image-src="/download/attachments/31432023/node_visibility_hide_invisible.png?version=1&amp;modificationDate=1464091569000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="32112934" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="node_visibility_hide_invisible.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="31432023" data-linked-resource-container-version="48" title="Developer > Repository > node_visibility_hide_invisible.png" data-location="Developer > Repository > node_visibility_hide_invisible.png" data-image-height="600" data-image-width="1133"></p><p> </p><p>When you explicitly hide a Location which was Hidden by superior, it will get the status Hidden. Since the underlying Locations are already either Hidden or Hidden by superior, their visibility status will not be changed.</p><h5>Revealing a Location with a visible ancestor</h5><p><img class="confluence-embedded-image" alt="Revealing a Location with a visible ancestor" src="../../download/attachments/31432023/node_visibility_unhide13220.png?version=1&amp;modificationDate=1464091570000&amp;api=v2" data-image-src="/download/attachments/31432023/node_visibility_unhide1.png?version=1&amp;modificationDate=1464091570000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="32112935" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="node_visibility_unhide1.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="31432023" data-linked-resource-container-version="48" title="Developer > Repository > node_visibility_unhide1.png" data-location="Developer > Repository > node_visibility_unhide1.png" data-image-height="600" data-image-width="1133"></p><p> </p><p>When you reveal a Location which has a visible ancestor, this Location and its children will become visible. However, underlying Locations that were explicitly hidden by a user will retain the Hidden status (and their children will be remain Hidden by superior).</p><h5>Revealing a Location with a Hidden ancestor</h5><p><img class="confluence-embedded-image" alt="Revealing a Location with a Hidden ancestor" src="../../download/attachments/31432023/node_visibility_unhide23220.png?version=1&amp;modificationDate=1464091570000&amp;api=v2" data-image-src="/download/attachments/31432023/node_visibility_unhide2.png?version=1&amp;modificationDate=1464091570000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="32112936" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="node_visibility_unhide2.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="31432023" data-linked-resource-container-version="48" title="Developer > Repository > node_visibility_unhide2.png" data-location="Developer > Repository > node_visibility_unhide2.png" data-image-height="600" data-image-width="1133"></p><p> </p><p>When you reveal a Location that has a Hidden ancestor, it will <strong>not</strong> become Visible itself. Because it still has invisible ancestors, its status will change to Hidden by superior.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="33303267-84ab-4466-94d4-c60d00c5032c" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body">In short: a Location can only be Visible when all of its ancestors are Visible as well.</td></tr></table><h4>Visibility mechanics</h4><p>The visibility mechanics are controlled by two flags: Hidden flag and Invisible flag. The Hidden flag informs whether the node has been hidden by a user or not. A raised Invisible flag means that the node is invisible either because it was hidden by a user or by the system. Together, the flags represent the three visibility statuses:</p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Hidden flag</th><th class="confluenceTh">Invisible flag</th><th class="confluenceTh">Status</th></tr><tr><td style="text-align: center;" class="confluenceTd">-</td><td style="text-align: center;" class="confluenceTd">-</td><td class="confluenceTd">The Location is visible.</td></tr><tr><td style="text-align: center;" class="confluenceTd">1</td><td style="text-align: center;" class="confluenceTd">1</td><td class="confluenceTd">The Location is invisible and it was hidden by a user.</td></tr><tr><td style="text-align: center;" class="confluenceTd">-</td><td style="text-align: center;" class="confluenceTd">1</td><td class="confluenceTd">The Location is invisible and it was hidden by the system because its ancestor is hidden/invisible.</td></tr></tbody></table><h2>Content Relations</h2><p>Content items are located in a tree structure through the Locations they are placed in. However, Content items themselves can also be related to one another.</p><p>A Relation can be created between any two Content items in the repository. This feature is typically used in situations when you need to connect and/or reuse information that is scattered around in the system. For example, it allows you to add images to news articles. Instead of using a fixed set of image attributes, the images are stored as separate Content items outside the article.</p><p>There are different types of Relations available in the system. First of all, content can be related on item or on Field level.</p><p>Relations at Field level are created using one of two special Field Types: Content relation (single) and Content relations (multiple). As the names suggest, such Fields allow you to select one or more other Content items in the Field value, which will be linked to these Fields. Content relation (single) is an example of a one-to-one relationship, and Content relations (multiple) – a one-to-many relationship.</p><p>Relations at item level can be of three different types:</p><ol><li>Common relations are created between two Content items using the Public API.</li><li>RichText linked relations are created using a Field of the RichText type. Whenever an internal link (a link to another Location or Content item) is inserted into a Field represented by this Field Type, the system will automatically create a relation of this type. Note that such a relation is automatically removed from the system when the corresponding link is removed from the Content item.</li><li>RichText embedded relations also use a RichText Field. Whenever an Embed element is inserted into a Field represented by this Field Type, the system will automatically create a relation of this type, that is relate the embedded Content item to the one that is being edited. Note that a relation of this type is automatically removed from the system when the corresponding element is removed.</li></ol><h2>Sections</h2><p>Sections are used to divide Content items in the tree into groups that are more easily manageable by content editors. Division into Sections allows you, among others, to set permissions for only a part of the tree.</p><p>Technically, a Section is simply a triplet: a number, a name and an identifier. Content items are placed in Sections by being assigned the Section ID, with one item able to be in only one Section.</p><p>When a new Content item is created, its Section ID is set to the default Section (which is usually Standard). When the item is published it is assigned to the same Section as its parent. Because Content must always be in a Section, unassigning happens by choosing a different Section to move it into . If a Content item has multiple Location assignments then it is always the Section ID of the item referenced by the parent of the main Location that will be used. In addition, if the main Location of a Content item with multiple Location assignments is changed then the Section ID of that item will be updated.</p><p>Sections can only be removed if no Content items are assigned to them. Even then, it should be done carefully. When a Section is deleted, it is only its definition itself that will be removed. Other references to the Section will remain and thus the system will most likely be in an inconsistent state.That is why removing Sections may corrupt permission settings, template output and other things in the system.</p><p>Section ID numbers are not recycled. If a Section is removed, its ID number will not be reused when a new Section is created.</p><p><img class="confluence-embedded-image image-center" alt="Sections screen" width="500" src="../../download/attachments/30708643/Admin%20Panel%20-%20Sectionsfe2b.png?version=1&amp;modificationDate=1449837660000&amp;api=v2" data-image-src="/download/attachments/30708643/Admin%20Panel%20-%20Sections.png?version=1&amp;modificationDate=1449837660000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="30711786" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Admin Panel - Sections.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="30708643" data-linked-resource-container-version="8" title="User Guide > Managing Sections > Admin Panel - Sections.png" data-location="User Guide > Managing Sections > Admin Panel - Sections.png" data-image-height="589" data-image-width="892"></p><h2>Permissions</h2><p>Permissions in Platform form one of the most advanced permissions systems around, allowing you to define very fine-grained rights for your Editors, Visitors, Members and other users.</p><h3>Overview</h3><p>In the permission system a User by default does not have access to anything. To get access they need to inherit Roles, typically assigned to the User Group they belong to.</p><h3>Model</h3><h4>Roles</h4><p>First part of the permission model is the Roles, and they consist of the following parts:</p><pre>RoleLimitation *- RoleAssignment &gt;- Role -&lt; Policy -*&lt; Limitation</pre><ul><li>A Role assignment can optionally have a Limitation, <span style="color: rgb(128,128,128);">Role Limitation examples: </span><a class="confluence-link" href="../../display/DEVELOPER/SubtreeLimitation.html" data-linked-resource-id="31430490" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="SubtreeLimitation" data-base-url="../../index.html">SubTreeLimitation</a><span style="color: rgb(128,128,128);"> or </span><a class="confluence-link" href="../../display/DEVELOPER/SectionLimitation.html" data-linked-resource-id="31430486" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="SectionLimitation" data-base-url="../../index.html">SectionLimitation</a></li><li>A Role can have several assignments, <span style="color: rgb(128,128,128);">Role example: Editor, Member, ProSubscriber<br /> </span></li><li>A Role consists of several Policies, <span style="color: rgb(128,128,128);">Policy example: content/read/*, content/edit/* (where * refers to full access, that is no Limitation)</span></li><li>A Policy optionally consists of several Limitations, <span style="color: rgb(128,128,128);">Limitation example:</span><a class="confluence-link" href="../../display/DEVELOPER/ContentTypeLimitation.html" data-linked-resource-id="31430463" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="ContentTypeLimitation" data-base-url="../../index.html">ContentTypeLimitation</a>,<a class="confluence-link" href="../../display/DEVELOPER/SectionLimitation.html" data-linked-resource-id="31430486" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="SectionLimitation" data-base-url="../../index.html">SectionLimitation</a>,<a class="confluence-link" href="../../display/DEVELOPER/OwnerLimitation.html" data-linked-resource-id="31430475" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="OwnerLimitation" data-base-url="../../index.html">OwnerLimitation</a></li></ul><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="357642e0-9fb7-4855-8fa8-643527c8bed8" data-macro-parameters="title=Role Policies Map" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading7c93.png?definition=e3RpcDp0aXRsZT1Sb2xlIFBvbGljaWVzIE1hcH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><span style="color: rgb(0,0,0);">See <a class="confluence-link" href="../../display/DEVELOPER/Role%2bPolicies%2bMap.html" data-linked-resource-id="32867837" data-linked-resource-version="20" data-linked-resource-type="page" data-linked-resource-default-alias="Role Policies Map" data-base-url="../../index.html">Role Policies Map</a> for further informations.<br /></span></p></td></tr></table><p> </p><h4>Users</h4><p>Second part of the model is made up of Users and User Groups:</p><pre>User -*&lt; UserGroup</pre><ul><li>A User can be member of several User Groups<span style="color: rgb(128,128,128);">, User Group examples: Administrator Users, Member Users, ProSubscriber Users</span></li></ul><h4>Role assignments</h4><p>Last part on the permission model is the fact that Role assignments can be assigned to both Users and User Groups:</p><pre>User - RoleAssignment - UserGroup</pre><p> </p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="20146606-7eeb-42d8-894b-29316afdb282" data-macro-parameters="title=Best Practice" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading736b.png?definition=e2luZm86dGl0bGU9QmVzdCBQcmFjdGljZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Best practice is to avoid assigning Roles to Users directly, and instead to make sure you model your content <em>(types, structure, sections, etc.)</em> in a way that can be reflected in generic roles. Besides being much easier to manage and keep on top of security-wise, this also makes sure your system performs best. <em>The more Role assignments and complex Policies you add for a given User, the more complex the search/load queries powering the whole CMS will be, as they always take permissions into account.</em></p></td></tr></table><h2>Persistence Cache</h2><p><img class="confluence-embedded-image image-left" src="../../download/attachments/31432023/SPI%20Cachec822.png?version=1&amp;modificationDate=1464093957000&amp;api=v2" data-image-src="/download/attachments/31432023/SPI%20Cache.png?version=1&amp;modificationDate=1464093957000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="32112970" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="SPI Cache.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="31432023" data-linked-resource-container-version="48" title="Developer > Repository > SPI Cache.png" data-location="Developer > Repository > SPI Cache.png" data-image-height="491" data-image-width="315"></p><h4>Layers</h4><p>Persistence cache can best be described as an implementation of <code>SPI\Persistence</code> that decorates the main backend implementation <em>(currently: &quot;Legacy Storage Engine&quot;)</em>.</p><p>As shown in the illustration, this is done in the exact same way as the SignalSlot feature is a custom implementation of API\Repository decorating the main Repository. In the case of Persistence Cache, instead of sending events on calls passed on to the decorated implementation, most of the load calls are cached, and calls that perform changes purge the affected caches. This is done using a Cache service which is provided by StashBundle; this Service wraps around the Stash library to provide Symfony logging / debugging functionality, and allows cache handlers <em>(Memcached, Redis, Filesystem, etc.)</em> to be configured using Symfony configuration. For how to reuse this Cache service in your own custom code, see below.</p><h4>Transparent cache</h4><p>With the persistence cache, just like with the HTTP cache, eZ Platform tries to follow principles of &quot;Transparent caching&quot;, this can shortly be described as a cache which is invisible to the end user and to the admin/editors of eZ Platform where content is always returned &quot;fresh&quot;. In other words, there should be no need to manually clear the cache like it was frequently the case with Exponential 4.x. This is possible thanks to an interface that follows CRUD <em>(Create Read Update Delete)</em> operations per domain, and the fact that the number of other operations capable of affecting a certain domain is kept to a minimum.</p><h5>Entity stored only once</h5><p>To make the transparent caching principle as effective as possible, entities are, as much as possible, only stored once in cache by their primary id. Lookup by a<span> <span>lternative identifiers (<code>identifier</code>, <code>remoteId</code>, etc.) is only cached with the identifier as cache key and primary <code>id</code> as its cache value, and </span> </span>compositions<span> <span> <em> (list of objects)</em> usually keep only the array of primary id's as their cache value.</span> </span></p><p><span>This means a couple of things:</span></p><ul><li><span>Memory consumption is kept low</span></li><li>Cache purging logic is kept simple (For example: <code>$sectionService-&gt;delete( 3 )</code> clears &quot;section/3&quot; cache entry)</li><li>Lookup by <code>identifier</code> and list of objects needs several cache lookups to be able to assemble the result value</li><li>Cache warmup usually takes several page loads to reach full as identifier is first cached, then the object</li></ul><h4>What is cached?</h4><p>Persistence cache aims at caching most <code>SPI\Persistence</code> calls used in common page loads, including everything needed for permission checking and url alias lookups.</p><p>Notes:</p><ul><li><code>UrlWildCardHandler</code> is not currently cached</li><li>Currently in case of transactions this is handled very simply by clearing all cache on rollback, this can be improved in the future if needed.</li><li>Some tree/batch operations will cause clearing all persistence cache, this will be improved in the future when we change to a cache service cable of cache tagging.</li><li>Search is not defined as Persistence and the queries themselves are not planned to be cached. Use <a class="confluence-link" href="../../display/DEVELOPER/Solr%2bBundle.html" data-linked-resource-id="31430592" data-linked-resource-version="28" data-linked-resource-type="page" data-linked-resource-default-alias="Solr Bundle" data-base-url="../../index.html">Solr</a> which does this for you to improve scale and offload your database.</li></ul><p><em>For further details on which calls are cached or not, and where/how to contribute additional caches, check out the <a href="https://github.com/ezsystems/exponential-kernel/tree/master/eZ/Publish/Core/Persistence/Cache">source</a>.</em></p><h1>Configuration</h1><h2>Content Repository Configuration</h2><p>The <strong>content repository</strong> is where all your content is been stored. It is the heart of eZ Platform which you interact with using Public API.</p><p>To store data, the content repository <strong>uses a storage engine</strong> that can virtually can work with any kind of storage (RDBMS, NoSQL, etc.). Exponential 5 came with a relational storage engine, compatible with v4.x: the <strong>Legacy storage engine</strong>, which is the default.</p><p>You can define several repositories within a single application. However, you can only use one per site.</p><h3>Configuration examples</h3><h4>Using default values</h4><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="82a44177-0355-4f54-acaf-c84561496ac7" data-macro-parameters="title=ezplatform.yml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingfc7c.png?definition=e2NvZGU6dGl0bGU9ZXpwbGF0Zm9ybS55bWx9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential:
    repositories:
        # Defining repository with alias "main"
        # Default storage engine is used, with default connection
        # Equals to:
        # main: { engine: legacy, connection: &lt;defaultConnectionName> }
        main: ~

    system:
        # All members of my_siteaccess_group will use "main" repository
        # No need to set "repository", it will take the first defined repository by default
        my_siteaccess_group:
            # ...</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="0ceeec9f-8b7e-46fb-80c3-5fe9558acfe5" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>If no repository is specified for a siteaccess or siteaccess group, the first defined repository (under <code>exponential.repositories</code>) will be used.</p></td></tr></table><h4>All explicit</h4><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="88161f62-a4df-46e2-b1d1-11e1506caa61" data-macro-parameters="title=ezplatform.yml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingfc7c.png?definition=e2NvZGU6dGl0bGU9ZXpwbGF0Zm9ybS55bWx9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>doctrine:
    dbal:
        default_connection: my_connection_name
        connections:
            my_connection_name:
                driver:   pdo_mysql
                host:     localhost
                port:     3306
                dbname:   my_database
                user:     my_user
                password: my_password
                charset:  UTF8

            another_connection_name:
                # ...

exponential:
    repositories:
        first_repository: { engine: legacy, connection: my_connection_name, config: {} }
        second_repository: { engine: legacy, connection: another_connection_name, config: {} }

    # ...

    system:
        my_first_siteaccess:
            repository: first_repository

            # ...

        my_second_siteaccess:
            repository: second_repository</pre></td></tr></table><h4>Legacy storage engine</h4><p><span>Legacy storage engine uses <a href="http://docs.doctrine-project.org/projects/doctrine-dbal/en/latest/">Doctrine DBAL</a> (Database Abstraction Layer). Database settings are supplied by <a href="https://github.com/doctrine/DoctrineBundle">DoctrineBundle</a>. As such, you can refer to <a href="https://github.com/doctrine/DoctrineBundle/blob/master/Resources/doc/configuration.rst#doctrine-dbal-configuration">DoctrineBundle's documentation</a>.</span></p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="15185d3e-be03-42cf-b16d-bd305be0570b" data-macro-parameters="title=ORM" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading6a47.png?definition=e2luZm86dGl0bGU9T1JNfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Doctrine ORM is <strong>not</strong> provided by default. If you want to use it, you will need to add <code>doctrine/orm</code> as a dependency in your <code>composer.json</code>.</p></td></tr></table><p><span> <br /> </span></p><h3><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro2da1.png?definition=e2FuY2hvcjpGaWVsZF9ncm91cHNfY29uZmlndXJhdGlvbn0&amp;locale=en_GB&amp;version=2" data-macro-name="anchor" data-macro-id="3646158d-1d26-4d53-b869-7ceedda9dbc9" data-macro-default-parameter="Field_groups_configuration" data-macro-schema-version="1">Field groups configuration</h3><p><img class="editor-inline-macro" height="18" width="88" src="../servlet/status-macro/placeholder1e97.png?=&amp;0=&amp;colour=Yellow&amp;title=v1.3" data-macro-name="status" data-macro-id="c0005ea0-4c4d-4691-ad14-e92f256d6ae7" data-macro-parameters="colour=Yellow|title=v1.3" data-macro-default-parameter="" data-macro-schema-version="1"></p><p>Field groups, used in content and Content Type editing, can be configured from the repository section. Values entered there are field group <em>identifiers</em>:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="95649806-d4c9-4323-8bea-c7352dad0727" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>repositories:
  default:
    fields_groups:
      list: [content, features, metadata]
      default: content</pre></td></tr></table><p>These identifiers can be given human-readable values and translated. Those values will at the moment be used when editing Content Types. The translation domain is <code>ezplatform_fields_groups</code>.<br />This file will define English names for field groups:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="81e62df8-3f64-4ebc-8c04-1bbb70644714" data-macro-parameters="title=app/Resources/translations/ezplatform_fields_groups.en.yml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinged89.png?definition=e2NvZGU6dGl0bGU9YXBwL1Jlc291cmNlcy90cmFuc2xhdGlvbnMvZXpwbGF0Zm9ybV9maWVsZHNfZ3JvdXBzLmVuLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>content: Content
metadata: Metadata
user_data: User data</pre></td></tr></table><h3>Limit of archived Content item versions</h3><p><img class="editor-inline-macro" height="18" width="88" src="../servlet/status-macro/placeholder5aeb.png?title=v1.7&amp;colour=Yellow" data-macro-name="status" data-macro-id="22497239-a078-4865-8a2e-32bfbc8e0651" data-macro-parameters="colour=Yellow|title=v1.7" data-macro-schema-version="1"></p><p><code>default_version_archive_limit</code> controls the number of archived versions per Content item that will be stored in the repository, by default set to 5. This setting is configured in the following way (typically in <code>ezplatform.yml</code>):</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="65ea1fa9-1275-458f-8bfb-7591bf002e88" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential:
    repositories:
        default:
            options:
                default_version_archive_limit: 10</pre></td></tr></table><p>This limit is enforced on publishing a new version and only covers archived versions, not drafts.</p><h2>Persistence cache configuration</h2><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="1734d67f-f6c6-4c64-87ad-554fb2cef2f0" data-macro-parameters="title=Tech Note" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading097e.png?definition=e25vdGU6dGl0bGU9VGVjaCBOb3RlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Current implementation uses a caching library called <a href="http://stash.tedivm.com/">Stash</a> (via <a href="https://github.com/tedivm/TedivmStashBundle">StashBundle</a>). Stash supports the following cache backends: FileSystem, Memcache, APC, Sqlite, Redis<strong> </strong>and BlackHole.</p></td></tr></table><p> </p><p><em>Use of Memcached (or, experimentally, Redis) is a requirement for use in Clustering setup. For an overview of this feature, see <a class="confluence-link" href="../../display/DEVELOPER/Clustering.html" data-linked-resource-id="31430387" data-linked-resource-version="19" data-linked-resource-type="page" data-linked-resource-default-alias="Clustering" data-base-url="../../index.html">Clustering</a>. </em></p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="18f93891-ff58-4e66-a4e5-3a8fd040f849" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body">When eZ Platform changes to another PSR-6 based cache system in the future, then configuration documented below will change.</td></tr></table><p><strong>Cache service</strong></p><p>The cache system is exposed as a &quot;cache&quot; service, and can be reused by any other service as described in the <span class="confluence-link"> <a class="confluence-link" href="#Repository-Usingcacheservice" data-anchor="Usingcacheservice" data-linked-resource-default-alias="Usingcacheservice" data-base-url="../../index.html">Using Cache service</a> </span> section.</p><h3>Configuration</h3><p>By default, configuration currently uses<strong> FileSystem</strong>, with<code> %kernel.cache_dir%/stash</code> to store cache files.</p><p>The configuration is placed in <code>app/config/config.yml</code> and looks like this:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="7fe9131c-4b46-462e-9d7f-6d1e4ca20908" data-macro-parameters="title=Default config.yml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingaa51.png?definition=e2NvZGU6dGl0bGU9RGVmYXVsdCBjb25maWcueW1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            drivers:
                - FileSystem
            inMemory: true
            registerDoctrineAdapter: false</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="9036fe7e-a834-49f6-b95b-670c531b767d" data-macro-parameters="title=Note for &quot;inMemory&quot; cache with long running scripts" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinged13.png?definition=e25vdGU6dGl0bGU9Tm90ZSBmb3IgImluTWVtb3J5IiBjYWNoZSB3aXRoIGxvbmcgcnVubmluZyBzY3JpcHRzfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Use <code>inMemory</code> with caution, and avoid it completely for long running scripts for the following reasons:</p><ul><li>It does not have any limits, so can result in the application running out of PHP memory.</li><li><span>Its cache pool is by design a PHP variable and is not shared across requests/processes/servers, so data becomes stale if any other concurrent activity happens towards the repository.</span></li></ul></td></tr></table><h4>Multi repository setup</h4><p>In <code>ezplatform.yml</code> you can specify which cache pool you want to use on a siteaccess or sitegroup level. The following example shows use in a sitegroup:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="c2c3dad3-bf5a-4b06-a1c4-b67403270d43" data-macro-parameters="title=ezplatform.yml site group setting" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingcf54.png?definition=e2NvZGU6dGl0bGU9ZXpwbGF0Zm9ybS55bWwgc2l0ZSBncm91cCBzZXR0aW5nfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential:
    system:
        # "site_group" refers to the group configured in site access
        site_group:
            # "default" refers to the cache pool, the one configured on stash.caches above
            cache_pool_name: "default"
</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="14817cc2-ada3-45b5-9b6d-4ebd0db3b577" data-macro-parameters="title=One cache pool for each repository" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading496d.png?definition=e25vdGU6dGl0bGU9T25lIGNhY2hlIHBvb2wgZm9yIGVhY2ggcmVwb3NpdG9yeX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body">If your installation has several repositories <em>(databases)</em>, make sure every group of sites using different repositories also uses a different cache pool.</td></tr></table><h3>Stash cache backend configuration</h3><h4>General settings</h4><p>To check which cache settings are available for your installation, run the following command in your terminal:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="b0233589-ef6d-4625-90ed-0c08f7ef9194" data-macro-parameters="language=bash" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading174f.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php app/console config:dump-reference stash</pre></td></tr></table><h4><span>FileSystem</span></h4><p>This cache backend uses the local filesystem, by default the Symfony cache folder. As this is per server, it <strong>does not support </strong> <a class="confluence-link" href="../../display/DEVELOPER/Clustering.html" data-linked-resource-id="31430387" data-linked-resource-version="19" data-linked-resource-type="page" data-linked-resource-default-alias="Clustering" data-base-url="../../index.html"> <strong>multi server (<span class="confluence-link">cluster</span>) setups</strong> </a>!</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="0b933771-9687-41ac-b609-aa8de852c672" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><strong>We strongly discourage you from storing cache files on NFS</strong>, as it defeats the purpose of the cache: speed.</td></tr></table><h5><span style="color: rgb(51,51,51);">Available settings</span></h5><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><pre>path</pre></td><td class="confluenceTd">The path where the cache is placed; default is <code>%kernel.cache_dir%/stash</code>, effectively <code>app/cache/&lt;env&gt;/stash</code></td></tr><tr><td colspan="1" class="confluenceTd"><pre>dirSplit</pre></td><td colspan="1" class="confluenceTd">Number of times the cache key should be split up to avoid having too many files in each folder; default is 2.</td></tr><tr><td colspan="1" class="confluenceTd"><pre>filePermissions</pre></td><td colspan="1" class="confluenceTd">The permissions of the cache file; default is 0660.</td></tr><tr><td colspan="1" class="confluenceTd"><pre>dirPermissions</pre></td><td colspan="1" class="confluenceTd">The permission of the cache file directories (see dirSplit); default is 0770.</td></tr><tr><td colspan="1" class="confluenceTd"><pre>memKeyLimit</pre></td><td colspan="1" class="confluenceTd"><p>Limit on how many key to path entries are kept in memory during execution at a time to avoid having to recalculate the path on key lookups; default is 200.</p></td></tr><tr><td colspan="1" class="confluenceTd"><pre>keyHashFunction</pre></td><td colspan="1" class="confluenceTd">Algorithm used for creating paths; default is md5. Use crc32 on Windows to avoid path length issues.<code>
                <code>
                  <br />
                </code>
              </code></td></tr></tbody></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="d2c03a34-0b07-4a7e-9125-e97edb20480c" data-macro-parameters="title=Issues with Microsoft Windows" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading5ea9.png?definition=e2luZm86dGl0bGU9SXNzdWVzIHdpdGggTWljcm9zb2Z0IFdpbmRvd3N9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>If you are using a Windows OS, you may encounter an issue regarding<strong> long paths for cache directory name</strong>. The paths are long because Stash uses md5 to generate unique keys that are sanitized really quickly.</p><p>Solution is to <strong>change the hash algorithm</strong> used by Stash.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="d73b0104-766e-4c81-a1cd-def3cd026fe4" data-macro-parameters="title=Specifying key hash function" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading6c20.png?definition=e2NvZGU6dGl0bGU9U3BlY2lmeWluZyBrZXkgaGFzaCBmdW5jdGlvbn0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            drivers:
                - FileSystem
            inMemory: true
            registerDoctrineAdapter: false
            FileSystem:
                keyHashFunction: 'crc32'</pre></td></tr></table><p><strong>This configuration is only recommended for Windows users</strong>.<br /> <br />Note: You can also define the<strong> path</strong> where you want the cache files to be generated to be able to get even shorter system path for cache files.</p></td></tr></table><p> </p><h4>FileSystem cache backend troubleshooting</h4><p>By default, Stash Filesystem cache backend stores cache to a sub-folder named after the environment (<code>i.e. app/cache/dev</code>, <code>app/cache/prod</code>). This can lead to the following issue: if different environments are used for operations, persistence cache (manipulating content, mostly) will be affected and cache can become inconsistent.</p><p>To prevent this, there are 2 solutions:</p><p> </p><h6><strong>1. <a name="manual" />Manual</strong></h6><p><strong>Always</strong> use the same environment, for web, command line, cronjobs etc.</p><h6><strong>2 . Share stash cache across Symfony environments (prod / dev / ..)</strong></h6><p>Either by using another Stash cache backend, or by setting Stash to use a shared cache folder that does not depend on the environment.</p><p>In <code>ezplatform.yml</code>:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="5be25e08-86ab-4ce6-a68a-c215efe367b9" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            FileSystem:
                path: "%kernel.root_dir%/cache/common"
</pre></td></tr></table><p>This will store stash cache to <code>app/cache/common.</code></p><h4>APC &amp; APCu</h4><p>This cache backend is using shard memory with APC's user cache feature. As this is per server, it <strong>does not support <a class="confluence-link" href="../../display/DEVELOPER/Clustering.html" data-linked-resource-id="31430387" data-linked-resource-version="19" data-linked-resource-type="page" data-linked-resource-default-alias="Clustering" data-base-url="../../index.html">multi server (<span class="confluence-link">cluster</span>) setups</a> </strong>.</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="6b3e8b34-1f62-48d3-a7e1-441298130f87" data-macro-parameters="title=Not supported because of following limitation" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd5d6.png?definition=e25vdGU6dGl0bGU9Tm90IHN1cHBvcnRlZCBiZWNhdXNlIG9mIGZvbGxvd2luZyBsaW1pdGF0aW9ufQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>As APC(u) user cache is not shared between processes, it is not possible to clear the user cache from CLI, even if you set <span style="color: rgb(0,0,0);"> <code>apc.enable_cli</code> to On</span>. That is why publishing content from a command line script won't let you properly clear SPI Persistence cache.</p></td></tr></table><p>Please also note that the default value for <code>apc.shm_size</code> is 128MB. However, 256MB is recommended for APC to work properly. For more details please refer to the <a href="http://www.php.net/manual/en/apc.configuration.php#ini.apc.shm-size">APC configuration manual</a>.</p><p> </p><p><strong>Available settings</strong></p><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><code>
                <strong>ttl</strong>
              </code></td><td class="confluenceTd">The time to live of the cache in seconds; default is 500 (8.3 minutes)</td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>namespace</strong>
              </code></td><td colspan="1" class="confluenceTd">A namespace to prefix cache keys with to avoid key conflicts with other eZ Platform sites on same eZ Platform installation; default is <code>null</code>.</td></tr></tbody></table><h4><span class="inline-comment-marker" data-ref="2f3adfb4-7947-42db-969e-9f484390d409">Redis</span></h4><p><img class="editor-inline-macro" height="18" width="88" src="../servlet/status-macro/placeholder3b6d.png?subtle=true&amp;colour=Red&amp;title=Experimental" data-macro-name="status" data-macro-id="68b5268f-f4cf-42ea-99e1-fff3927ae509" data-macro-parameters="colour=Red|subtle=true|title=Experimental" data-macro-schema-version="1"></p><p>This cache backend is using <a href="http://redis.io/">Redis, a in-memory data structure store</a>, via <a href="https://pecl.php.net/package/redis">Redis pecl extension</a>. This is an alternative cache solution for <a class="confluence-link" href="../../display/DEVELOPER/Clustering.html" data-linked-resource-id="31430387" data-linked-resource-version="19" data-linked-resource-type="page" data-linked-resource-default-alias="Clustering" data-base-url="../../index.html">multi server (<span class="confluence-link">cluster</span>) setups</a>, besides using Memcached.</p><p><strong>Available settings</strong></p><table class="confluenceTable"><tbody><tr><td colspan="1" class="confluenceTd"><code>
                <strong>servers</strong>
              </code></td><td colspan="1" class="confluenceTd"><p>Array of Redis servers:</p><p><code>
                  <strong>server</strong>
                </code>: Host or IP of your Redis server<br /> <code>
                  <strong>port</strong>
                </code>: Port that Redis is listening to (default: 6379)<br /> <code style="line-height: 1.42857;">
                  <strong>ttl</strong>
                </code>: Optional float value of connection timeout in seconds<br /> <code>
                  <strong>socket</strong>
                </code> <span>: Optional boolean value to specify if server refers to a socket (default: false)</span></p></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>password</strong>
              </code></td><td colspan="1" class="confluenceTd">Optional setting if there is a password to connection to a given Redis server in plain text over the network.</td></tr><tr><td colspan="1" class="confluenceTd"><strong>database</strong></td><td colspan="1" class="confluenceTd">Optional setting to specify a given Redis database to use.</td></tr></tbody></table><p><strong>Example</strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="12cf9e3a-3162-49e0-bce0-961f14a0d511" data-macro-parameters="title=config.yml example" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingcf81.png?definition=e2NvZGU6dGl0bGU9Y29uZmlnLnltbCBleGFtcGxlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            drivers: [ Redis ]
            Redis:
                servers:
                    -
                        server: 'redis1.ez.no'
                        port: 6379
                    -
                        server: 'redis2.ez.no'
                        port: 6379</pre></td></tr></table><h4>Memcache(d)</h4><p>This cache backend is using <a href="http://memcached.org/">Memcached, a distributed caching solution</a>. This is the main supported cache solution for <a class="confluence-link" href="../../display/DEVELOPER/Clustering.html" data-linked-resource-id="31430387" data-linked-resource-version="19" data-linked-resource-type="page" data-linked-resource-default-alias="Clustering" data-base-url="../../index.html">multi server (<span class="confluence-link">cluster</span>) setups</a>, besides using Redis.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="43475de5-72d0-4ae0-974c-4b3bfdfe707e" data-macro-parameters="title=Note" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb7a0.png?definition=e2luZm86dGl0bGU9Tm90ZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Stash supports both the <a href="http://php.net/memcache">php-memcache</a> and <a href="http://php.net/memcached">php-memcached</a> extensions. <strong>However</strong> only php-memcached is officially supported as php-memcache is missing many features and is less stable.</p></td></tr></table><p><strong>Available settings</strong></p><table class="confluenceTable"><tbody><tr><td colspan="1" class="confluenceTd"><code>
                <strong>servers</strong>
              </code></td><td colspan="1" class="confluenceTd"><p>Array of Memcached servers, with host/IP, port and weight</p><p><code>
                  <strong>server</strong>
                </code>: Host or IP of your Memcached server<br /> <code>
                  <strong>port</strong>
                </code>: Port that Memcached is listening to (defaults to 11211)<br /> <code>
                  <strong>weight</strong>
                </code>: Weight of the server, when using several Memcached servers</p></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>prefix_key</strong>
              </code></td><td colspan="1" class="confluenceTd"><span>A namespace to prefix cache keys with to avoid key conflicts with other eZ Platform sites on same eZ Platform installation (default is an empty string). </span> <br /> <span>Must be the same on all servers with the same installation.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-prefix-key">See Memcached prefix_key option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>compression</strong>
              </code></td><td colspan="1" class="confluenceTd">default true. <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-compression">See Memcached compression option</a> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>libketama_compatible</strong>
              </code></td><td colspan="1" class="confluenceTd">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-libketama-compatible">See Memcached libketama_compatible option</a> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>buffer_writes</strong>
              </code></td><td colspan="1" class="confluenceTd">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-buffer-writes">See Memcached buffer_writes option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>binary_protocol</strong>
              </code></td><td colspan="1" class="confluenceTd">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-binary-protocol">See Memcached binary_protocol option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>no_block</strong>
              </code></td><td colspan="1" class="confluenceTd">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-no-block">See Memcached no_block option</a> <span> <strong> *</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>tcp_nodelay</strong>
              </code></td><td colspan="1" class="confluenceTd">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-tcp-nodelay">See Memcached tcp_nodelay option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>connection_timeout</strong>
              </code></td><td colspan="1" class="confluenceTd">default 1000.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-connection-timeout">See Memcached connection_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>retry_timeout</strong>
              </code></td><td colspan="1" class="confluenceTd">default 0.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-memcached-timeout">See Memcached retry_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>send_timeout</strong>
              </code></td><td colspan="1" class="confluenceTd">default 0.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-send-timeout">See Memcached send_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>recv_timeout</strong>
              </code></td><td colspan="1" class="confluenceTd"><p>default 0.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-recv-timeout">See Memcached recv_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></p></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>poll_timeout</strong>
              </code></td><td colspan="1" class="confluenceTd">default 1000.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-poll-timeout">See Memcached poll_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
                <strong>cache_lookups</strong>
              </code></td><td colspan="1" class="confluenceTd">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-cache-lookups">See Memcached cache_lookups option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><strong> <code>server_failure_limit</code> </strong></td><td colspan="1" class="confluenceTd">default 0.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-server-failure-limit">See PHP Memcached documentation</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> <br /> </span></td></tr><tr><td colspan="1" class="confluenceTd"><strong> <span style="color: rgb(34,34,34);"> <code>socket_send_size </code> <br /> </span> </strong></td><td colspan="1" class="confluenceTd">See <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-socket-send-size">Memcached socket_send_size option</a> *</td></tr><tr><td colspan="1" class="confluenceTd"><strong> <code>socket_recv_size</code> </strong></td><td colspan="1" class="confluenceTd">See <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-socket-recv-size">Memcached socket_recv_size option</a> *</td></tr><tr><td colspan="1" class="confluenceTd"><strong> <code>serializer</code> </strong></td><td colspan="1" class="confluenceTd">See <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-serializer">Memcached serializer option</a> *</td></tr><tr><td colspan="1" class="confluenceTd"><strong> <code>hash</code> </strong></td><td colspan="1" class="confluenceTd">See <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-hash">Memcached hash option</a> *</td></tr><tr><td colspan="1" class="confluenceTd"><strong> <code>distribution</code> </strong></td><td colspan="1" class="confluenceTd"><p>Specifies the method of distributing item keys to the servers. See<a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-distribution"> Memcached distribution option</a> *</p></td></tr></tbody></table><p> </p><p><strong>*</strong> All settings except <code>servers </code>are only available with memcached PHP extension. For more information on these settings and which version of php-memcache<u>d</u> they are available in, see: <a href="http://php.net/Memcached">http://php.net/Memcached</a> <span style="color: rgb(128,128,0);"> <br /> </span></p><p> </p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="f2de3847-01bd-444d-8fc6-7da6803dad2d" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>When using Memcache cache backend, you <em>may</em> use inMemory to reduce network traffic as long as you are aware of its limitations mentioned above.</p></td></tr></table><h4>Example with Memcache(d)</h4><p>Note that <code>app/config/config.yml</code> contains the default stash configuration. To apply the configuration below, make sure you update the existing configuration, or remove it if you want to use another configuration file.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="55b98bcf-2c4c-4bc8-990b-9e1aa0d83f3c" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
    caches:
        default:
            drivers: [ Memcache ]
            inMemory: true
            registerDoctrineAdapter: false
            Memcache:
                prefix_key: ezdemo_
                retry_timeout: 1
                servers:
                    -
                        server: 127.0.0.1
                        port: 11211</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="5b984e56-2ba6-4fdf-9bff-721dd96710bc" data-macro-parameters="title=Connection errors issue" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1450.png?definition=e3dhcm5pbmc6dGl0bGU9Q29ubmVjdGlvbiBlcnJvcnMgaXNzdWV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>If memcached does display connection errors when using the default (ascii) protocol, then switching to binary protocol <em>(in the stash configuration and memcached daemon)</em> should resolve the issue.</p></td></tr></table><h1>Usage</h1><h2>Using Cache Service</h2><p>Using the internal cache service allows you to use an interface and to not have to care whether the system has been configured to place the cache in Memcached or on File system. And as eZ Platform requires that instances use a cluster-aware cache in Cluster setup, you can safely assume your cache is shared <em>(and invalidated)</em> across all web servers.</p><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="2a38f2d8-2cd8-4d32-8d8a-14f23b0b24d2" data-macro-parameters="title=Interface will change in the future" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading3212.png?definition=e3dhcm5pbmc6dGl0bGU9SW50ZXJmYWNlIHdpbGwgY2hhbmdlIGluIHRoZSBmdXR1cmV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Current implementation uses a caching library called <a class="external-link" href="http://stash.tedivm.com/" rel="nofollow">Stash</a>, via <a class="external-link" href="https://github.com/tedivm/TedivmStashBundle" rel="nofollow">StashBundle</a>. We plan to move to a PSR-6 compatible cache service capable of supporting cache Tagging and multi get/set in the future, when that happens the interface of the cache service will change!</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="487f2fb5-b135-440d-95a8-7b81ad9480e7" data-macro-parameters="title=Use unique vendor prefix for Cache key!" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1338.png?definition=e25vdGU6dGl0bGU9VXNlIHVuaXF1ZSB2ZW5kb3IgcHJlZml4IGZvciBDYWNoZSBrZXkhfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>When reusing the cache service within your own code, it is very important to not conflict with the cache keys used by others. That is why the example of usage below starts with a unique &quot;myApp&quot; key. For the namespace of your own cache, you must do the same! So never clear cache using the cache service without your key specified, otherwise you'll clear all cache.</p></td></tr></table><h4>Get Cache service</h4><h4>Via Dependency injection</h4><p>In your Symfony services configuration you can simply define that you require the &quot;cache&quot; service in your configuration like so:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="86a26b86-99f1-4a5c-81bd-e64dffc81f8d" data-macro-parameters="title=yml configuration" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading5d0e.png?definition=e2NvZGU6dGl0bGU9eW1sIGNvbmZpZ3VyYXRpb259&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>    myApp.myService:
        class: %myApp.myService.class%
        arguments:
            - @exponential.cache_pool</pre></td></tr></table><p>The &quot;cache&quot; service is an instance of the following class: <code>Tedivm\StashBundle\Service\CacheService</code></p><h4>Via Symfony Container</h4><p>Like any other service, it is also possible to get the &quot;cache&quot; service via container like so:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="83a9d69e-e983-46ab-b533-b792f44c3794" data-macro-parameters="language=php|title=Getting the cache service in PHP" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading01dc.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPUdldHRpbmcgdGhlIGNhY2hlIHNlcnZpY2UgaW4gUEhQfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>/** @var $cacheService \Tedivm\StashBundle\Service\CacheService */
$cacheService = $container->get('exponential.cache_pool');</pre></td></tr></table><h3>Using the cache service</h3><p>Example usage of the cache service:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="19d00d26-4117-494d-aed7-82109e86aea8" data-macro-parameters="language=php|title=Example" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingc9ae.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPUV4YW1wbGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>    $cacheItem = $cacheService->getItem('myApp', 'object', $id);
    $myObject = $cacheItem->get();
    if ($cacheItem->isMiss()) {
        $myObject = $container->get('my_app.backend_service')->loadObject($id)
        $cacheItem->set($myObject);
    }
    return $myObject;</pre></td></tr></table><p>For more info on usage, take a look at <a href="http://stash.tedivm.com/">Stash's documentation</a>.</p><h3>Clearing Persistence cache</h3><p>Persistence cache uses a separate Cache Pool decorator which by design prefixes cache keys with &quot;ez_spi&quot;. Clearing persistence cache can thus be done in the following way:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="92444ede-e36b-47d9-9470-f1f9b7f6170d" data-macro-parameters="language=php|title=getting the cache service in php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb6d4.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPWdldHRpbmcgdGhlIGNhY2hlIHNlcnZpY2UgaW4gcGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>/** @var $cacheService \eZ\Publish\Core\Persistence\Cache\CacheServiceDecorator */
$cacheService = $container->get('exponential.cache_pool.spi.cache.decorator');
 
// To clear all cache
$cacheService->clear();
 
// To clear a specific cache item (check source code in eZ\Publish\Core\Persistence\Cache\*Handlers for further info)
$cacheService->clear('content', 'info', $contentId);

// Stash cache is hierarchical, so you can clear all content/info cache like so:
$cacheService->clear('content', 'info');</pre></td></tr></table><h2>Binary files URL handling</h2><h3>IO URL decoration</h3><p>By default, images and binary files referenced by content will be served from the same server as the application, like <code>
          <span>/var/ezdemo_site/storage</span>
          <span>/images/3/6/4/6/6463-1-eng-GB/kidding.png</span>
        </code>. This is the default semantic configuration:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="4c200a9c-db0b-432f-81d2-dd5cf2555e2e" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential:
    system:
        default:
            io:
	            url_prefix: "$var_dir$/$storage_dir$"
</pre></td></tr></table><p><span> <code>$var_dir$</code> and <code>$storage_dir$</code> are dynamic, <a href="../../display/DEVELOPER/SiteAccess.html#SiteAccess-DynamicSettingsInjection">siteaccess-aware settings</a>, and will be replaced by those settings value in the execution context.</span></p><p> </p><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="d21c312c-bb94-4ae0-b62c-b448420ed1d2" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingca13.png?definition=e3dhcm5pbmd9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>URL decorators are an eZ Platform features. If an image field is displayed via a legacy callback or legacy template, no decoration will be applied.</p></td></tr></table><p><span> <br /> </span></p><h3><span>Using a static server for images</span></h3><p><span> <span>One common use-case is to use an optimized nginx to serve images in an optimized way. The example image above could be made available as <code>
              <span> <a href="http://static.example.com/">http://static.example.com/</a> </span>
              <span>images/3/6/4/6/6463-1-eng-GB/kidding.png</span>
            </code>, by setting up a server that uses <code>exponential/exponential_legacy/var/ezdemo_site/storage</code>. The eZ Platform configuration would be as follows:</span> </span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="cc6269eb-db0e-4dea-988b-5e443e1e01a0" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential:
    system:
        default:
            io:
	            url_prefix: "http://static.example.com/"
</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="c687af14-4912-41b6-865c-324be83027ee" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><h4>Legacy compatiblity</h4><p>Legacy still requires non-absolute path to store images (var/site/storage/images/etc.). In order to work around this, a <code>UrlRedecorator</code>, that converts back and forth between the legacy uri prefix and the one in use in the application has been added. It is used in all places where a legacy URL is returned/expected, and takes care of making sure the value is as expected.</p></td></tr></table><p><span style="color: rgb(0,98,147);">Internals</span></p><p>Any <code>BinaryFile</code> returned by the public API is prefixed with the value of this setting, internally stored as <code>
          <a href="http://ezsettings.scope.io/">ezsettings.scope.io</a>.url_prefix</code>.</p><h4>Dynamic container settings</h4><p>Those settings are siteaccess-aware.</p><h5><code>io.url_prefix</code></h5><p>Default value: <span> <code>$var_dir$/$storage_dir$</code> <br />Example: <code>
            <span>/var/ezdemo_site/storage</span>
          </code> </span></p><p><span> <span> <span>Used to configure the default URL decorator service (</span> <code>
              <a href="http://exponential.core.io/">exponential.core.io</a>.default_url_decorator</code> <span>, used by all binarydata handlers to generate the URI of loaded files. It is always interpreted as an absolute URI, meaning that unless it contains a scheme (<span class="nolink">http://,</span> ftp://), it will be prepended with a '/'.</span> </span> </span></p><h5><code>io.legacy_url_prefix</code></h5><p>Default value: <code>
          <span>$var_dir$/$storage_dir$</span>
        </code> <br />Example: <code>
          <span>var/ezdemo_site/storage</span>
        </code></p><p><span>Used by the legacy storage engine to convert images public URI to a format it understands. Unlike io.url_prefix, it is not an absolute link. Cannot be overridden using semantic configuration. <span>Changing this value will break compatibility for the legacy backoffice.</span> </span></p><h5><code>io.root_dir</code></h5><p><span> <span> <span>Example: <code>
                <span>%exponential_legacy.root_dir%/$var_dir$/$storage_dir$</span>
              </code> <br />Default value: <code>/var/www/exponential/exponential_legacy/var/ezdemo_site/storage</code> </span> </span> </span></p><p><span> <span> <span>Physical path where binary files are stored on disk. Cannot be overridden using semantic configuration. Changing this value will break compatibility for the legacy backoffice.</span> </span> </span></p><h4><a class="anchor" href="https://github.com/ezsystems/exponential-kernel/blob/master/doc/specifications/io/io_url_decoration.md#services" name="user-content-services" />Services</h4><h5>URL decorators</h5><p>An UrlDecorator decorates and undecorates a given string (url) in some way. It has two mirror methods: <code>decorate</code> and <code>undecorate</code>.</p><p>Two implementations are provided: <code>Prefix</code>, and <code>AbsolutePrefix</code>. They both add a prefix to a URL, but <code>AbsolutePrefix</code> will ensure that unless the prefix is an external URL, the result will be prepended with /.</p><p>Three UrlDecorator services are introduced:</p><ul class="task-list"><li><code>
            <a href="http://exponential.core.io/">exponential.core.io</a>.prefix_url_decorator</code> used by the binarydata handlers to decorate all uris sent out by the API. Uses AbsolutePrefix.</li><li><code>
            <a href="http://exponential.core.io/">exponential.core.io</a>.image_fieldtype.legacy_url_decorator</code> used via the UrlRedecorator (see below) by various legacy elements (Converter, Storage Gateway, etc.) to generate its internal storage format for uris. Uses a Prefix, not an AbsolutePrefix, meaning that no leading / is added.</li></ul><p>In addition, a UrlRedecorator service, <code>
          <a href="http://exponential.core.io/">exponential.core.io</a>.image_fieldtype.legacy_url_redecorator</code>, uses both decorators above to convert URIs between what is used on the new stack, and what format legacy expects (relative urls from the exponential root).</p><h2>Regenerating URL Aliases</h2><p>The command ezplatform:regenerate:legacy_storage_url_aliases command regenerates URL aliases for Locations and migrates existing custom Location and global URL aliases to a separate database table. The separate table must be named <code>__migration_ezurlalias_ml</code> and should be created manually to be identical (but empty) as the existing table <code>ezurlalias_ml</code> before the command is executed.</p><p>After the script finishes, to complete migration the table should be renamed to <code>ezurlalias_ml</code> manually. Using available options for <code>action</code> argument, you can back up custom Location and global URL aliases separately and inspect them before restoring them to the migration table. They will be stored in backup tables named <code>__migration_backup_custom_alias</code> and <code>__migration_backup_global_alias</code> (created automatically).</p><p>It is also possible to skip custom Location and global URL aliases altogether and regenerate only automatically created URL aliases for Locations (use the <code>autogenerate</code> action to achieve this). During the script execution the database should not be modified. Since this script can potentially run for a very long time, to avoid memory exhaustion run it in production environment using the <code>--env=prod</code> switch.</p><h1>Reference</h1><h2>Services: Public API</h2><p>The Public API exposes Symfony services for all of its repository services.</p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Service id</th><th class="confluenceTh">Type</th></tr><tr><td colspan="1" class="confluenceTd"><code>exponential.api.service.content</code></td><td colspan="1" class="confluenceTd"><code>eZ\Publish\API\Repository\ContentService</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.content_type</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\ContentTypeService</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.location</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\LocationService</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.url_alias</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\UrlAliasService</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.field_type</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\FieldTypeService</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.language</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\Language</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.object_state</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\ObjectState</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.role</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\Role</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.search</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\Search</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.section</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\Section</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.trash</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\Trash</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.url_wildcard</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\UrlWildcard</code></td></tr><tr><td class="confluenceTd"><code>exponential.api.service.user</code></td><td class="confluenceTd"><code>eZ\Publish\API\Repository\User</code></td></tr></tbody></table><h2>Signals Reference</h2><p>You can find the reference for <strong>all available signals</strong> that you can listen to, triggered by (&quot;Public&quot;) Repository API in eZ Platform, in their dedicated page: <a class="confluence-link" href="../../display/DEVELOPER/Signals%2bReference.html" data-linked-resource-id="32113983" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="Signals Reference" data-base-url="../../index.html">Signals Reference</a>.</p><h2>Limitations Reference</h2><p>Limitations are crucial building blocks of the <a href="../../display/DEVELOPER/Repository.html#Repository-Permissions">permissions system</a> in eZ Platform. They provide the restrictions you can apply to a given access right to limit the right according to certain conditions.</p><p>Limitations consist of two parts:</p><ul><li><code>Limitation</code> (Value)</li><li><code>LimitationType</code></li></ul><p>Certain limitations also serve as RoleLimitations, which means they can be used to limit the rights of a Role assignment. Currently this covers <code>Subtree</code> and <code>Section</code> limitations.</p><p><code>Limitation</code> represents the value, while <code>LimitationType</code> deals with the business logic surrounding how it actually works and is enforced.<br /> <code>LimitationTypes</code> have two modes of operation in regards to permission logic (see <code>eZ\Publish\SPI\Limitation\Type</code> interface for more info):</p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Method</th><th class="confluenceTh">Use</th></tr><tr><td class="confluenceTd"><code>
          <span>evaluate</span>
        </code></td><td class="confluenceTd"><span>Evaluating if the user has access to a given object in a certain context (for instance the context can be Locations when the object is <code>Content</code>), under the condition of the <code>Limitation</code> value(s).</span></td></tr><tr><td class="confluenceTd"><code>
          <span>getCriterion</span>
        </code></td><td class="confluenceTd"><span>Generates a <code>Criterion</code> using <code>Limitation</code> value and current user which <code>SearchService</code> by default applies to search criteria for filtering search based on permissions.</span></td></tr></tbody></table><h3>List of Limitations</h3><p><strong>See <a class="confluence-link" href="../../display/DEVELOPER/List%2bof%2bLimitations.html" data-linked-resource-id="31430459" data-linked-resource-version="8" data-linked-resource-type="page" data-linked-resource-default-alias="List of Limitations" data-base-url="../../index.html">List of Limitations</a> </strong></p><h1>Extensibility</h1><h2>Permissions</h2><p>Two parts of the permissions system are extensible from a programmatic perspective: Policies and Limitations</p><ul><li>Policies: <a class="confluence-link" href="#Repository-Custompolicies" data-anchor="Custompolicies" data-linked-resource-default-alias="Custompolicies" data-base-url="../../index.html"> <span class="confluence-link">Custom Policies can be added for use in your own code</span> </a>, <span style="color: rgb(128,128,128);">custom Policy example: comment/create</span></li><li><a class="confluence-link" href="../../display/DEVELOPER/List%2bof%2bLimitations.html" data-linked-resource-id="31430459" data-linked-resource-version="8" data-linked-resource-type="page" data-linked-resource-default-alias="List of Limitations" data-base-url="../../index.html">Limitations</a>: You can extend existing Policies, and hence extend the permissions of the CMS, <span style="color: rgb(128,128,128);">example could be adding a SubscriptionLimitation to content/read Policy</span></li></ul><h2>Custom Policies</h2><h3>Description</h3><p>eZ content repository uses the concept of Roles and Policies in order to authorize a user to do something (e.g. read content).</p><ul><li>A Role is composed of Policies and can be assigned to a User or a User Group.</li><li>A Policy is composed of a combination of <strong>module</strong> and <strong>function</strong> (e.g. <code>content/read</code>, <code>content</code> being the module and <code>read</code> being the function).</li><li>Depending on <strong>module</strong> and <strong>function</strong> combination, a Policy can also be composed of Limitations.</li></ul><p>It is possible for any bundle to expose available Policies via a <code>PolicyProvider</code> which can be added to EzPublishCoreBundle's DIC extension.</p><h3>PolicyProvider</h3><p>A <code>PolicyProvider</code> is an object providing a hash containing declared modules, functions and limitations.</p><ul><li>Each Policy provider provides a collection of permission <em>modules</em>.</li><li>Each module can provide <em>functions</em> (e.g. &quot;content/read&quot;: &quot;content&quot; is the module, &quot;read&quot; is the function)</li><li>Each function can provide a collection of Limitations.</li></ul><p>Policies configuration hash contains declared these modules, functions and Limitations.<br />First level key is the module name, value is a hash of available functions, with function name as key.<br />Function value is an array of available Limitations, identified by the alias declared in LimitationType service tag.<br />If no Limitation is provided, value can be <code>null</code> or an empty array.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="51ad6600-4bd4-4670-b898-e10ee4117977" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>[
    "content" => [
        "read" => ["Class", "ParentClass", "Node", "Language"],
        "edit" => ["Class", "ParentClass", "Language"]
    ],
    "custom_module" => [
        "custom_function_1" => null,
        "custom_function_2" => ["CustomLimitation"]
    ],
]</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="9295c16b-f750-45e1-8d0e-d1f91a380214" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Limitations need to be implemented as <em>limitation types</em> and declared as services identified with <code>exponential.limitationType</code> tag. Name provided in the hash for each Limitation is the same value set in <code>alias</code> attribute in the service tag.</p></td></tr></table><h3>Example</h3><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="29c8ede3-7fa1-4003-b0ea-1b458b2062aa" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\FooBundle\AcmeFooBundle\Security;

use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\ConfigBuilderInterface;
use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Security\PolicyProvider\PolicyProviderInterface;

class MyPolicyProvider implements PolicyProviderInterface
{
    public function addPolicies(ConfigBuilderInterface $configBuilder)
    {
        $configBuilder->addConfig([
             "custom_module" => [
                 "custom_function_1" => null,
                 "custom_function_2" => ["CustomLimitation"],
             ],
         ]);
    }
}</pre></td></tr></table><h3>YamlPolicyProvider</h3><p><span>An abstract class based on YAML is provided: </span> <code>eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Security\PolicyProvider\YamlPolicyProvider</code> <span>.<br /> </span> <span>It defines an abstract </span> <code>getFiles()</code> <span> method. </span></p><p><span>Extend <code>YamlPolicyProvider</code> and implement <code>getFiles()</code> to return absolute paths to your YAML files.</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="625f0eed-a08f-406b-8dfa-7890f2769f01" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\FooBundle\AcmeFooBundle\Security;

use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Security\PolicyProvider\YamlPolicyProvider;

class MyPolicyProvider extends YamlPolicyProvider
{
    protected function getFiles()
    {
        return [
             __DIR__ . '/../Resources/config/policies.yml',
         ];
    }
}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="4a34d237-2d5b-48c4-927c-8661e0496eda" data-macro-parameters="language=bash|title=AcmeFooBundle/Resources/config/policies.yml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingf8b3.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1BY21lRm9vQnVuZGxlL1Jlc291cmNlcy9jb25maWcvcG9saWNpZXMueW1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>custom_module:
    custom_function_1: ~
    custom_function_2: [CustomLimitation]</pre></td></tr></table><h4><span>Extending existing policies</span></h4><p>A <code>PolicyProvider</code> may provide new functions to a module, and additional Limitations to an existing function. <br /> <strong>It is however strongly encouraged to add functions to your own Policy modules.</strong></p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="61c1da4d-016a-4f96-afc3-7cf7b58fbb71" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>It is not possible to remove an existing module, function or limitation from a Policy.</p></td></tr></table><h3>Integrating the PolicyProvider into EzPublishCoreBundle</h3><p><span>For a PolicyProvider to be active, it must be properly declared in EzPublishCoreBundle. <br />A bundle just has to retrieve CoreBundle's DIC extension and call </span> <code>addPolicyProvider()</code> <span>. This must be done in the bundle's </span> <code>build()</code> <span> method.</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="be858e35-f469-453a-a207-18e44b5e8a02" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\FooBundle\AcmeFooBundle;

use Symfony\Component\HttpKernel\Bundle\Bundle;

class AcmeFooBundle extends Bundle
{
    public function build(ContainerBuilder $container)
    {
        parent::build($container);

        // ...
 
        // Retrieve "exponential" container extension.
        $eZExtension = $container->getExtension('exponential');
        // Add the policy provider.
        $eZExtension->addPolicyProvider(new MyPolicyProvider());
    }
}</pre></td></tr></table><h3><span>Core policies</span></h3><p><span> <span>Policies used internally in repository services are defined in </span> <code>
            <a href="https://github.com/ezsystems/exponential-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/config/policies.yml">EzPublishCoreBundle/Resources/config/policies.yml</a>
          </code> <span>.</span> </span></p><h2>SPI and API repositories</h2><p style="margin-left: 0.0px;">Those repositories are read-only split of <code>ezsystems/exponential-kernel</code>, made available to make dependencies easier and more lightweight.</p><h3 style="margin-left: 0.0px;">API</h3><p style="margin-left: 0.0px;">This package is a split of the Exponential 5 public API. It includes the <strong>services interfaces</strong> and <strong>domain objects</strong> from the <code>eZ\Publish\API</code> namespace.<br />It offers a lightweight way to make your project depend on the eZ API and Domain objects, without depending on the whole exponential-kernel.<br />The repository is read-only, automatically updated from <a href="https://github.com/ezsystems/exponential-kernel">https://github.com/ezsystems/exponential-kernel</a>.</p><p style="margin-left: 0.0px;">Requiring exponential-api in your project:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="262b2908-e27f-4182-9bc1-9a611fa2485d" data-macro-parameters="language=js" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingf871.png?definition=e2NvZGU6bGFuZ3VhZ2U9anN9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>"require": {
    "ezsystems/exponential-api": "~5.0"
}</pre></td></tr></table><h3 style="margin-left: 0.0px;">SPI</h3><p style="margin-left: 0.0px;">This package is a split of the Exponential 5 SPI (persistence interfaces).</p><p style="margin-left: 0.0px;">It can be used as a dependency, instead of the whole exponential-kernel, by packages implementing <strong>custom Exponential storage engines</strong>, or by any package that requires <strong>classes from the eZ\Publish\SPI namespace</strong>.</p><p style="margin-left: 0.0px;">The repository is read-only, automatically updated from <a href="https://github.com/ezsystems/exponential-kernel">https://github.com/ezsystems/exponential-kernel</a>.</p><p style="margin-left: 0.0px;">Requiring exponential-api in your project:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="5ed6de46-7e4a-4a4c-9f29-d67f3262f37b" data-macro-parameters="language=js" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingf871.png?definition=e2NvZGU6bGFuZ3VhZ2U9anN9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>"require": {
    "ezsystems/exponential-spi": "~5.0"
}</pre></td></tr></table><p> </p><h2>Signal Slots</h2><p>The Signal-Slot system provides a means for realizing loosely coupled dependencies in the sense that a code entity A can react on an event occurring in code entity B, without A and B knowing each other directly. This works by dispatching event information through a central third instance, the so called dispatcher:</p><p><img class="confluence-embedded-image image-center" src="../../download/attachments/31432023/schematics86c0.png?version=1&amp;modificationDate=1464096987000&amp;api=v2" data-image-src="/download/attachments/31432023/schematics.png?version=1&amp;modificationDate=1464096987000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="32113045" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="schematics.png" data-base-url="https://doc.ez.no" data-linked-resource-content-type="image/png" data-linked-resource-container-id="31432023" data-linked-resource-container-version="48" title="Developer > Repository > schematics.png" data-location="Developer > Repository > schematics.png" data-image-height="337" data-image-width="702"></p><p> </p><p>In the shown schematics, object B and one other object are interested in a certain signal. B is a so-called Slot that can be announced to be interested in receiving a Signal (indicated by the circular connector to the dispatcher). Object A now sends the corresponding Signal. The Dispatcher takes care of realizing the dependency and informs the Slot A (and one other Slot) about the occurrence of the Signal.</p><p>Signals roughly equal events, while Slots roughly equal event handlers. An arbitrary number (0…n) of Slots can listen for a specific Signal. Every object that receives the Dispatcher as a dependency can send signals. However, the following conditions apply (that typically do not apply to event handling systems):</p><ul><li>A Slot cannot return anything to the object that issued a signal</li><li>It is not possible for a Slot to stop the propagation of a Signal, i.e. all listening Slots will eventually receive the Signal</li></ul><p>Those two conditions allow the asynchronous processing of Slots. That means: It is possible to determine, by configuration, that a Slot must not receive a Signal in the very same moment it occurs, but to receive it on a later point in time, maybe after other Signals from a queue have been processed or even on a completely different server.</p><h3>Signal</h3><p>A Signal represents a specific event, e.g. that a content version has been published. It consists of information that is significant to the event, e.g. the content ID and version number. Therefore, a Signal is represented by an object of a class that is specific to the Signal and that extends from <code>eZ\Publish\Core\SignalSlot\Signal</code>. The full qualified name of the Signal class is used to uniquely identify the Signal. For example, the class <code>eZ\Publish\Core\SignalSlot\Signal\ContentService\PublishVersionSignal</code> identifies the example Signal.</p><p>In order to work properly with asynchronous processing, Signals must not consist of any logic and must not contain complex data structures (such as further objects and resources). Instead, they must be exportable using the <code>__set_state()</code> method, so that it is possible to transfer a Signal to a different system.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="da356c50-e79d-465b-90c2-0875b8ebfa41" data-macro-parameters="title=Note" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingb7a0.png?definition=e2luZm86dGl0bGU9Tm90ZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body">Signals can theoretically be sent by any object that gets hold of a SignalDispatcher (<code>eZ\Publish\Core\SignalSlot\SignalDispatcher</code>). However, at a first stage, <strong>Signals are only sent by special implementations of the Public API to indicate core events</strong>. These services must and will be used by default and will wrap the original service implementations.</td></tr></table><h3>Slot</h3><p>A Slot extends the system by realizing functionality that is executed when a certain Signal occurs. To implement a Slot, you must create a class that derives from <code>eZ\Publish\Core\SignalSlot\Slot</code>. The full qualified name of the Slot class is also used as the unique identifier of the Slot. The Slot base class requires you to implement the single method <code>receive()</code>. When your Slot is configured to listen to a certain Signal and this Signal occurs, the <code>receive()</code> method of your Slot is called.</p><p>Inside the <code>receive()</code> method of your Slot you can basically realize any kind of logic. However, it is recommended that you only dispatch the action to be triggered to a dedicated object. This allows you to trigger the same action from within multiple Slots and to re-use the implementation from a completely different context.</p><p>Note that, due to the nature of Signal-Slot, the following requirements must be fulfilled by your Slot implementation:</p><ul><li>A Slot must not return anything to the Signal issuer</li><li>A Slot must be aware that it is potentially executed delayed or even on a different server</li></ul><p style="margin-left: 30.0px;"><strong>Important</strong>: A single Slot should not take care of processing more than one Signal. Instead, if you need to trigger same or similar actions as different Signals occur. you should encapsulate these actions into a dedicated class, of which your Slots receive an instance to trigger this action.</p><h3>Example: Updating URL aliases</h3><p>Updating URL aliases is a typical process that can be realized through a Signal-Slot extension for different reasons:</p><ul><li>The action must be triggered on basis of different events (e.g. content update, location move, etc.)</li><li>Direct implementation would involve complex dependencies between otherwise unrelated services</li><li>The action is not critical to be executed immediately, but can be made asynchronous, if necessary</li></ul><p>As a first step it needs to be determined for which Signals we need to listen in order to update URL aliases. Some of them are:</p><ul><li><code>eZ\Publish\Core\SignalSlot\Signal\ContentService\PublishVersionSignal</code></li><li><code>eZ\Publish\Core\SignalSlot\Signal\LocationService\CopySubtreeSignal</code></li><li><code>eZ\Publish\Core\SignalSlot\Signal\LocationService\MoveSubtreeSignal</code></li><li>…</li></ul><p>There are of course additional Signals that trigger an update of URL aliases, but these are left out for simplicity here.</p><p>Now that we identified some Signals to react upon, we can start implementing Slots for these signals. For the first Signal, which is issued as soon as a new version of Content is published, there exists a method in <code>eZ\Publish\SPI\Persistence\Content\UrlAlias\Handler</code> for exactly that purpose: <code>publishUrlAliasForLocation()</code>. The Signal contains the ID of the content item and its newly published version number. Using this information, the corresponding Slot can fulfill its purposes with the following steps:</p><ol><li>Load the corresponding content and its locations</li><li>Call the URL alias creation method for each location</li></ol><p>To achieve this, the Slot has 2 dependencies:</p><ul><li><code>eZ\Publish\SPI\Persistence\Content\Handler</code> <br />to load the content itself in order to retrieve the names</li><li><code>eZ\Publish\SPI\Persistence\Content\Location\Handler</code> <br />to load the locations</li><li><p><code>eZ\Publish\SPI\Persistence\Content\UrlAlias\Handler</code> <br />to create the aliases for each location</p></li></ul><p>So, a stub for the implementation could look like this:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="413280a4-74e7-4ffd-b5e9-4b38dfd3e68a" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\TestBundle\Slot;

use eZ\Publish\Core\SignalSlot\Slot as BaseSlot;
use eZ\Publish\API\Repository\Repository;
use eZ\Publish\SignalSlot\Signal;

class CreateUrlAliasesOnPublishSlot extends BaseSlot
{
    /**
     * @var \eZ\Publish\API\Repository\Repository
     */
    private $repository;
    public function __construct( Repository $repository )
    {
        $this->repository = $repository;
    }

    public function receive( Signal $signal )
    {
        if ( !$signal instanceof Signal\ContentService\PublishVersionSignal )
        {
            return;
        }
        // Load content
        // Load locations
        // Create URL aliases
    }
}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="36a3d29b-5899-447a-96fc-b465a0fe4a8d" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>In order to make the newly created Slot react on the corresponding Signal, the following steps must be performed:</p><ol><li>Make the Slot available through the Symfony service container as a service</li><li>Register the Slot to react to the Signal of type <code>eZ\Publish\Core\SignalSlot\Signal\ContentService\PublishVersionSignal</code></li></ol><p>See the <a class="confluence-link" href="../../display/DEVELOPER/Listening%2bto%2bCore%2bevents.html" data-linked-resource-id="31429796" data-linked-resource-version="7" data-linked-resource-type="page" data-linked-resource-default-alias="Listening to Core events" data-base-url="../../index.html">Listening to Core events</a> recipe in the developer cookbook for more information.</p></td></tr></table><p> </p><p> </p><p> </p></div>
</div>
<div class="cell aside" data-type="aside">
<div class="innerCell">
<p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro7c73.png?definition=e3RvYzptYXhMZXZlbD0zfQ&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="357daf9d-2763-43d3-b625-cc5ce01930db" data-macro-parameters="maxLevel=3" data-macro-schema-version="1"></p><h4>Related:</h4><ul><li><a class="confluence-link" href="../../display/DEVELOPER/Steps%2bto%2bset%2bup%2bCluster.html" data-linked-resource-id="31432321" data-linked-resource-version="7" data-linked-resource-type="page" data-linked-resource-default-alias="Steps to set up Cluster" data-base-url="../../index.html">Overview of steps to set up Cluster</a><a class="confluence-link" href="#Repository-Persistencecacheconfiguration" data-anchor="Persistencecacheconfiguration" data-linked-resource-default-alias="Persistencecacheconfiguration" data-base-url="../../index.html">:</a><ul><li><a class="confluence-link" href="../../display/DEVELOPER/Clustering.html" data-linked-resource-id="31430387" data-linked-resource-version="19" data-linked-resource-type="page" data-linked-resource-default-alias="Clustering" data-base-url="../../index.html">Set up DFS IO Handler</a></li><li><a class="confluence-link" href="../../display/DEVELOPER/HTTP%2bCache.html#HTTPCache-UsingVarnish" data-anchor="UsingVarnish" data-linked-resource-id="31430152" data-linked-resource-version="22" data-linked-resource-type="page" data-linked-resource-default-alias="HTTP Cache#UsingVarnish" data-base-url="../../index.html">Set up Varnish</a></li><li><span class="confluence-link"><a class="confluence-link" href="../../display/DEVELOPER/Sessions.html" data-linked-resource-id="31429667" data-linked-resource-version="9" data-linked-resource-type="page" data-linked-resource-default-alias="Sessions" data-base-url="../../index.html">Configure sessions</a></span></li></ul></li></ul></div>
</div>
</div>
</div>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=31432023 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:26:00 GMT -->
</html>
