                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=32113991 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 11:38:39 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage7893.html?pageId=32113991" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/16/_/styles/colors.css" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <div class="contentLayout2">
<div class="columnLayout two-right-sidebar" data-layout="two-right-sidebar">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1 class="confluence-link">Introduction</h1><p class="confluence-link">eZ Platform exposes very powerful Search API, allowing both Full Text search and querying the content repository using several built-in <span class="confluence-link">Criteria</span> and <span class="confluence-link">Sort Clauses</span>. These are supported across several search engines, allowing you to plug in another search engine without changing your code.</p><h2>Available Search Engines</h2><p>Currently 3 search engines exists on their own eZ Platform Bundles:</p><ol><li><a class="confluence-link" href="../../display/DEVELOPER/Legacy%2bSearch%2bEngine%2bBundle.html" data-linked-resource-id="31430581" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy Search Engine Bundle" data-base-url="https://doc.ez.no">Legacy</a>, a database-powered search engines for basic needs.</li><li><a class="confluence-link" href="../../display/DEVELOPER/Solr%2bBundle.html" data-linked-resource-id="31430592" data-linked-resource-version="28" data-linked-resource-type="page" data-linked-resource-default-alias="Solr Bundle" data-base-url="https://doc.ez.no">Solr</a>, an integration providing better overall performance, much better scalability and support for more advance search capabilities <img class="editor-inline-macro" height="18" width="88" src="../servlet/status-macro/placeholder464a.png?title=Recommended&amp;colour=Green" data-macro-name="status" data-macro-id="b90b753e-621b-488a-886f-ce23d0e5c489" data-macro-parameters="colour=Green|title=Recommended" data-macro-schema-version="1"></li><li><a class="confluence-link" href="../../display/DEVELOPER/ElasticSearch%2bBundle.html" data-linked-resource-id="31430579" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="ElasticSearch Bundle" data-base-url="https://doc.ez.no">ElasticSearch</a>, similar to Solr integration, however currently not under active development <img class="editor-inline-macro" height="18" width="88" src="../servlet/status-macro/placeholder4d5b.png?title=Experimental%2C+not+supported&amp;colour=Red" data-macro-name="status" data-macro-id="dbcda7e6-feb5-45d3-8636-1106db6cf7c8" data-macro-parameters="colour=Red|title=Experimental, not supported" data-macro-schema-version="1"></li></ol><p> </p><p> </p><h1>Usage</h1><h2>Search Criteria and Sort Clauses</h2><p><span class="confluence-link">Search <span class="confluence-link">Criteria</span></span><span class="confluence-link"> </span> and <span class="confluence-link">Sort Clauses</span> are <code>value</code> object classes used for building Search Query, to define filter criteria and ordering of the result set. eZ Platform provides a number of standard Criteria and Sort Clauses that you can use out of the box and that should cover the majority of use cases.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="49d786bf-6dee-48e2-82e2-456a4c629206" data-macro-parameters="language=php|linenumbers=true|title=Example of standard ContentId criterion" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bcc.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPUV4YW1wbGUgb2Ygc3RhbmRhcmQgQ29udGVudElkIGNyaXRlcmlvbnxsaW5lbnVtYmVycz10cnVlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php

namespace eZ\Publish\API\Repository\Values\Content\Query\Criterion;

use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\Operator\Specifications;
use eZ\Publish\API\Repository\Values\Content\Query\CriterionInterface;

/**
 * A criterion that matches content based on its id
 *
 * Supported operators:
 * - IN: will match from a list of ContentId
 * - EQ: will match against one ContentId
 */
class ContentId extends Criterion implements CriterionInterface
{
    /**
     * Creates a new ContentId criterion
     *
     * @param int|int[] $value One or more content Id that must be matched.
     *
     * @throws \InvalidArgumentException if a non numeric id is given
     * @throws \InvalidArgumentException if the value type doesn't match the operator
     */
    public function __construct( $value )
    {
        parent::__construct( null, null, $value );
    }

    public function getSpecifications()
    {
        $types = Specifications::TYPE_INTEGER | Specifications::TYPE_STRING;
        return array(
            new Specifications( Operator::IN, Specifications::FORMAT_ARRAY, $types ),
            new Specifications( Operator::EQ, Specifications::FORMAT_SINGLE, $types ),
        );
    }

    public static function createFromQueryBuilder( $target, $operator, $value )
    {
        return new self( $value );
    }
}</pre></td></tr></table><h3>Search Engine Handling of Search Criteria and Sort Clauses</h3><p>As <span class="confluence-link">Search Criteria</span> and <span class="confluence-link">Sort Clauses</span> are <code>value</code> objects which are used to define the Query from API perspective, they are are common for all storage engines. Each storage engine needs to implement its own <code>handler</code> for corresponding Criterion and Sort Clause <code>value</code> object, which will be used to translate the value object into storage specific search query.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="6523eb04-c680-4591-b018-f8e6b7d39220" data-macro-parameters="language=php|linenumbers=true|title=Example of ContentId criterion handler in Legacy Storage Engine" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingaa8c.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPUV4YW1wbGUgb2YgQ29udGVudElkIGNyaXRlcmlvbiBoYW5kbGVyIGluIExlZ2FjeSBTdG9yYWdlIEVuZ2luZXxsaW5lbnVtYmVycz10cnVlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php

namespace eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler;

use eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler;
use eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriteriaConverter;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\Core\Persistence\Database\SelectQuery;

/**
 * Content ID criterion handler
 */
class ContentId extends CriterionHandler
{
    /**
     * Check if this criterion handler accepts to handle the given criterion.
     *
     * @param \eZ\Publish\API\Repository\Values\Content\Query\Criterion $criterion
     *
     * @return boolean
     */
    public function accept( Criterion $criterion )
    {
        return $criterion instanceof Criterion\ContentId;
    }


    /**
     * Generate query expression for a Criterion this handler accepts
     *
     * accept() must be called before calling this method.
     *
     * @param \eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriteriaConverter $converter
     * @param \eZ\Publish\Core\Persistence\Database\SelectQuery $query
     * @param \eZ\Publish\API\Repository\Values\Content\Query\Criterion $criterion
     *
     * @return \eZ\Publish\Core\Persistence\Database\Expression
     */
    public function handle( CriteriaConverter $converter, SelectQuery $query, Criterion $criterion )
    {
        return $query->expr->in(
            $this->dbHandler->quoteColumn( "id", "ezcontentobject" ),
            $criterion->value
        );
    }
}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="10937478-df1b-4584-8952-f7ae0206cb5c" data-macro-parameters="language=php|linenumbers=true|title=Example of ContentId criterion handler in Solr Storage engine" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headinga654.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfHRpdGxlPUV4YW1wbGUgb2YgQ29udGVudElkIGNyaXRlcmlvbiBoYW5kbGVyIGluIFNvbHIgU3RvcmFnZSBlbmdpbmV8bGluZW51bWJlcnM9dHJ1ZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php

namespace EzSystems\EzPlatformSolrSearchEngine\Query\Content\CriterionVisitor;

use EzSystems\EzPlatformSolrSearchEngine\Query\CriterionVisitor;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\Operator;

/**
 * Visits the ContentId criterion
 */
class ContentIdIn extends CriterionVisitor
{
    /**
     * CHeck if visitor is applicable to current criterion
     *
     * @param Criterion $criterion
     *
     * @return boolean
     */
    public function canVisit( Criterion $criterion )
    {
        return
            $criterion instanceof Criterion\ContentId &amp;&amp;
            ( ( $criterion->operator ?: Operator::IN ) === Operator::IN ||
              $criterion->operator === Operator::EQ );
    }


    /**
     * Map field value to a proper Solr representation
     *
     * @param Criterion $criterion
     * @param CriterionVisitor $subVisitor
     *
     * @return string
     */
    public function visit( Criterion $criterion, CriterionVisitor $subVisitor = null )
    {
        return '(' .
            implode(
                ' OR ',
                array_map(
                    function ( $value )
                    {
                        return 'id:"' . $value . '"';
                    },
                    $criterion->value
                )
            ) .
            ')';
    }
}</pre></td></tr></table><h3>Custom Criteria and Sort Clauses</h3><p>Sometimes you will find that standard <span class="confluence-link"><span class="confluence-link">Search Criteria</span></span> and <span class="confluence-link">Sort Clauses</span> provided with Exponential are not sufficient for you needs. Most often this will be the case if you have developed a custom <span class="confluence-link">Field Type</span> using external storage, which therefore can not be searched using standard Field Criterion.</p><table class="wysiwyg-macro" data-macro-name="warning" data-macro-id="9ffc24fa-6793-4bff-bf1e-5d9d67ec2f63" data-macro-parameters="title=On use of Field Criterion/SortClause with large databases" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd24b.png?definition=e3dhcm5pbmc6dGl0bGU9T24gdXNlIG9mIEZpZWxkIENyaXRlcmlvbi9Tb3J0Q2xhdXNlIHdpdGggbGFyZ2UgZGF0YWJhc2VzfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Field Criterion/SortClause does not perform well by design when using SQL database, so if you have a large database and want to use them you either need to use Solr search engine, or develop your own Custom Criterion / Sort Clause to avoid use of attributes (Fields) database table, and instead uses a custom simplified table which can handle the amount of data you have.</p></td></tr></table><p>In this case you can implement a custom Criterion or Sort Clause, together with the corresponding handlers for the storage engine you are using.</p><h3>Difference between Content and Location Search</h3><p>These are two basic types of searches, you can either search for Locations or for Content. Each has dedicated methods in Search Service:</p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Type of search</th><th class="confluenceTh">Method in Search Service</th></tr><tr><td class="confluenceTd">Content</td><td class="confluenceTd"><code>findContent()</code></td></tr><tr><td colspan="1" class="confluenceTd">Content</td><td colspan="1" class="confluenceTd"><code>findSingle()</code></td></tr><tr><td class="confluenceTd">Location</td><td class="confluenceTd"><code>findLocations()</code></td></tr></tbody></table><p>All Criteria and Sort Clauses will be accepted with Location Search, but not all of them can be used with Content Search. Reason for this is that while one Location always has exactly one Content item, one Content item can have multiple Locations. In this context some Criteria and Sort Clauses would produce ambiguous queries and such will therefore not be accepted by Content Search.</p><p>Content Search will explicitly refuse to accept Criteria and Sort Clauses implementing these abstract classes:</p><ul><li><pre>eZ\Publish\API\Repository\Values\Content\Query\<span>Criterion\</span>Location</pre></li><li><pre>eZ\Publish\API\Repository\Values\Content\SortClause\<span>Criterion\</span>Location</pre></li></ul><h3>How to configure your own Criterion and Sort Clause Handlers</h3><p>After you have implemented your Criterion / Sort Clause and its handler, you will need to configure the handler for the service container using dedicated service tags for each type of search. Doing so will automatically register it and handle your Criterion / Search Clause when it is given as a parameter to one of the Search Service methods.</p><p>Available tags for Criterion handlers in Legacy Storage Engine are:</p><ul><li><code>exponential.<span>search</span>.legacy.gateway.criterion_handler.content</code></li><li><code>exponential.<span>search</span>.legacy.gateway.criterion_handler.location</code></li></ul><p>Available tags for Sort Clause handlers in Legacy Storage Engine are:</p><ul><li><code>exponential.<span>search</span>.legacy.gateway.sort_clause_handler.content</code></li><li><code>exponential.<span>search</span>.legacy.gateway.sort_clause_handler.location</code></li></ul><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="4e30ca1d-3fda-40b9-806b-1f14859480e9" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>You will find all the native handlers and the tags for the Legacy Storage Engine available in the eZ/Publish/Core/settings/storage_engines/legacy<span class="separator">/</span><strong class="final-path">search_query_handlers.yml</strong> file.</p></td></tr></table><h4>Example of registering ContentId Criterion handler, common for both Content and Location Search</h4><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="7369ddb2-7cd7-4492-9aa8-2a2360f9b9ca" data-macro-parameters="language=bash|title=Registering Criterion handler" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading9daf.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1SZWdpc3RlcmluZyBDcml0ZXJpb24gaGFuZGxlcn0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>services:
    exponential.search.legacy.gateway.criterion_handler.common.content_id:
        class: eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler\ContentId
        arguments: [@exponential.api.storage_engine.legacy.dbhandler]
        tags:
          - {name: exponential.search.legacy.gateway.criterion_handler.content}
          - {name: exponential.search.legacy.gateway.criterion_handler.location}</pre></td></tr></table><h4>Example of registering Depth Sort Clause handler for Location Search</h4><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="2dbe7578-e062-4eca-82aa-9c01836f9d57" data-macro-parameters="language=bash|title=Registering Sort Clause handler" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1b59.png?definition=e2NvZGU6bGFuZ3VhZ2U9YmFzaHx0aXRsZT1SZWdpc3RlcmluZyBTb3J0IENsYXVzZSBoYW5kbGVyfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>exponential.search.legacy.gateway.sort_clause_handler.location.depth:
    class: eZ\Publish\Core\Search\Legacy\Content\Location\Gateway\SortClauseHandler\Location\Depth
    arguments: [@exponential.api.storage_engine.legacy.dbhandler]
    tags:
        - {name: exponential.search.legacy.gateway.sort_clause_handler.location}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="76a20654-ed97-4df4-a361-0710c29d9ecb" data-macro-parameters="title=See also" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57-2.png?definition=e2luZm86dGl0bGU9U2VlIGFsc299&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>See also <a href="http://symfony.com/doc/current/book/service_container.html#service-parameters">Symfony documentation about Service Container</a> for passing parameters</p></td></tr></table><p> </p><h3 class="line">Criteria Independence Example</h3><div class="line">With Exponential you can have multiple location content. Criterions do not relate to others criterion you can  use the Public API and Criterion to search this content, it can lead to a comportement you are not expecting.</div><div class="line">Example of Criterions not relating to each other:</div><div class="line"> </div><div class="line">There is a Content with two Locations: Location A and Location B</div><ul><li class="line">Location A is visible</li><li class="line">Location B is hidden</li></ul><div class="line"> </div><div class="line">Searching with LocationId criterion with Location B id and Visibility criterion with Visibility::VISIBLE will return the Content because conditions are satisfied:</div><ul><li class="line">Content has Location B</li><li class="line">Content is visible (it has Location A that is visible)</li></ul><div class="line"> </div><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="34e99f34-9f87-4345-bf76-ad016de426e1" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php
 
use eZ\Publish\API\Repository\Values\Content\Query;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\LogicalAnd;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\LocationId;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\Visibility;
 
/** @var string|int $locationBId */
/** @var \eZ\Publish\API\Repository\Repository $repository */

$searchService = $repository->getSearchService();
 
$query = new Query(
    array(
        'filter' => new LogicalAnd(
            array(
                new LocationId( $locationBId ),
                new Visibility( Visibility::VISIBLE ),
            )
        )
    )
);
 
$searchResult = $searchService->findContent( $query );
 
// Content is found
$content = $searchResult->searchHits[0];</pre></td></tr></table><p> </p><p> </p><p> </p><h1>Reference</h1><p> </p><h2>Search Criteria Reference</h2><p><strong>Criteria</strong> are the filters for Content and Location Search, for generic use of API Search see <a class="confluence-link" href="../../display/DEVELOPER/Search.html#Search-SearchCriteriaandSearchClauses" data-anchor="SearchCriteriaandSearchClauses" data-linked-resource-default-alias="SearchCriteriaandSearchClauses" data-base-url="../../index.html"><span class="confluence-link">Search Criteria and Sort Clauses</span></a><span class="confluence-link"> </span>.</p><p>A Criterion consist of two parts just like <span class="confluence-link">SortClause</span> and FacetBuilder:</p><ul><li>The API Value: <code>Criterion</code></li><li>Specific handler per search engine: <code>Criterion Handler</code></li></ul><p><code>Criterion</code> represents the value you use in the API, while <code>CriterionHandler</code> deals with the business logic in the background translating the value to something the Search engine can understand.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="1f646574-92ab-4676-be65-4eab94a58c9c" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Implementation and availability of a handler typically depends on search engine capabilities and limitations, currently only Legacy (SQL) Search Engine exists, and for instance its support for FullText and Field Criterion is not optimal and it is advised to avoid heavy use of these until future search engine arrives.</p></td></tr></table><h3>Common concepts for most Criteria</h3><p>For how to use each and every Criterion see the list below, as it depends on the Criterion Value constructor, but <em>in general</em> you should be aware of the following common concepts:</p><ul><li><code>target</code>: Exposed if the given Criterion supports targeting a specific sub field, example: FieldDefinition or Meta Data identifier</li><li><code>value</code>: The value(s) to <em>filter</em> on, this is typically a  <code>scalar</code> or <code>array</code> of<code> scalars.</code></li><li><code>operator</code>: Exposed on some Criteria<ul><li>All operators can be seen on <code>eZ\Publish\API\Repository\Values\Content\Query\Criterion\Operator</code>, at time of writing: <code>IN, EQ, GT, GTE, LT, LTE, LIKE, BETWEEN, CONTAINS</code></li><li>Most Criteria do not expose this and select <code>EQ</code> <strong>or</strong> <code>IN</code> depending on if value is <code>scalar</code> <strong>or</strong> <code>array</code></li><li><code>IN</code> &amp; <code>BETWEEN
        </code>always acts on an <code>array</code> of values, while the other operators act on single <code>scalar</code> value</li></ul></li><li><span> <code>valueData</code> : <span class="pl-s1"> <span class="pl-c">Additional value data, required by some Criteria, MapLocationDistance for instance</span> </span> </span></li></ul><p> </p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="7c8578d0-89ff-44af-a0a7-f0909416c8e2" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>In the Legacy search engine, the field index/sort key column is limited to 255 characters by design.<br />Due to this storage limitation, searching content using the eZ Country Field Type when there are multiple countries selected may not return all the expected results.</p></td></tr></table><p><span> <span class="pl-s1"> <span class="pl-c"> <br /> </span> </span> </span></p><h3>List of Criteria</h3><p>The list below reflects Criteria available in the <code>eZ\Publish\API\Repository\Values\Content\Query\Criterion</code> namespace (it is also possible to <span class="confluence-link">make a custom Criterion</span>):</p><h4>Only for LocationSearch</h4><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Criterion</th><th class="confluenceTh">Constructor arguments description</th></tr><tr><td colspan="1" class="confluenceTd"><code>Location\Depth</code></td><td colspan="1" class="confluenceTd"><code>operator</code> (<code>IN, EQ, GT, GTE, LT, LTE, BETWEEN</code>), <code>value</code> being the Location depth(s) as an integer(s).</td></tr><tr><td colspan="1" class="confluenceTd"><code>Location\IsMainLocation</code></td><td colspan="1" class="confluenceTd">Whether or not the Location is a Main Location<br /><code>value</code> (<code>Location\IsMainLocation::MAIN</code>, <code>Location\IsMainLocation::NOT_MAIN</code>).</td></tr><tr><td colspan="1" class="confluenceTd"><code>Location\Priority</code></td><td colspan="1" class="confluenceTd">Priorities are integers that can be used for sorting in ascending or descending order. What is higher or lower priority in relation to the priority number is left to the user choice.<br /><code>operator</code> (<code>GT, GTE, LT, LTE, BETWEEN</code>), <code>value</code> being the location priority(s) as an integer(s).</td></tr></tbody></table><p> </p><h4>Common</h4><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Criterion</th><th class="confluenceTh">Constructor arguments description</th></tr><tr><td colspan="1" class="confluenceTd"><code>ContentId</code></td><td colspan="1" class="confluenceTd"><span> <code>value </code>being scalar(s) representing the Content id.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>ContentTypeGroupId</code></td><td colspan="1" class="confluenceTd"><code>value </code>being <span> scalar(s) representing the Content Typ eGroup id.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>ContentTypeId</code></td><td colspan="1" class="confluenceTd"><code>value </code>being <span> scalar(s) representing the Content Type id.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>
          <span>ContentTypeIdentifier </span></code></td><td colspan="1" class="confluenceTd"><code>value </code>being <span> string(s) representing the Content Type identifier, example: &quot;article&quot;.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>DateMetadata</code></td><td colspan="1" class="confluenceTd"><span> <code>target (</code><code>DateMetadata</code> </span> <span> <code>::MODIFIED</code><code>, DateMetadata</code> </span> <code>::CREATED), <code>operator</code> (<code>IN, EQ, GT, GTE, LT, LTE</code>,</code> <code>
          <code>BETWEEN</code>),</code> <code>
          <code>value</code>
        </code> being <span>integer</span>(s) representing unix timestamp.</td></tr><tr><td colspan="1" class="confluenceTd"><code>Field</code></td><td colspan="1" class="confluenceTd"><p><span> <code>target</code> <code>(</code>FieldDefinition identifier</span><code>), <code>operator</code>
          </code> <span> (</span><code><code>IN, EQ, GT, GTE, LT, LTE</code>, LIKE,</code><span> </span> <code>
            <code>BETWEEN, CONTAINS</code>),</code> <code>
            <code>value</code>
          </code> <span> being</span> <span> scalar(s) relevant for the field.</span></p></td></tr><tr><td colspan="1" class="confluenceTd"><code>FieldRelation</code></td><td colspan="1" class="confluenceTd"><span> <code>target</code> <code>(</code>FieldDefinition identifier</span><code>),<code> operator</code>
        </code> <span> (</span><code><code>IN</code></code><code><code>, CONTAINS</code>),</code> <code><code>value</code>
        </code> <span> being</span> <span> array of scalars representing Content id of relation.<br /> <em>Use of <code>IN</code> means relation needs to have one of the provided ID's, while <code>CONTAINS</code> implies it needs to have all provided id's.</em> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>FullText</code></td><td colspan="1" class="confluenceTd"><p><code>value</code> being the string to search for, <code>properties</code> is array to set additional properties for use with future search engines like Solr/ElasticSearch.</p></td></tr><tr><td colspan="1" class="confluenceTd"><code>LanguageCode</code></td><td colspan="1" class="confluenceTd"><code>value</code> being string(s) representing Language Code(s) on the Content (<em>not</em> on <a href="https://jira.ez.no/browse/EZP-23524">Fields</a>), <code>matchAlwaysAvailable</code> as boolean.</td></tr><tr><td colspan="1" class="confluenceTd"><code>LocationId</code></td><td colspan="1" class="confluenceTd"><code>value</code> being <span> scalar(s) representing the Location id.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>LocationRemoteId</code></td><td colspan="1" class="confluenceTd"><code>value</code> being <span> string(s) representing the Location Remote id.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>LogicalAnd</code></td><td colspan="1" class="confluenceTd">A <span> <code>LogicalOperator</code> that takes <code>array</code> of other Criteria, makes sure all Criteria match.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>LogicalNot</code></td><td colspan="1" class="confluenceTd"><span>A </span> <span> <code>LogicalOperator</code> that takes <code>array</code> of other Criteria, makes sure none of the Criteria match.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>LogicalOr</code></td><td colspan="1" class="confluenceTd"><span>A </span> <span> <code>LogicalOperator</code> that takes <code>array</code> of other Criteria, makes sure one of the Criteria match.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>MapLocationDistance</code></td><td colspan="1" class="confluenceTd"><span> <code>target</code> <code>(</code>FieldDefinition identifier</span><code>), <code>operator</code>
        </code> <span> (</span> <code>
          <code>IN, EQ, GT, GTE, LT, LTE</code>, </code> <code>
          <code>BETWEEN</code>),</code> <code> <code>distance</code>
        </code> <span> as</span> <span> float(s) from a position using <code> latitude
           </code><span> as</span> <span> float</span><code>,</code> <code>
            <code>longitude</code>
          </code> <span> as</span> <span> float as arguments<br /> </span> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>MatchAll</code></td><td colspan="1" class="confluenceTd"><em>No arguments, mainly for internal use when no <code>filter</code> or <code>query</code> is provided on <code>Query</code> object.</em></td></tr><tr><td colspan="1" class="confluenceTd"><code>MatchNone</code></td><td colspan="1" class="confluenceTd"><em> <em>No arguments, m</em>ainly for internal use by <a class="confluence-link" href="../../display/DEVELOPER/BlockingLimitation.html" data-linked-resource-id="31430461" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="BlockingLimitation" data-base-url="../../index.html">BlockingLimitation</a>.</em></td></tr><tr><td colspan="1" class="confluenceTd"><code>ObjectStateId</code></td><td colspan="1" class="confluenceTd"><code>value</code> being <span> string(s) representing the Content ObjectState id.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>ParentLocationId</code></td><td colspan="1" class="confluenceTd"><p><span>value being scalar(s) representing the Parent's Location id</span></p></td></tr><tr><td colspan="1" class="confluenceTd"><code>RemoteId</code></td><td colspan="1" class="confluenceTd"><code>value</code> being <span> string(s) representing the Content Remote id.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>SectionId</code></td><td colspan="1" class="confluenceTd"><code>value</code> being <span> scalar(s) representing the Content Section id.</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>Subtree</code></td><td colspan="1" class="confluenceTd"><code>value</code> being <span> string(s) representing the Location id in which you can filter. <em>If the Location Id is  /1/2/20/42, you will filter everything under 42.</em> <br /> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>UserMetadata</code></td><td colspan="1" class="confluenceTd"><span> <code>target (<span>UserMetadata</span>
          </code> </span> <span> <code>::OWNER</code> <code>, <span>UserMetadata</span>
          </code> </span> <code>::GROUP<span> <code>, UserMetadata</code> </span>
          <code>::MODIFIER</code>), <code>operator</code> (<code>IN, EQ</code>
        </code> <code>),</code> <code> <code>value</code>
        </code> <span> being </span> <span>scalars</span> <span>(s) representing the User or User Group id(s).</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>Visibility</code></td><td colspan="1" class="confluenceTd"><span> <code>value (<span>Visibility</span>
          </code> </span> <span> <code>::VISIBLE</code> <code>, <span>Visibility</span>
          </code> </span> <code>::HIDDEN),</code> <em> Note: This acts on all assigned locations when used with ContentSearch, meaning hidden content will be returned if it has a location which is visible. Use LocationSearch to avoid this.</em></td></tr></tbody></table><p> </p><p> </p><h2>Sort Clauses Reference</h2><p><strong>Sort Clauses</strong> are the <em>sorting options</em> for Content and Location Search in eZ Platform. For generic use of API Search see <span class="confluence-link"><a class="confluence-link" href="../../display/DEVELOPER/Search.html#Search-SearchCriteriaandSortClauses" data-anchor="SearchCriteriaandSortClauses" data-linked-resource-default-alias="SearchCriteriaandSortClauses" data-base-url="../../index.html">Search Criteria and Sort Clauses</a></span>.</p><p>A Sort Clause consists of two parts just like <span class="confluence-link"><span class="confluence-link">Criterion</span> </span>and FacetBuilder:</p><ul><li>The API Value: <code>SortClause</code></li><li>Specific handler per search engine: <code>SortClausesHandler</code></li></ul><p>The <code>SortClause</code> represents the value you use in the API, while <code><span>SortClause</span>Handler</code> deals with the business logic in the background, translating the value to something the Search engine can understand.</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="b3e75497-15e5-4871-bcae-90a9484d5e2d" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Implementation and availability of a handler sometimes depends on search engine capabilities and limitations.</p></td></tr></table><h3>Common concepts for all <span>Sort Clauses </span></h3><p>For how to use each and every <span>Sort Clause,</span> see list below as it depends on the <span>Sort Clause</span> Value constructor, but <em>in general</em> you should be aware of the following common concept:</p><ul><li><p><code>sortDirection</code>: The direction to perform the sort, either <code><span>Query::<span style="color: rgb(102,14,122);">SORT_ASC</span></span></code> <em>(default)</em> or <code>
        <span>Query::</span>
        <span style="color: rgb(102,14,122);">SORT_DESC</span>
      </code></p></li></ul><h3>List of <span>Sort Clauses </span></h3><p>The list below reflects <span>Sort Clauses</span> available in the <code>eZ\Publish\API\Repository\Values\Content\Query\<span>SortClause</span></code> namespace (it is also possible to <span class="confluence-link">make a custom Sort Clause</span>):</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="2279999f-7920-4c8d-a319-05786bb288fc" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Arguments starting with &quot;<code>?</code>&quot; are optional.</p></td></tr></table><h4>Only for LocationSearch</h4><table class="confluenceTable"><tbody><tr><th class="highlight-grey confluenceTh" data-highlight-colour="grey"><span>Sort Clause</span></th><th class="confluenceTh">Constructor arguments description</th></tr><tr><td colspan="1" class="confluenceTd"><code>Location\Depth </code></td><td colspan="1" class="confluenceTd">?<code>sortDirection</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>
          <span>Location\Id </span></code></td><td colspan="1" class="confluenceTd"><span>?</span><code>sortDirection</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>Location\IsMainLocation </code></td><td colspan="1" class="confluenceTd"><span>?</span><code>sortDirection</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>
          <span>Location\Depth </span></code></td><td colspan="1" class="confluenceTd"><span>?</span><code>sortDirection</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>
          <span>Location\<span>Priority </span></span></code></td><td colspan="1" class="confluenceTd"><span>?</span><code>sortDirection</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>Location\Visibility </code></td><td colspan="1" class="confluenceTd">?<code>sortDirection</code></td></tr></tbody></table><p> </p><h4>Common</h4><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><span>Sort Clause</span></th><th class="confluenceTh">Constructor arguments description</th></tr><tr><td colspan="1" class="confluenceTd"><code>ContentId</code></td><td colspan="1" class="confluenceTd"><code>?sortDirection</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>ContentName</code></td><td colspan="1" class="confluenceTd"><span> <code>?sortDirection</code> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>DateModified</code></td><td colspan="1" class="confluenceTd"><code>?sortDirection</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>
          <span>DatePublished</span>
        </code></td><td colspan="1" class="confluenceTd"><code>?sortDirection</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>Field</code></td><td colspan="1" class="confluenceTd"><p><code>typeIdentifier</code> as string<code>, fieldIdentifier</code> as string<code>, ?sortDirection, <span>?languageCode</span> </code>as string</p></td></tr><tr><td colspan="1" class="confluenceTd"><code>MapLocationDistance </code></td><td colspan="1" class="confluenceTd"><span> <code>typeIdentifier</code> <span> as string</span> <code>, fieldIdentifier</code> <span> as string</span> <code>, </code> <code>
            <code>latitude</code>
          </code> <span> as</span> <span> float</span> <code>,</code> <span> </span> <code>
            <code>longitude</code>
          </code> <span> as</span> <span> float, ?</span> </span> <code>sortDirection<code>, ?languageCode</code>
        </code> <span> as string</span></td></tr><tr><td colspan="1" class="confluenceTd"><code>SectionIdentifier</code></td><td colspan="1" class="confluenceTd"><span> ?<code>sortDirection</code> </span></td></tr><tr><td colspan="1" class="confluenceTd"><code>SectionName</code></td><td colspan="1" class="confluenceTd"><span> ?<code>sortDirection</code> </span></td></tr></tbody></table><p> </p><p> </p></div>
</div>
<div class="cell aside" data-type="aside">
<div class="innerCell">
<h4>In this topic:</h4><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro7c73.png?definition=e3RvYzptYXhMZXZlbD0zfQ&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="56e9583b-7d4a-46c1-8d78-5600c98ad5a4" data-macro-parameters="maxLevel=3" data-macro-schema-version="1"></p><h4>Related topics:</h4><p><a class="confluence-link" href="../../display/DEVELOPER/Legacy%2bSearch%2bEngine%2bBundle.html" data-linked-resource-id="31430581" data-linked-resource-version="2" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy Search Engine Bundle" data-base-url="../../index.html">Legacy Search Engine Bundle</a></p><p><a class="confluence-link" href="../../display/DEVELOPER/Solr%2bBundle.html" data-linked-resource-id="31430592" data-linked-resource-version="28" data-linked-resource-type="page" data-linked-resource-default-alias="Solr Bundle" data-base-url="../../index.html">Solr Bundle</a></p><p><a class="confluence-link" href="../../display/DEVELOPER/ElasticSearch%2bBundle.html" data-linked-resource-id="31430579" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="ElasticSearch Bundle" data-base-url="../../index.html">ElasticSearch Bundle</a></p></div>
</div>
</div>
</div>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=32113991 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 11:38:39 GMT -->
</html>
