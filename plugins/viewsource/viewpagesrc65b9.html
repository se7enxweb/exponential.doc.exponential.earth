                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12781277 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 13:51:13 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage65b9.html?pageId=12781277" />
        <link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1f2a9c4c7f2593422cc9b02d1a652a22/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/26ac2724af3c6ece1051365650d982fa/_/download/contextbatch/css/editor-content/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/12/_/styles/colors.css" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macrob964.png?definition=e2V4Y2VycHQtaW5jbHVkZTplWiBQdWJsaXNoIERvY3VtZW50YXRpb259&amp;locale=en_GB&amp;version=2" data-macro-name="excerpt-include" data-macro-default-parameter="Exponential Documentation"></p><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc"></p><h2>Assigning section to content</h2><table class="wysiwyg-macro" data-macro-name="info" data-macro-parameters="title=Full  code" style="background-image: url(../servlet/confluence/placeholder/macro-headingbe9c.png?definition=e2luZm86dGl0bGU9RnVsbCAgY29kZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><a href="https://github.com/docb22/exponential-cookbook/tree/master/EzSystems/CookBookBundle/Command/AssignContentToSectionCommand.php">https://github.com/ezsystems/CookbookBundle/tree/master/Command/AssignContentToSectionCommand.php</a></p></td></tr></table><p>The Section a Content belongs to can be set during creation, using the <code>ContentCreateStruct::$sectionId</code> property. However, as for many Repository objects properties, the section can't be changed using a <code>ContentUpdateStruct</code>. The reason is still the same: changing a Content's section will affect the subtrees referenced by its Locations. For this reason, it is required that you use the SectionService to change the Section of a Content.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=assign section to content" style="background-image: url(../servlet/confluence/placeholder/macro-heading9728.png?definition=e2NvZGU6dGl0bGU9YXNzaWduIHNlY3Rpb24gdG8gY29udGVudHxsYW5ndWFnZT1waHB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$contentInfo = $contentService->loadContentInfo( $contentId );
$section = $sectionService->loadSection( $sectionId );
$sectionService->assignSection( $contentInfo, $section );</pre></td></tr></table><p>This operation involves the <code>SectionService</code>, as well as the <code>ContentService</code>.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=assign section to content" style="background-image: url(../servlet/confluence/placeholder/macro-heading9728.png?definition=e2NvZGU6dGl0bGU9YXNzaWduIHNlY3Rpb24gdG8gY29udGVudHxsYW5ndWFnZT1waHB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$contentInfo = $contentService->loadContentInfo( $contentId );</pre></td></tr></table><p>We use <code>ContentService::loadContentInfo()</code> to get the Content we want to update the Section for.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=assign section to content" style="background-image: url(../servlet/confluence/placeholder/macro-heading9728.png?definition=e2NvZGU6dGl0bGU9YXNzaWduIHNlY3Rpb24gdG8gY29udGVudHxsYW5ndWFnZT1waHB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$section = $sectionService->loadSection( $sectionId );</pre></td></tr></table><p>SectionService::loadSection() is then used to load the Section we want to assign our Content to. Note that there is no SectionInfo object. Sections are quite simple, and we don't need to separate their metadata from their actual data. However, <code><a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/Values/Content/SectionCreateStruct">SectionCreateStruct</a></code> and <a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/Values/Content/SectionUpdateStruct"><code>SectionUpdateStruct</code></a> objects must still be used to create and update sections.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=assign section to content" style="background-image: url(../servlet/confluence/placeholder/macro-heading9728.png?definition=e2NvZGU6dGl0bGU9YXNzaWduIHNlY3Rpb24gdG8gY29udGVudHxsYW5ndWFnZT1waHB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$sectionService->assignSection( $contentInfo, $section );</pre></td></tr></table><p>The actual update operation is done using SectionService::assignSection(), with the ContentInfo and the Section as arguments.</p><table class="wysiwyg-macro" data-macro-name="note" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57.png?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>SectionService::assignSection() won't return the updated Content, as it has no knowledge of those objects. To get the Content with the newly assigned Location, you need to reload the ContentInfo using <a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/ContentService#method_loadContentInfo"><code>ContentService::loadContentInfo()</code></a>. This is also valid for descendants of Content. If you have any stored in your execution state, you need to reload them. Otherwise you would be using outdated Content data.</p></td></tr></table><h2>Creating a content type</h2><table class="wysiwyg-macro" data-macro-name="info" data-macro-parameters="title=Full code" style="background-image: url(../servlet/confluence/placeholder/macro-headingecc6.png?definition=e2luZm86dGl0bGU9RnVsbCBjb2RlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateContentTypeCommand.php">https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateContentTypeCommand.php</a></p></td></tr></table><p>Creating a <code><a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/Values/ContentType/ContentType">ContentType</a></code> is actually almost more complex than creating Content. It really isn't as common, and didn't &quot;deserve&quot; the same kind of API as Content did.</p><p>Let's split the code in three major parts.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>try
{
    $contentTypeGroup = $contentTypeService->loadContentTypeGroupByIdentifier( 'content' );
}
catch ( \eZ\Publish\API\Repository\Exceptions\NotFoundException $e )
{
    $output->writeln( "content type group with identifier $groupIdentifier not found" );
    return;
}


$contentTypeCreateStruct = $contentTypeService->newContentTypeCreateStruct( 'mycontenttype' );
$contentTypeCreateStruct->mainLanguageCode = 'eng-GB';
$contentTypeCreateStruct->nameSchema = '&lt;title>';
$contentTypeCreateStruct->names = array(
    'eng-GB' => 'My content type'
);
$contentTypeCreateStruct->descriptions = array(
    'eng-GB' => 'Description for my content type',
);</pre></td></tr></table><p>First, we need to load the <code>ContentTypeGroup</code> our <code>ContentType</code> will be created in. We do this using <a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/ContentTypeService#method_loadContentTypeGroupByIdentifier"><code>ContentTypeService::loadContentTypeGroupByIdentifier()</code></a>, which gives us back a <code><a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/Values/ContentType/ContentTypeGroup">ContentTypeGroup</a></code> object. As for content, we then request a <code>ContentTypeCreateStruct</code> from the <code>ContentTypeService</code>, using <code><a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/ContentTypeService#method_newContentTypeCreateStruct">ContentTypeService::newContentTypeCreateStruct()</a></code>, with the desired identifier as the argument. </p><p>Using the create struct's properties, we can set the type's properties:</p><ul><li>the main language (<code>mainLanguageCode</code>) for the type is set to eng-GB,</li><li>the content name generation pattern (<code>nameSchema</code>) is set to '&lt;title&gt;': content of this type will be named as their 'title' field.</li><li>the human readable name for our type is set using the <code>names</code> property. We give it a hash, indexed by the locale ('eng-GB') the name is set in. This locale must exist in the system.</li><li>the same way that we have set the <code>names</code> property, we can set human readable descriptions, again as hashes indexed by locale code.</li></ul><p>The next big part is to add FieldDefinition objects to our ContentType.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>// add a TextLine Field with identifier 'title'
$titleFieldCreateStruct = $contentTypeService->newFieldDefinitionCreateStruct( 'title', 'ezstring' );
$titleFieldCreateStruct->names = array( 'eng-GB' => 'Title' );
$titleFieldCreateStruct->descriptions = array( 'eng-GB' => 'The Title' );
$titleFieldCreateStruct->fieldGroup = 'content';
$titleFieldCreateStruct->position = 10;
$titleFieldCreateStruct->isTranslatable = true;
$titleFieldCreateStruct->isRequired = true;
$titleFieldCreateStruct->isSearchable = true;
$contentTypeCreateStruct->addFieldDefinition( $titleFieldCreateStruct );


// add a TextLine Field body field
$bodyFieldCreateStruct = $contentTypeService->newFieldDefinitionCreateStruct( 'body', 'ezstring' );
$bodyFieldCreateStruct->names = array( 'eng-GB' => 'Body' );
$bodyFieldCreateStruct->descriptions = array( 'eng-GB' => 'Description for Body' );
$bodyFieldCreateStruct->fieldGroup = 'content';
$bodyFieldCreateStruct->position = 20;
$bodyFieldCreateStruct->isTranslatable = true;
$bodyFieldCreateStruct->isRequired = true;
$bodyFieldCreateStruct->isSearchable = true;
$contentTypeCreateStruct->addFieldDefinition( $bodyFieldCreateStruct );</pre></td></tr></table><p>We need to create a <code>FieldDefinitionCreateStruct</code> object for each <code>FieldDefinition</code> our <code>ContentType</code> will be made of. Those objects are obtained using <a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/ContentTypeService#method_newFieldDefinitionCreateStruct"><code>ContentTypeService::newFieldDefinitionCreateStruct()</code></a>. This method expects the FieldDefinition identifier and its type as arguments. The identifiers match the ones from Exponential 4 (<code>ezstring</code> for TextLine, etc).</p><p>Each field's properties are set using the create struct's properties:</p><ul><li><code>names</code> and <code>descriptions</code> are set using hashes indexed by the locale code, and with the name or description as an argument.</li><li>The <code>fieldGroup</code> is set to 'content'</li><li>Fields are ordered using the <code>position</code> property, ordered numerically in ascending order. We set it to an integer.</li><li>The translatable, required ans searchable boolean flags are set using their respective property: <code>isTranslatable</code>, <code>isRequired</code> and <code>isSearchable</code>.</li></ul><p>Once the properties for each create struct are set, the field is added to the ContentType create struct using <a href="http://ezsystems.github.com/ezp-next/sami/eZ/Publish/API/Repository/Values/ContentType/ContentTypeCreateStruct#method_addFieldDefinition"><code>ContentTypeCreateStruct::addFieldDefinition()</code></a>.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>try
{
    $contentTypeDraft = $contentTypeService->createContentType( $contentTypeCreateStruct, array( $contentTypeGroup ) );
    $contentTypeService->publishContentTypeDraft( $contentTypeDraft );
}
catch ( \eZ\Publish\API\Repository\Exceptions\UnauthorizedException $e )
{
    $output->writeln( "&lt;error>" . $e->getMessage() . "&lt;/error>" );
}
catch ( \eZ\Publish\API\Repository\Exceptions\ForbiddenException $e )
{
    $output->writeln( "&lt;error>" . $e->getMessage() . "&lt;/error>" );
}</pre></td></tr></table><p>The last step is the same as for Content: we create a content type draft using <code>ContentTypeService::createContentType()</code>, with the <code>ContentTypeCreateStruct</code> and an array of <code>ContentTypeGroup</code> objects are arguments. We then publish the ContentType draft using <code>ContentTypeService::publishContentTypeDraft()</code>.</p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=12781277 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 13:51:13 GMT -->
</html>
