                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=31430391 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:33:19 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage1622.html?pageId=31430391" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/6/_/styles/colors74cd.css?spaceKey=DEVELOPER" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/6/_/styles/custom74cd.css?spaceKey=DEVELOPER" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <div class="contentLayout2">
<div class="columnLayout two-right-sidebar" data-layout="two-right-sidebar">
<div class="cell normal" data-type="normal">
<div class="innerCell">
<h1>Description</h1><p>Sometimes, when generating links to a resource, you need to modify the default router's behavior.</p><p>Use cases can be:</p><ul><li><a href="../../display/DEVELOPER/Internationalization.html#Internationalization-LanguageSwitcher">Language switch links</a></li><li>Download links</li><li>Pass a Content item instead of a Location (and use its <code>mainLocationId</code>)</li></ul><h1>Solution</h1><p>The concept of <strong>RouteReference</strong> has been introduced, which works in the same way of <a href="http://api.symfony.com/2.3/Symfony/Component/HttpKernel/Controller/ControllerReference.html">Symfony's <code>ControllerReference</code></a> for sub-requests. A <code>RouteReference</code> represents a route (to a location object, a declared route...) with its parameters and can be passed to the <code>Router</code> for link generation.</p><p>The advantage of a <code>RouteReference</code> is that its params can be modified later, and then passed to the router (e.g. to generate a link to the same location in several different languages).</p><p>Furthermore, the <code>RouteReference</code> generation process can be extended to fit specific needs.</p><h2>Usage</h2><h3>Twig</h3><p><strong>Prototype:</strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="6b42b20d-b6bb-4675-9c53-c1751090af3a" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ez_route( [routing_resource[, parameters_hash]] )</pre></td></tr></table><ul><li><code>routing_resource</code> can be any valid resource (route name, Location object...). If omitted (<code>null</code>), the current route will be taken into account.</li><li><code>parameters_hash</code> is a hash with arbitrary key/values. It will be passed to the router in the end.</li></ul><p><strong><br /></strong></p><p><strong>Minimal usage is pretty straightforward:</strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="6099d132-8c58-4ac7-a74c-88b1587b5468" data-macro-parameters="language=xml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingf20b.png?definition=e2NvZGU6bGFuZ3VhZ2U9eG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# With a declared route. #}
{% set routeRef = ez_route( "my_route" ) %}

{# With a location, given "location" variable is a valid Location object. #}
{% set routeRef = ez_route( location ) %}

{# Then pass the routeRef variable to path() to generate the link #}
&lt;a href="{{ path( routeRef ) }}">My link&lt;/a></pre></td></tr></table><p> </p><p><strong>Passing parameters and play with the RouteReference:</strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="491c1b58-69ca-4be1-b590-0c1931512dbe" data-macro-parameters="language=xml" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingf20b.png?definition=e2NvZGU6bGFuZ3VhZ2U9eG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{% set routeRef = ez_route( "my_route", {"some": "thing"} ) %}

{# You can then add parameters further on #}
{% do routeRef.set( "foo", ["bar", "baz"] ) %}

{# Or even modify the route resource #}
{% do routeRef.setRoute( "another_route" ) %}

&lt;a href="{{ path( routeRef ) }}">My link&lt;/a></pre></td></tr></table><h3>PHP</h3><p><span>You can easily generate links based on a </span><code>RouteReference</code><span> from PHP too, with the </span><code>RouteReferenceGenerator</code><span> service:</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="7b65e9c2-4d2f-41c8-9a8f-719bfce3baf7" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>// Assuming we're in a controller
/** @var \eZ\Publish\Core\MVC\Symfony\Routing\Generator\RouteReferenceGeneratorInterface $routeRefGenerator */
$routeRefGenerator = $this->get( 'exponential.route_reference.generator' );
$routeRef = $routeRefGenerator->generate( 'my_route', array( 'some' => 'thing' );
$routeRef->set( 'foo', array( 'bar', 'baz' ) );
$routeRef->setRoute( 'another_route' );

$link = $this->generateUrl( $routeRef );</pre></td></tr></table><h2><span>Extending the RouteReference generation process</span></h2><p>When generating the route reference, the <code>RouteReferenceGenerator</code> service fires an <code>MVCEvents::ROUTE_REFERENCE_GENERATION </code>(<em>exponential.routing.reference_generation</em>) event. This event can be listened to in order to modify the final route reference (adding/changing parameters, changing the route name...).</p><p>All listeners receive a <code>eZ\Publish\Core\MVC\Symfony\Event\RouteReferenceGenerationEvent</code> object, which contains the current request object and the route reference.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="0b8dabb0-3acb-4ae5-8a25-585b32b3fc7e" data-macro-parameters="language=php" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\AcmeTestBundle\EventListener;

use eZ\Publish\Core\MVC\Symfony\Event\RouteReferenceGenerationEvent;
use eZ\Publish\Core\MVC\Symfony\MVCEvents;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class MyRouteReferenceListener implements EventSubscriberInterface
{
    public static function getSubscribedEvents()
    {
        return array(
            MVCEvents::ROUTE_REFERENCE_GENERATION => 'onRouteReferenceGeneration'
        );
    }

    public function onRouteReferenceGeneration( RouteReferenceGenerationEvent $event )
    {
        $routeReference = $event->getRouteReference();
        $request = $event->getRequest();

        // Let's say we want to change the route name if "some_parameter" param is present
        if ( $routeReference->has( 'some_parameter' )
        {
            $routeReference->setRoute( 'a_specific_route' );
            // We remove "some_parameter", as we don't need it any more
            $routeReference->remove( 'some_parameter' );
            // We add another parameter, just because it's fun :-)
            $routeReference->set( 'another_parameter', array( 'parameters', 'are', 'fun' );
        }
    }
}</pre></td></tr></table><p><span><strong><br /></strong></span></p><p><span><strong>Service declaration:</strong></span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="55e8f0cb-09ff-425f-8432-1bf25664a728" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre># AcmeTestBundle/Resources/config/services.yml
parameters:
    acme.my_route_reference_listener.class: Acme\AcmeTestBundle\EventListener\MyRouteReferenceListener

services:
    acme.my_route_reference_listener:
        class: %acme.my_route_reference_listener.class%
        tags:
            - { name: kernel.event_subscriber }</pre></td></tr></table><h1>Example</h1><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="c9146e9f-19e8-4e46-8c2b-abfda254cddc" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>A <em>real life</em> implementation example can be the <a href="../../display/DEVELOPER/Internationalization.html#Internationalization-LanguageSwitcher">LanguageSwitcher</a> (<code><a href="https://github.com/ezsystems/exponential-kernel/blob/master/eZ/Publish/Core/MVC/Symfony/EventListener/LanguageSwitchListener.php">eZ\Publish\Core\MVC\Symfony\EventListener\LanguageSwitchListener</a></code>).</p></td></tr></table><p> </p><p> </p></div>
</div>
<div class="cell aside" data-type="aside">
<div class="innerCell">
<h4>In this topic:</h4><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro7c73.png?definition=e3RvYzptYXhMZXZlbD0zfQ&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-id="12ad7d54-f43b-4d97-81e9-9e0bbaa920a8" data-macro-parameters="maxLevel=3" data-macro-schema-version="1"></p></div>
</div>
</div>
</div>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=31430391 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:33:19 GMT -->
</html>
