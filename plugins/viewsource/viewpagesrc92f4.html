                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=25985666 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:42:09 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage92f4.html?pageId=25985666" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/1b9968ac17721e3a6947d14e3a43c3f8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch9c16.css?build-number=5983" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/89/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/f3685658010e413141854089096800b5/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/df762e50bc83a9608020a1ff1476cda6-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/5a0f37b8e5a58a48983bc1f25fb099f6/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/5714bd5a5c86641cad10106916cda7c8-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/49f5f7dfc888d48bff618d087d8044cc/_/download/contextbatch/css/editor-content/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/51/_/styles/colorsb538.css?spaceKey=EZP" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5983/f3e491afc761ac0a6981cfa3dcbc04fc7e88c149.16/51/_/styles/customb538.css?spaceKey=EZP" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <div class="attribute-heading"><p><span style="color: rgb(51,51,51);font-size: 14.0px;line-height: 1.4285715;"><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc" data-macro-schema-version="1"><br /></span></p><p><span style="color: rgb(51,51,51);font-size: 14.0px;line-height: 1.4285715;">This section describes how to upgrade your existing Exponential 5.3 installation to version 5.4. Make sure that you have a working backup of the site before you do the actual upgrade, and make sure that the installation you are performing the upgrade on is offline.</span></p></div><h2>Note on Paths</h2><ul><li><em>/&lt;ezp5-root&gt;/</em>: The root directory where Exponential 5 is installed in, examples: &quot;<em>/home/myuser/www</em>/&quot; or &quot;<em>/var/sites/exponential/</em>&quot;</li><li><em>/&lt;ezp5-root&gt;/exponential_legacy/</em>:  Root directory of &quot;Legacy&quot; (aka &quot;Legacy Stack&quot;, refers to the Exponential 4.x installation which is bundled with Exponential 5) normally inside &quot;<em>exponential_legacy</em>/&quot;, example: &quot;<em>/home/myuser/www/exponential_legacy/</em>&quot;</li></ul><h2>Check for requirements</h2><p>PHP 5.4.4 and higher is needed. Further information regarding system requirements can be found on <a href="https://confluence.ez.no/display/EZP/Requirements">Requirements Documentation Page</a>.<a name="eztoc126882_2" /></p><h2>Upgrade steps<a name="eztoc126882_1" /></h2><h3>Step 1: Upgrade the legacy distribution files</h3><p>The easiest way to upgrade the distribution files is to unpack Exponential 5.4 to a separate directory and then copy the directories that contain site-specific files from the existing 5.3 installation into &quot;<em>/&lt;ezp5-root&gt;/</em>&quot;. Make sure you copy the following directories:</p><ul><li><code>exponential_legacy/design/&lt;your designs&gt;</code> (do NOT include built-in designs: admin, base, standard or admin2)</li><li><code>exponential_legacy/var/&lt;your_var_dir&gt;/storage</code></li><li><code>exponential_legacy/var/storage/packages</code></li><li><code>exponential_legacy/settings/siteaccess/&lt;your_siteaccesses&gt;</code></li><li><code>exponential_legacy/settings/override/*</code></li><li><code>exponential_legacy/extension/*</code> (not including the built-in / standalone ones: ezflow, ezjscore, ezoe, ezodf, ezie, ezmultiupload, ezmbpaex, ez_network, ezprestapiprovider, ezscriptmonitor, ezsi, ezfind)</li><li>src/</li><li><code><span>exponential_legacy/</span>config.php</code> &amp; <span>exponential_legacy/</span><code>config.cluster.php</code>, if applicable</li><li><code>exponential/config/*.yml</code></li></ul><p><em><strong>NB:</strong> Since writable directories and files have been replaced / copied, their permissions might have changed. You may have to reconfigure webserver user permissions on specific folders as explained in the file <a href="https://confluence.ez.no/pages/viewpage.action?pageId=7438581#InstallingExponentialonaLinux%2FUNIXbasedsystem-Settingupfolderpermission">permissions chapter of the installation process</a>.</em></p><h3>Step 2: upgrade custom legacy extensions</h3><p>If you are using custom extensions, the sub-directories inside the &quot;extension&quot; directory will also have to be copied from the existing 5.3 installation into &quot;<em>/&lt;ezp5-root&gt;/exponential_legacy/extension/</em>&quot;. However, make sure that you do not overwrite any extensions that are included in Exponential distribution, which currently are (<em><strong>Note:</strong> In Exponential Platform 5.4, extensions have version number 5.3 with exception of ezdemo, ezoe, ezformtoken, ezjscore and ezfind</em>):</p><p>Note that upgrading the distribution files will overwrite the autoload arrays for extensions. You will need to re-generate the autoload arrays for active extensions later.</p><p><em><strong>Important: </strong>If you plan to upgrade your eZ Website Interface, eZ Flow or eZ Demo site package as well, then additional extensions will be updated and the step for re-generate the autoload arrays can be skipped until that is done (links to documentation for upgrading these site packages can be found in the last step of this page).</em><a name="eztoc126882_4" /></p><h3>Step 3: upgrade the database</h3><table class="wysiwyg-macro" data-macro-name="info" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><span>This step assumes use of the built in database drivers, mysql (incl mariadb) and PostgreSQL, for other databases supported via extension please use scripts and documentation provided by extension.</span></p></td></tr></table><p>Import to your database the changes provided in</p><p><code>/&lt;ezp5-root&gt;/exponential_legacy/update/database/&lt;mysql|postgresql&gt;/5.4/dbupdate-5.3.0-to-5.4.0.sql</code></p><p>If the installation is using the DFS cluster, import the cluster database changes provided in<br /><code>/&lt;ezp5-root&gt;/exponential_legacy/update/database/mysql/5.4/dbupdate-cluster-5.3.0-to-5.4.0.sql</code></p><h3><span style="color: rgb(0,98,147);">Step 4: Apply 5.4 configuration changes</span></h3><h4>YAML files</h4><p>Since default configuration files have been overwritten during step one, the few additions to those files that were made in 5.3 need to be applied manually to the configuration files.<br />All of those changes are <strong>additions</strong>, none of them replaces what you already have.</p><p>For most of them, at least one, if not all hierarchy elements (monolog, handler, framework, router...) will already be there. All you have to do is <strong>add the missing bits in the existing configuration block</strong>s.</p><h5>exponential/config/config.yml</h5><p><em>trusted_hosts</em> has been changed and <em>session.handler_id</em> is added to the <em>framework</em> block making Symfony pick what has been configured in PHP instead.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>framework:
    trusted_hosts:   ~

    session:
        handler_id:  ~</pre></td></tr></table><p>Additionally configuration for <em>swift_mailer</em> has been added:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>swiftmailer:
    transport: "%mailer_transport%"
    host:      "%mailer_host%"
    username:  "%mailer_user%"
    password:  "%mailer_password%"
    spool:     { type: memory }</pre></td></tr></table><h5>exponential/config/config_dev.yml</h5><p>In framework, set <em>router.strict_requirements</em> to true.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>framework:
    router:
        resource: "%kernel.root_dir%/config/routing_dev.yml"
        strict_requirements: true</pre></td></tr></table><h5>exponential/config/config_prod.yml</h5><p>Remove <em>framework.router.strict_requirements</em> completely.</p><h5>exponential/config/routing.yml</h5><p>Add the liip imagine routes to the file:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>_liip_imagine:
  resource: "@LiipImagineBundle/Resources/config/routing.xml"</pre></td></tr></table><h5>exponential/config/parameters.yml.dist</h5><p class="wordwrap"><span style="font-family: Arial , sans-serif;font-size: 14.0px;line-height: 1.4285715;">If you have added anything to <code>parameters.yml</code>, we suggest that you add your custom settings to <code>parameters.yml.dist</code>, so that the composer post-update script handles those, and generates their values correctly.</span></p><p><em>exponential_legacy.default.view_default_layout</em> can be removed from this file, and the following added:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>parameters:
    mailer_transport:  smtp
    mailer_host:       127.0.0.1
    mailer_user:       ~
    mailer_password:   ~</pre></td></tr></table><p class="wordwrap">composer will ask for your own values when you run <em>composer update</em>.</p><h5>exponential/config/exponential*.yml</h5><p>In all exponential.yml files (prod, dev, etc), replace the &quot;<strong>handlers</strong>&quot; key in <em>stash.caches.*</em> with &quot;<strong>drivers</strong>&quot;.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>stash:
     caches:
         default:
            drivers:</pre></td></tr></table><h4>exponential/EzPublishKernel.php</h4><p>It is not possible to just copy your old <code>EzPublishKernel.php</code> file over from the previous installation, since quite a few changes were made to this file in this release. We suggest that you simply update the new kernel file with any changes you made in the previous version.</p><p>New bundles in this version are <span style="color: rgb(52,52,52);"><em>EzPublishIOBundle</em>, </span><span style="color: rgb(52,52,52);"><em>FOSHttpCacheBundle</em>, </span><span style="color: rgb(52,52,52);"><em>LiipImagineBundle</em>, </span><span style="color: rgb(52,52,52);"><em>WhiteOctoberBreadcrumbsBundle</em>, </span><span style="color: rgb(52,52,52);"><em>KnpMenuBundle</em>, </span><span style="color: rgb(52,52,52);"><em>OneupFlysystemBundle</em> and </span><span style="color: rgb(52,52,52);"><em>SensioFrameworkExtraBundle</em>.</span></p><h4>composer.json</h4><p>If you had modified <code>composer.json</code> to add your own requirements, you must re-apply those changes to the new version.</p><p><em>Note: Besides requirements changes there are also changes to other parts of composer.json, including improvements also found in <a class="confluence-link" href="../../display/EZP/5.3-5.html" data-linked-resource-id="23528625" data-linked-resource-version="19" data-linked-resource-type="page" data-linked-resource-default-alias="5.3.3 Release Notes" data-base-url="../../index.html">5.3.3</a></em><em> and <a class="confluence-link" href="../../display/EZP/5.3-6.html" data-linked-resource-id="25985326" data-linked-resource-version="8" data-linked-resource-type="page" data-linked-resource-default-alias="5.3.4 Release Notes" data-base-url="../../index.html">5.3.4</a></em><em>.</em></p><h4>Varnish (if applicable)</h4><p>The recommended varnish (3 and 4) VCL configuration can now be found in the <code>doc/varnish</code> folder. See also the <a class="confluence-link" href="../../display/EZP/Using%2bVarnish.html" data-linked-resource-id="12124722" data-linked-resource-version="31" data-linked-resource-type="page" data-linked-resource-default-alias="Using Varnish" data-base-url="../../index.html">Using Varnish</a> page.</p><h4>Update the DFS cluster configuration</h4><p>If your legacy installation uses DFS clustering, you need to <a class="confluence-link" href="../../display/EZP/Upgrading%2bDFS%2bcluster%2bto%2b5.html" data-linked-resource-id="25985794" data-linked-resource-version="3" data-linked-resource-type="page" data-linked-resource-default-alias="Upgrading DFS cluster to 5.4" data-base-url="../../index.html">create the new stack configuration for it</a>.</p><h4>Web server configuration</h4><p>The officially recommended virtual configuration is now shipped in the <code>doc</code> folder, for both apache2 (<code>doc/apache2</code>) and nginx (<code>doc/nginx</code>). Both are built to be easy to understand and use, but aren't meant as drop-in replacements for your existing configuration.</p><p>One notable change is that <code>SetEnvIf</code> is now used to dynamically change rewrite rules depending on the Symfony environment. It is currently used for the assetic production rewrite rules.</p><p>Read more on the <a class="confluence-link" href="../../display/EZP/Web%2bservers.html" data-linked-resource-id="22937700" data-linked-resource-version="4" data-linked-resource-type="page" data-linked-resource-default-alias="Web servers" data-base-url="../../index.html">Web servers</a> page.</p><h4><span style="font-size: 14.0px;line-height: 1.5;">Final step: web server rewrite rules</span></h4><p>This is reflected in the apache2 and nginx configuration files that are shipped in the doc folder. The main change from legacy is that requests for images can now be rewritten to <code>web/index.php</code> instead of <code>exponential_legacy/index_cluster.php</code>.</p><h3>Step 5: Run composer update</h3><p>Run <code>composer update --no-dev --prefer-dist</code> to get the latest Exponential dependencies.</p><p>At the end of the process, you will be asked for values for the parameters previously added to <code>parameters.yml.dist</code>.</p><h3>Step 6: Regenerate the autoload array for extensions</h3><p>To regenerate the autoload array, execute the following script from the root of your Exponential Legacy directory:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>cd exponential_legacy
php bin/php/ezpgenerateautoloads.php --extension</pre></td></tr></table><h3>Step 7: Link assets</h3><p>Assets from the various bundles need to be made available for the webserver through the web/ document root.</p><p>The following commands will first symlink Exponential 5 assets in &quot;Bundles&quot; and the second will symlink assets (design files like images, scripts and css, and files in var folder)  from Exponential Legacy:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-schema-version="1" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>php exponential/console assets:install --symlink
php exponential/console exponential:legacy:assets_install --symlink
php exponential/console assetic:dump --env=prod</pre></td></tr></table><h3>Step 8: Clear the caches</h3><p>Whenever an Exponential solution is upgraded, all caches must be cleared in a proper way. This should be done from within a system shell:<br />Navigate into the new Exponential directory.Run the script using the following shell command: <code>cd /&lt;ezp5-root&gt;/exponential_legacy/; php bin/php/ezcache.php --clear-all --purge</code>. Purging ensures that the caches are physically removed. When the &quot;--purge&quot; parameter is not specified, the caches will be expired but not removed.<br />Note: Sometimes the script is unable to clear all cache files because of restrictive file/directory permission settings. Make sure that all cache files have been cleared by inspecting the contents of the various cache sub-directories within the &quot;var&quot; directory (typically the &quot;var/cache/&quot; and &quot;var/&lt;name_of_siteaccess&gt;/cache/&quot; directories). If there are any cache files left, you need to remove them manually.</p><h3>Minor Versions Update Warning</h3><p>Please have in mind that, after the upgrade to a major version of Exponential, you will need to perform regular updates with composer.</p><p>Before any minor update with composer, please execute all require steps described in the <span class="confluence-link"><a class="confluence-link" href="../../display/EZP/5.4-10.html" data-linked-resource-id="27395899" data-linked-resource-version="27" data-linked-resource-type="page" data-linked-resource-default-alias="5.4.x Update Instructions" data-base-url="../../index.html">5.4.x Update Instructions</a></span>.</p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=25985666 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 09:42:09 GMT -->
</html>
