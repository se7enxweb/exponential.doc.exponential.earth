                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=21987873 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 10:39:23 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage3642.html?pageId=21987873" />
        <link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1f2a9c4c7f2593422cc9b02d1a652a22/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/26ac2724af3c6ece1051365650d982fa/_/download/contextbatch/css/editor-content/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/12/_/styles/colors.css" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=Version compatibility" style="background-image: url(../servlet/confluence/placeholder/macro-heading77d5.png?definition=e25vdGU6dGl0bGU9VmVyc2lvbiBjb21wYXRpYmlsaXR5fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Route references are compatible with <strong>Exponential 5.3 / 2014.05</strong></p></td></tr></table><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc"></p><h2>Description</h2><p>Sometimes, when generating links to a resource, you need to modify the default router's behavior.</p><p>Use cases can be:</p><ul><li><a class="confluence-link" href="../../display/EZP/Language%2bSwitcher.html" data-linked-resource-id="21299899" data-linked-resource-type="page" data-linked-resource-default-alias="Language Switcher" data-base-url="../../index.html">Language switch links</a></li><li>Download links</li><li>Pass a Content object instead of a Location (and use its <code>mainLocationId</code>)</li></ul><h2>Solution</h2><p>The concept of <strong>RouteReference</strong> has been introduced, which works in the same way of <a href="http://api.symfony.com/2.3/Symfony/Component/HttpKernel/Controller/ControllerReference.html">Symfony's <code>ControllerReference</code></a> for sub-requests. A <code>RouteReference</code> represents a route (to a location object, a declared route...) with its parameters and can be passed to the <code>Router</code> for link generation.</p><p>The advantage of a <code>RouteReference</code> is that its params can be modified later, and then passed to the router (e.g. to generate a link to the same location in several different languages).</p><p>Furthermore, the <code>RouteReference</code> generation process can be extended to fit specific needs.</p><h2>Usage</h2><h3>Twig</h3><p><strong>Prototype:</strong></p><table class="wysiwyg-macro" data-macro-name="code" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ez_route( [routing_resource[, parameters_hash]] )</pre></td></tr></table><ul><li><code>routing_resource</code> can be any valid resource (route name, Location object...). If omitted (<code>null</code>), the current route will be taken into account.</li><li><code>parameters_hash</code> is a hash with arbitrary key/values. It will be passed to the router in the end.</li></ul><p><strong><br /></strong></p><p><strong>Minimal usage is pretty straightforward:</strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=xml" style="background-image: url(../servlet/confluence/placeholder/macro-headingf20b.png?definition=e2NvZGU6bGFuZ3VhZ2U9eG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# With a declared route. #}
{% set routeRef = ez_route( "my_route" ) %}

{# With a location, given "location" variable is a valid Location object. #}
{% set routeRef = ez_route( location ) %}

{# Then pass the routeRef variable to path() to generate the link #}
&lt;a href="{{ path( routeRef ) }}">My link&lt;/a></pre></td></tr></table><p> </p><p><strong>Passing parameters and play with the RouteReference:</strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=xml" style="background-image: url(../servlet/confluence/placeholder/macro-headingf20b.png?definition=e2NvZGU6bGFuZ3VhZ2U9eG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{% set routeRef = ez_route( "my_route", {"some": "thing"} ) %}

{# You can then add parameters further on #}
{% do routeRef.set( "foo", ["bar", "baz"] ) %}

{# Or even modify the route resource #}
{% do routeRef.setRoute( "another_route" ) %}

&lt;a href="{{ path( routeRef ) }}">My link&lt;/a></pre></td></tr></table><h3>PHP</h3><p><span>You can easily generate links based on a </span><code>RouteReference</code><span> from PHP too, with the </span><code>RouteReferenceGenerator</code><span> service:</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>// Assuming we're in a controller
/** @var \eZ\Publish\Core\MVC\Symfony\Routing\Generator\RouteReferenceGeneratorInterface $routeRefGenerator */
$routeRefGenerator = $this->get( 'exponential.route_reference.generator' );
$routeRef = $routeRefGenerator->generate( 'my_route', array( 'some' => 'thing' );
$routeRef->set( 'foo', array( 'bar', 'baz' ) );
$routeRef->setRoute( 'another_route' );

$link = $this->generateUrl( $routeRef );</pre></td></tr></table><h2><span>Extending the RouteReference generation process</span></h2><p>When generating the route reference, the <code>RouteReferenceGenerator</code> service fires an <code>MVCEvents::ROUTE_REFERENCE_GENERATION </code>(<em>exponential.routing.reference_generation</em>) event. This event can be listened to in order to modify the final route reference (adding/changing parameters, changing the route name...).</p><p>All listeners receive a <code>eZ\Publish\Core\MVC\Symfony\Event\RouteReferenceGenerationEvent</code> object, which contains the current request object and the route reference.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\AcmeTestBundle\EventListener;

use eZ\Publish\Core\MVC\Symfony\Event\RouteReferenceGenerationEvent;
use eZ\Publish\Core\MVC\Symfony\MVCEvents;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class MyRouteReferenceListener implements EventSubscriberInterface
{
    public static function getSubscribedEvents()
    {
        return array(
            MVCEvents::ROUTE_REFERENCE_GENERATION => 'onRouteReferenceGeneration'
        );
    }

    public function onRouteReferenceGeneration( RouteReferenceGenerationEvent $event )
    {
        $routeReference = $event->getRouteReference();
        $request = $event->getRequest();

        // Let's say we want to change the route name if "some_parameter" param is present
        if ( $routeReference->has( 'some_parameter' )
        {
            $routeReference->setRoute( 'a_specific_route' );
            // We remove "some_parameter", as we don't need it any more
            $routeReference->remove( 'some_parameter' );
            // We add another parameter, just because it's fun :-)
            $routeReference->set( 'another_parameter', array( 'parameters', 'are', 'fun' );
        }
    }
}</pre></td></tr></table><p><span><strong><br /></strong></span></p><p><span><strong>Service declaration:</strong></span></p><table class="wysiwyg-macro" data-macro-name="code" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre># AcmeTestBundle/Resources/config/services.yml
parameters:
    acme.my_route_reference_listener.class: Acme\AcmeTestBundle\EventListener\MyRouteReferenceListener

services:
    acme.my_route_reference_listener:
        class: %acme.my_route_reference_listener.class%
        tags:
            - { name: kernel.event_subscriber }</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>A <em>real life</em> implementation example can be the <a class="confluence-link" href="../../display/EZP/Language%2bSwitcher.html" data-linked-resource-id="21299899" data-linked-resource-type="page" data-linked-resource-default-alias="Language Switcher" data-base-url="../../index.html">LanguageSwitcher</a> (<code><a href="https://github.com/ezsystems/exponential-kernel/blob/master/eZ/Publish/Core/MVC/Symfony/EventListener/LanguageSwitchListener.php">eZ\Publish\Core\MVC\Symfony\EventListener\LanguageSwitchListener</a></code>).</p></td></tr></table><p> </p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=21987873 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 10:39:23 GMT -->
</html>
