
<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from doc.ez.no/doc_hidden/Exponential/Technical-manual/3.10/Features/Clustering by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 11:44:31 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/core.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/header-footer.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/header-footer-lookfeel.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/pagelayout.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/buttons.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/960.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/superfish.css" /><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/jquery-1.6.3.min.js" charset="utf-8"></script><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/superfish.js" charset="utf-8"></script><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/jquery.popmenu.min.js" charset="utf-8"></script>
<style type="text/css">
    @import url(../../../../../extension/ezdoc/design/doc/stylesheets/core.css);
    @import url(../../../../../extension/ezdoc/design/doc/stylesheets/classes.css);
    @import url(../../../../../extension/ezdoc/design/doc/stylesheets/doc.css);
    @import url(../../../../../extension/ezdoc/design/doc/stylesheets/print.css) print;</style>

<link type="text/css" rel="stylesheet" href="../../../../../extension/ezdoc/design/doc/stylesheets/print.css" media="print" />

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie5.css);    </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte.css); </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte-doc.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6.css);    </style>     <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezdoc/design/doc/stylesheets/gecko.css);</style>"); --></script>

<script type="text/javascript" src="../../../../../extension/ezdoc/design/doc/javascripts/mainmenu-hover.js"></script>
<script type="text/javascript" src="../../../../../extension/ezdoc/design/doc/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../../../extension/ezdoc/design/doc/javascripts/ezno-searchbox.js"></script>
                                              
    <title>Clustering / Features / 3.10 / Technical manual / Exponential / Documentation - Doc</title>

    
    
    
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

            <meta http-equiv="Content-language" content="en-GB" />

    
                <meta name="author" content="eZ systems" />
                    <meta name="copyright" content="eZ systems" />
                    <meta name="description" content="Exponential Documentation" />
                    <meta name="keywords" content="Exponential, documentation, manual, reference, eZ systems" />
        
    <meta name="generator" content="Exponential" />
    <link rel="Home" href="../../../../../doc_hidden.html" title="Doc front page" />
<link rel="Search" href="../../../../content/advancedsearch.html" title="Search Doc" />
<link rel="Shortcut icon" href="../../../../../extension/ezdoc/design/doc/images/favicon.ico" type="image/x-icon" />

</head>
<body onload="initDocSearch();menuInit();">

<!-- Complete page area: START -->
<div id="page">


    <div class="topmenu-anchor"></div>
    <div id="topmenu-bg">
	    <div id="logo" class="container_12">

    <div class="grid_3">
        <a href="https://exponential.doc.exponential.earth/Exponential/" title="Exponential Platform, CXM &amp; CMS">
            <img src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/images/ez-logo.png"
                 alt="" height="45px"/>
        </a>
    </div>

    <div class="grid_9">
                <div class="topmenu-design">
	<!-- Top menu content: START -->
	<div id="topmenu-firstlevel-position">
	<ul id="topmenu-firstlevel" class="sf-menu sf-js-enabled sf-shadow">
		
		
		        </ul>
    </div>
        <!-- Top menu content: END -->
</div>        </div>
</div>    </div>


<div id="page-content-position"><div id="page-content-position-inner"><div id="page-content">

<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p> <a href="https://exponential.doc.exponential.earth/">7x</a> /
                        <a href="../../../../../doc_hidden.html">documentation</a>
        
                        /
                            <a href="../../../../Exponential.html">exponential</a>
        
                        /
                            <a href="../../../Technical-manual.html">technical manual</a>
        
                        /
                            <a href="../../3.html">3.10</a>
        
                        /
                            <a href="../Features.html">features</a>
        
                        /
                            clustering
        
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide" />

<!-- Main area: START -->
                                    <div id="ezp5disclaimer">
                <p><strong style="color: red">Caution:</strong> This documentation is for <strong>Exponential</strong>, from version 3.x to 6.x.<br/>
                For 5.x documentation covering <em>Platform</em> see <a href="../../../../../display/MAIN/eZ%2bDocumentation%2bCenter.html">eZ Documentation Center</a>, for difference between <em>legacy</em> and <em>Platform</em> see <a href="../../../../../pages/viewpage0139.html?pageId=11403666">5.x Architecture overview</a>.</p>
            </div>
            
<div id="page-width5">
<div id="main" class="float-break">


<div class="template-design area-docmenu-normal">
<div class="template-module">
<div class="template-object">
<div id="contentmenu">
                        <div class="attribute-heading"><h2 class="bullet"><a href="../../3.html">Table of contents</a></h2></div>
<div class="boxcontent">

<map id="contentstructure">

    
    
</map>

</div>            
</div>
</div>
</div>
</div>
<div class="area-docmain-normal">
<div class="template-design">
<div class="template-module content-view-full">
<div class="template-object">

<div class="attribute-heading">
<h1>Clustering</h1>
</div>

 <p>The clustering feature makes it possible to run an Exponential site on several web servers. A site that is running on a cluster of servers will have better performance and will be able to handle more traffic. </p> <p>It is possible to store all content related caches, images and binary files in the database. A technique called <a href="http://en.wikipedia.org/wiki/Database_transaction" target="_self">database transaction</a> is used to ensure that all the cluster nodes use the same cache files and have access to the same image and binary files. In other words, when content is updated, changes automatically become available for all the web servers in the cluster. This functionality was significantly improved in 3.10.</p> <p>Note that when clustering is used, it is recommended to run the site in a Virtual Host environment on the different servers.</p>  <a name="eztoc74670_1" id="eztoc74670_1"></a><h2>Changes introduced in 3.10</h2> <p>In Exponential versions prior to 3.10, clearing the caches lead to physical removal of the cache files. This operation can be quite time consuming.</p> <p>From 3.10, the system will mark the cache files invalid instead of removing them physically from the database or filesystem. This can be done by either marking each particular cache file expired or setting the global expiry (the latter typically happens when a significant amount of changes is needed, e.g. when clearing all the caches of a specific type). The global expiry is a timestamp that is used as an expiry value for all the caches in the system. If the global expiry is set to a certain date, all cache files that are older than this date will not be used. Note that the system will re-use old/expired cache file entries when re-creating the caches.</p> <p>
In order to physically remove the cache files from the database, the &quot;bin/php/ezcache.php&quot; script needs to be run with the &quot;--purge&quot; option. The following example shows how to remove the content caches that are more than two days old:<br /></p><pre class="wordwrap"><span class="line">php bin/php/ezcache.php --clear-id=content --purge --expiry='-2 days'</span>
</pre><p>
 <br />
For more information about the available parameters, run the script with the &quot;--help&quot; option:<br /></p><pre class="wordwrap"><span class="line">php bin/php/ezcache.php --help</span>
</pre><p>&nbsp;</p> <p>Note that 3.10 does not support clustering for PostgreSQL databases. The code is optimized for best performance and focused on MySQL databases using the InnoDB engine. The number of database connections in MySQL must be increased by 30-50%. The reason for this is because the new cluster code performs an extra connection when writing content to the database (this connection checks if the file has been modified since the write lock was acquired to remove the need to write). If persistent connections are enabled, the cluster code will no longer share connections with normal database calls so the number of connections previously used will have to be doubled.</p>   <a name="eztoc74670_2" id="eztoc74670_2"></a><h2>Changes introduced in 3.9</h2> <p>From 3.9, an additional HTTP header called &quot;Served-by&quot; is supported. This feature has been added for the purpose of testing and debugging. It is typically useful when you need to check from the client side which server that has handled the request. The following example shows a part of a server response that contains this header: </p> <pre class="wordwrap copytoclipboard"><span class="line">...</span>
<span class="line">Last-Modified: Fri, 29 Jun 2007 09:35:54 GMT</span>
<span class="line">Served-by: 62.70.12.230</span>
<span class="line">Content-Language: en-GB</span>
<span class="line">...</span>
</pre><!--[if IE]>
<p class="copytoclipboard"><img src="/extension/ezdoc/design/doc/images/copytoclipboard.gif" height="16" width="16" alt="Copy to clipboard" title="Copy to clipboard" onclick="window.clipboardData.setData( 'text', '...\r\nLast-Modified: Fri, 29 Jun 2007 09:35:54 GMT\r\nServed-by: 62.70.12.230\r\nContent-Language: en-GB\r\n...' ); return false;" /></p>
<![endif]-->   <a name="eztoc74670_3" id="eztoc74670_3"></a><h2>How it works</h2> <p>Data that must be synchronized between the different servers is stored using the database:</p> 
<ul>
 <li><div> Binary files </div></li> <li><div> Image and image alias files </div></li> <li><div> Caches related to content:
<ul>
 <li><div> Content view cache </div></li> <li><div> Template block cache </div></li> <li><div> Expiry cache </div></li> <li><div> URL alias cache </div></li> <li><div> RSS cache </div></li> <li><div> User info cache </div></li> <li><div> Class identifier cache </div></li> <li><div> Sort key cache </div></li> 
</ul>
  </div></li> 
</ul>
 <p>Other files are stored using the filesystem, including (but not limited to):</p> 
<ul>
 <li><div> INI files </div></li> <li><div> Template files </div></li> <li><div> Compiled templates </div></li> <li><div> PHP files </div></li> <li><div> Log files </div></li> <li><div> Caches that are not related to content:
<ul>
 <li><div> Global INI cache </div></li> <li><div> INI cache </div></li> <li><div> Codepage cache </div></li> <li><div> Character transformation cache </div></li> <li><div> Template cache </div></li> <li><div> Template override cache </div></li> 
</ul>
  </div></li> 
</ul>
  <a name="eztoc74670_3_1" id="eztoc74670_3_1"></a><h3>Content view cache</h3> <p>When eZ publish is displaying a page (a content node), it will execute the &quot;view&quot; view of the &quot;content&quot; module and include the output in the pagelayout. If the output is <a href="View-caching.html" target="_self">cached</a>, the cache file(s) will be read and served. If not, the system will fetch the content stored in the <a href="../Concepts-and-basics/Content-management/The-content-object.html" target="_self">eZ publish object database</a>, render the necessary templates, generate a web page and store the resulting XHTML on the filesystem before serving it. As previously mentioned, these files can now (from 3.8) be stored in the database and thus the files (along with changes) are easily and immediately available to all servers in the cluster.</p>   <a name="eztoc74670_3_2" id="eztoc74670_3_2"></a><h3>Images and image aliases</h3> <p>The approach described above is also used when it comes to images and image aliases (<a href="../Reference/Datatypes/Image.html#variation" target="_self">image variations</a>). However, the solution is a bit more complicated because until now (3.8), images have been served directly by Apache. Since the web server isn't able to communicate with the database, the images need to be served using a PHP script called &quot;index_image.php&quot;. This is true for all content images, but not for images that are related to design. Please note that you'll need to add new rewrite rules in order to instruct Apache to use &quot;index_image.php&quot; when serving images.</p>    <a name="eztoc74670_4" id="eztoc74670_4"></a><h2>Cluster file handlers</h2> <p>A new cluster file handler mechanism was added in 3.8. It makes it possible to store, retrieve, rename, delete, etc. files using the database. The cluster file handlers are located in the &quot;kernel/classes/clusterfilehandlers&quot; directory of the eZ publish installation. The following cluster file handlers are known to the system by default:</p> 
<ul>
 <li><div> ezfs (eZFSFileHandler) </div></li> <li><div> ezdb (eZDBFileHandler) </div></li> 
</ul>
  <a name="eztoc74670_4_3" id="eztoc74670_4_3"></a><h3>eZFSFileHandler</h3> <p>This handler makes it possible to use the filesystem when dealing with files.</p> <p> <a name="ezdb"></a>
 </p>   <a name="eztoc74670_4_4" id="eztoc74670_4_4"></a><h3>eZDBFileHandler</h3> <p>This handler makes it possible to use the database when dealing with files (in a cluster environment, this would typically be images, uploaded binary files and content-related caches, etc.). It is split into different back-ends that are compatible with the supported database engines (note: currently only MySQL is supported).</p>   <a name="eztoc74670_4_5" id="eztoc74670_4_5"></a><h3>Custom handlers</h3> <p>It is possible to extend the system by implementing your own handlers and/or back-ends. This should be done using the extension system (and not by modifying the original eZ publish kernel files).</p> <p>The &quot;ExtensionDirectories[]&quot; array located under the &quot;[ClusteringSettings]&quot; block of the &quot;file.ini&quot; configuration file specifies the extension directories where eZ publish should search for additional cluster file handlers. By default, eZ publish will search in the &quot;clusterfilehandlers&quot; subdirectory inside your extension.</p>  <a name="eztoc74670_4_5_1" id="eztoc74670_4_5_1"></a><h4>Example</h4> <p>
If you have an extension &quot;myExtension&quot; that includes a cluster file handler &quot;cfh&quot;, you should add the following lines under the &quot;[ClusteringSettings]&quot; block in your &quot;file.ini.append.php&quot; file:<br /></p><pre class="wordwrap"><span class="line">FileHandler=cfh</span>
<span class="line">ExtensionDirectories[]=myExtension</span>
</pre><p>&nbsp;</p> <p>These settings will instruct eZ publish to use your custom cluster file handler located in &quot;extension/myExtension/clusterfilehandlers/cfhfilehandler.php&quot;.</p>   

<div class="break"></div><div class="pageinfo float-break">
<div class="created">


<p><label>Written by:</label>Svitlana Shatokhina&nbsp;(10/08/2006 9:27 am)</p>
</div>
<div class="modified">
<p><label>Last updated by:</label>Gaetano Giunta&nbsp;(19/05/2009 2:53 pm)</p>
</div><div class="authors">
<p><label>Maintainers:</label>Svitlana Shatokhina, Balazs Halasy, Gaetano Giunta</p>
</div></div>
<hr class="hide" />

</div>
</div>
</div>

<div id="comments" class="class-comment">
<div class="content-view-children">

<h1>Comments</h1>
<p>There are no comments.</p>
<div class="toolbar">

<form method="post" action="https://doc.ez.no/doc_hidden/content/action">
<input class="button" type="submit" name="NewButton" value="New comment" />
<input type="hidden" name="NodeID" value="15202" />
<input type="hidden" name="RedirectURIAfterPublish" value="Exponential/Technical-manual/3.10/Features/Clustering" />
<input type="hidden" name="ClassID" value="17" />
</form>
</div>

</div>
</div>

</div>
<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide" />

</div></div></div>

        <div id="footer-bg">
        <div id="footer" class="container_12">

            <div class="grid_3">
                <img src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/images/ez-logo.png" alt="exponential" />
                <div id="footer-copyright" class="grid_3 alpha omega">
                                    </div>
            </div>

            <div class="grid_6 middle">
                <div class="grid_6 alpha omega">
                    <div class="grid_3 alpha"><div></div></div>
                    <div class="grid_3 omega"><div></div></div>
                </div>
            </div>

            <div class="grid_3 right">
                <div class="contact-ez">
                        <a id="cta-contact" href="https://se7enx.com" title="Contact 7x!" class="btn-green btn--small">Contact 7x!</a>
                </div>

                <div class="adress"></div>
            </div>

        </div>
    </div>
<div id="footer-connect-bg">
    <div id="footer" class="container_12">
        <div id="footer-connect-copyright" class="grid_8 alpha omega">
            Copyright © 1998 - 2024 7x (except where otherwise noted). All rights reserved.
            <br/><br/>
            Powered by <a href="https://se7enx.com/exponential" title="Exponential Platform">the Exponential Platform</a>.<br />
        </div>

        <div id="footer-connect-social" class="grid_4 right">
            <a href="https://www.youtube.com/@ExponentialInsights" class="youtube" target="_blank">youtube</a>
            
            <a href="http://www.linkedin.com/groups?gid=2759&amp;trk=myg_ugrp_ovr" class="linkedin" target="_blank">linkedin</a>
            <a href="https://www.instagram.com/se7enxweb" class="instagram" target="_blank">instagram</a>
            <a href="https://twitter.com/se7enxweb" class="X" target="_blank">X</a>
        </div>


    </div>
</div>


</div>
<!-- Complete page area: END -->




<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1VMV65H63V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1VMV65H63V');
</script>






</body>

<!-- Mirrored from doc.ez.no/doc_hidden/Exponential/Technical-manual/3.10/Features/Clustering by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 11:44:36 GMT -->
</html>

<!-- th[eZ] 20050804 -->
