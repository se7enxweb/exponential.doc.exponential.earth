
<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from doc.ez.no/doc_hidden/Exponential/Technical-manual/4.6/Features/Clustering/Reverting-a-cluster-setup by HTTrack Website Copier/3.x [XR&CO'2013], Wed, 01 Feb 2017 00:29:38 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/core.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/header-footer.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/header-footer-lookfeel.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/pagelayout.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/buttons.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/960.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/superfish.css" /><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/jquery-1.6.3.min.js" charset="utf-8"></script><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/superfish.js" charset="utf-8"></script><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/jquery.popmenu.min.js" charset="utf-8"></script>
<style type="text/css">
    @import url(../../../../../../extension/ezdoc/design/doc/stylesheets/core.css);
    @import url(../../../../../../extension/ezdoc/design/doc/stylesheets/classes.css);
    @import url(../../../../../../extension/ezdoc/design/doc/stylesheets/doc.css);
    @import url(../../../../../../extension/ezdoc/design/doc/stylesheets/print.css) print;</style>

<link type="text/css" rel="stylesheet" href="../../../../../../extension/ezdoc/design/doc/stylesheets/print.css" media="print" />

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie5.css);    </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte.css); </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte-doc.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6.css);    </style>     <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezdoc/design/doc/stylesheets/gecko.css);</style>"); --></script>

<script type="text/javascript" src="../../../../../../extension/ezdoc/design/doc/javascripts/mainmenu-hover.js"></script>
<script type="text/javascript" src="../../../../../../extension/ezdoc/design/doc/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../../../../extension/ezdoc/design/doc/javascripts/ezno-searchbox.js"></script>
                                                    
    <title>Reverting a cluster setup / Clustering / Features / 4.6 / Technical manual / Exponential / Documentation - Doc</title>

    
    
    
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

            <meta http-equiv="Content-language" content="en-GB" />

    
                <meta name="author" content="eZ systems" />
                    <meta name="copyright" content="eZ systems" />
                    <meta name="description" content="Exponential Documentation" />
                    <meta name="keywords" content="Exponential, documentation, manual, reference, eZ systems" />
        
    <meta name="generator" content="Exponential" />
    <link rel="Home" href="../../../../../../doc_hidden.html" title="Doc front page" />
<link rel="Search" href="../../../../../content/advancedsearch.html" title="Search Doc" />
<link rel="Shortcut icon" href="../../../../../../extension/ezdoc/design/doc/images/favicon.ico" type="image/x-icon" />

</head>
<body onload="initDocSearch();menuInit();">

<!-- Complete page area: START -->
<div id="page">


    <div class="topmenu-anchor"></div>
    <div id="topmenu-bg">
	    <div id="logo" class="container_12">

    <div class="grid_3">
        <a href="https://exponential.doc.exponential.earth/Exponential/" title="Exponential Platform, CXM &amp; CMS">
            <img src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/images/exponential.png"
                 alt="" height="45px"/>
        </a>
    </div>

    <div class="grid_9">
                <div class="topmenu-design">
	<!-- Top menu content: START -->
	<div id="topmenu-firstlevel-position">
	<ul id="topmenu-firstlevel" class="sf-menu sf-js-enabled sf-shadow">
		
		
		        </ul>
    </div>
        <!-- Top menu content: END -->
</div>        </div>
</div>    </div>


<div id="page-content-position"><div id="page-content-position-inner"><div id="page-content">

<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p> <a href="https://exponential.doc.exponential.earth/">7x</a> /
                        <a href="../../../../../../doc_hidden.html">documentation</a>
        
                        /
                            <a href="../../../../../Exponential.html">exponential</a>
        
                        /
                            <a href="../../../../Technical-manual.html">technical manual</a>
        
                        /
                            <a href="../../../4-2.html">4.6</a>
        
                        /
                            <a href="../../Features.html">features</a>
        
                        /
                            <a href="../Clustering.html">clustering</a>
        
                        /
                            reverting a cluster setup
        
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide" />

<!-- Main area: START -->
                                    <div id="ezp5disclaimer">
                <p><strong style="color: red">Caution:</strong> This documentation is for <strong>Exponential</strong>, from version 3.x to 6.x.<br/>
                For 5.x documentation covering <em>Platform</em> see <a href="../../../../../../display/MAIN/eZ%2bDocumentation%2bCenter.html">eZ Documentation Center</a>, for difference between <em>legacy</em> and <em>Platform</em> see <a href="../../../../../../pages/viewpage0139.html?pageId=11403666">5.x Architecture overview</a>.</p>
            </div>
            
<div id="page-width5">
<div id="main" class="float-break">


<div class="template-design area-docmenu-normal">
<div class="template-module">
<div class="template-object">
<div id="contentmenu">
                        <div class="attribute-heading"><h2 class="bullet"><a href="../../../4-2.html">Table of contents</a></h2></div>
<div class="boxcontent">

<map id="contentstructure">

    
    
</map>

</div>            
</div>
</div>
</div>
</div>
<div class="area-docmain-normal">
<div class="template-design">
<div class="template-module content-view-full">
<div class="template-object">

<div class="attribute-heading">
<h1>Reverting a cluster setup</h1>
</div>

<p>You can always switch from using the <a href="../Clustering.html" target="_self">clustering</a> functionality to the standard configuration where images, binary files and content-related caches are stored on a file system. The following instructions explain how this can be done, assuming that your Exponential site is currently configured to store images and other files in a MySQL database.</p><a name="eztoc126144_1" id="eztoc126144_1"></a><h2>Reverting to non cluster setup</h2><a name="eztoc126144_1_1" id="eztoc126144_1_1"></a><h3>1. Clear the caches (optional)</h3><p>It is recommended (but not required) to clear all Exponential caches before disabling the clustering functionality. This can be done by running the &quot;bin/php/ezcache.php&quot; script as shown below:</p><pre class="wordwrap"><span class="line">$php bin/php/ezcache.php --clear-all --purge</span>
</pre><p>Note that &quot;$php&quot; should be replaced by the path to your php executable.</p><a name="eztoc126144_1_2" id="eztoc126144_1_2"></a><h3>2. Unclusterize images and other files</h3><p>You need to copy images, binary files and content-related caches from the database to the file system. This can be done by running the &quot;bin/php/clusterize.php&quot; script with the &quot;-u&quot; parameter. Make sure that you have enough disk space on the file system before starting this operation.</p><p>The following example shows how to run the script (replace &quot;ezwebin_site&quot; with the actual name of your siteaccess):</p><pre class="wordwrap"><span class="line">$php bin/php/clusterize.php -u -s ezwebin_site</span>
</pre><p>Note that &quot;$php&quot; should be replaced by the path to your php executable.</p><p>The script will go through the files stored in the database and copy them into the appropriate subdirectories of the &quot;var&quot; directory.</p><a name="eztoc126144_1_3" id="eztoc126144_1_3"></a><h3>3. Modify the &quot;file.ini&quot; settings</h3><p>Open the &quot;settings/override/file.ini.append.php&quot; configuration file and edit it. Comment all lines located under the [ClusteringSettings] block by adding &quot;#&quot; as shown below:</p><pre class="wordwrap copytoclipboard"><span class="line">[ClusteringSettings]</span>
<span class="line">#FileHandler=eZDBFileHandler</span>
<span class="line">#DBBackend=eZDBFileHandlerMysqliBackend</span>
<span class="line">#DBHost=localhost</span>
<span class="line">#DBPort=3306</span>
<span class="line">#DBSocket=</span>
<span class="line">#DBName=name</span>
<span class="line">#DBUser=user</span>
<span class="line">#DBPassword=pass</span>
<span class="line">#DBChunkSize=65535</span>
</pre><!--[if IE]>
<p class="copytoclipboard"><img src="/extension/ezdoc/design/doc/images/copytoclipboard.gif" height="16" width="16" alt="Copy to clipboard" title="Copy to clipboard" onclick="window.clipboardData.setData( 'text', '[ClusteringSettings]\r\n#FileHandler=eZDBFileHandler\r\n#DBBackend=eZDBFileHandlerMysqliBackend\r\n#DBHost=localhost\r\n#DBPort=3306\r\n#DBSocket=\r\n#DBName=name\r\n#DBUser=user\r\n#DBPassword=pass\r\n#DBChunkSize=65535' ); return false;" /></p>
<![endif]--><p>If the file does not exist in the &quot;settings/override&quot; directory, update the &quot;settings/siteaccess/ezwebin_site/file.ini.append.php&quot; file instead (where &quot;ezwebin_site&quot; is the name of your siteaccess).</p><p>Note that you can also remove the entire [ClusteringSettings] block instead of commenting the lines one by one.</p><p>By commenting out the entire entry you will revert to the default setting in &quot;settings/file.ini&quot; where the default FileHandler is eZ FS File Handler.</p><p>However if you prefer not to add #'s or delete the entry you can also set the FileHandler setting to eZFSFileHandler for the same result.</p><pre class="wordwrap"><span class="line">[ClusteringSettings]</span>
<span class="line">&nbsp;</span>
<span class="line">FileHandler=eZFSFileHandler</span>
</pre><a name="eztoc126144_1_4" id="eztoc126144_1_4"></a><h3>4. (Optional) Disable the script for serving images</h3><p>Rename or remove the &quot;index_cluster.php&quot; file located in the root directory of your Exponential installation. Until now, this script was used to serve images stored in your MySQL database. This step is not required if you properly perform &quot;step 5&quot; and remove the cluster rewrite rules, because once the rewrite rules are removed Apache will no longer use the script anyway.</p><a name="eztoc126144_1_5" id="eztoc126144_1_5"></a><h3>5. Update the Apache configuration</h3><p>Comment out or remove the following lines in your &quot;.htaccess&quot; file:</p><pre class="wordwrap"><span class="line">RewriteRule ^/var/([^/]+/)?storage/images-versioned/.* &nbsp;/index_cluster.php [L]</span>
<span class="line">RewriteRule ^/var/([^/]+/)?storage/images/.* &nbsp;/index_cluster.php [L]</span>
<span class="line">RewriteRule &nbsp;^/var/([^/]+/)?cache/public/(stylesheets|javascript) /index_cluster.php &nbsp;[L]</span>
</pre><p>If no &quot;.htaccess&quot; file is used, you need to comment out the same lines in the Apache configuration file.</p><a name="eztoc126144_1_6" id="eztoc126144_1_6"></a><h3>6. Restart Apache and test the site</h3><p>Restart the Apache web server. After it has been restarted, your site should be using images, binary files and content-related caches stored in the &quot;var&quot; directory. Verify that the site works correctly, content images are displayed and content binary files are accessible (open the site pages in a web browser, log in to the administration interface, try clicking around and so on).</p><a name="eztoc126144_1_7" id="eztoc126144_1_7"></a><h3>7. Remove the clustering tables from the database</h3><p>If the site works correctly, you can remove the database tables that were previously used for storing images, binary files and content-related caches. This can be done by executing the following SQL queries:</p>
<ul>
<li><div>
&nbsp;With eZDB<br />&nbsp;DROP TABLE ezdbfile;DROP TABLE ezdbfile_data;</div></li><li><div>
&nbsp;With eZDFS<br />
&nbsp;DROP TABLE ezdfsfile;<br />&nbsp;Note that the files on the NFS share need to be removed manually.</div></li>
</ul>
<a name="eztoc126144_2" id="eztoc126144_2"></a><h2><b>Changing to another Cluster file handler</b></h2><a name="eztoc126144_2_8" id="eztoc126144_2_8"></a><h3><b>1. Revert to non cluster mode</b></h3><p>When changing from one cluster file handler to another it is best to first un-cluster by following the steps described in &quot;<a href="Reverting-a-cluster-setup.html#revert" target="_self">Reverting to non cluster setup</a>&quot; before changing to another cluster file handler.</p><a name="eztoc126144_2_9" id="eztoc126144_2_9"></a><h3>2. Setup cluster</h3><p>Follow the steps described in &quot;<a href="Setting-it-up-for-an-eZDBFileHandler.html" target="_self">Setting it up for an eZ DB FileHandler</a>&quot; or &quot;<a href="Setting-it-up-for-an-eZDFSFileHandler.html" target="_self">Setting it up for an eZ DFS FileHandler</a>&quot; to cluster your installation with the new cluster file handler.</p>

<div class="break"></div><div class="pageinfo float-break">
<div class="created">


<p><label>Written by:</label>Ester Heylen&nbsp;(14/09/2010 12:35 pm)</p>
</div>
<div class="modified">
<p><label>Last updated by:</label>Geir Arne Waaler&nbsp;(08/11/2011 8:58 am)</p>
</div></div>
<hr class="hide" />

</div>
</div>
</div>

<div id="comments" class="class-comment">
<div class="content-view-children">

<h1>Comments</h1>
<p>There are no comments.</p>
<div class="toolbar">

<form method="post" action="https://doc.ez.no/doc_hidden/content/action">
<input class="button" type="submit" name="NewButton" value="New comment" />
<input type="hidden" name="NodeID" value="26220" />
<input type="hidden" name="RedirectURIAfterPublish" value="Exponential/Technical-manual/4.6/Features/Clustering/Reverting-a-cluster-setup" />
<input type="hidden" name="ClassID" value="17" />
</form>
</div>

</div>
</div>

</div>
<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide" />

</div></div></div>

        <div id="footer-bg">
        <div id="footer" class="container_12">

            <div class="grid_3">
                <img src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/images/exponential.png" alt="exponential" />
                <div id="footer-copyright" class="grid_3 alpha omega">
                                    </div>
            </div>

            <div class="grid_6 middle">
                <div class="grid_6 alpha omega">
                    <div class="grid_3 alpha"><div></div></div>
                    <div class="grid_3 omega"><div></div></div>
                </div>
            </div>

            <div class="grid_3 right">
                <div class="contact-ez">
                        <a id="cta-contact" href="https://se7enx.com" title="Contact 7x!" class="btn-green btn--small">Contact 7x!</a>
                </div>

                <div class="adress"></div>
            </div>

        </div>
    </div>
<div id="footer-connect-bg">
    <div id="footer" class="container_12">
        <div id="footer-connect-copyright" class="grid_8 alpha omega">
            Copyright © 1998 - 2025 7x (except where otherwise noted). All rights reserved.
            <br/><br/>
            Powered by <a href="https://se7enx.com/exponential" title="Exponential CMS">The Exponential CMS</a>.<br />
        </div>

        <div id="footer-connect-social" class="grid_4 right">
            <a href="https://www.youtube.com/@ExponentialCMSInsights" class="youtube" target="_blank">YouTube</a>
            
            <a href="http://www.Linkedin.com/groups?gid=2759&amp;trk=myg_ugrp_ovr" class="Linkedin" target="_blank">Linkedin</a>
            <a href="https://www.Instagram.com/se7enxweb" class="Instagram" target="_blank">Instagram</a>
            <a href="https://twitter.com/se7enxweb" class="X" target="_blank">X</a>
        </div>


    </div>
</div>


</div>
<!-- Complete page area: END -->




<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1VMV65H63V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1VMV65H63V');
</script>






</body>

<!-- Mirrored from doc.ez.no/doc_hidden/Exponential/Technical-manual/4.6/Features/Clustering/Reverting-a-cluster-setup by HTTrack Website Copier/3.x [XR&CO'2013], Wed, 01 Feb 2017 00:29:38 GMT -->
</html>

<!-- th[eZ] 20050804 -->
