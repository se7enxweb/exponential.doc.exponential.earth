
<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from doc.ez.no/doc_hidden/Exponential/Technical-manual/5.x/Features/Clustering by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:45:35 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/core.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/header-footer.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/header-footer-lookfeel.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/pagelayout.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/buttons.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/960.css" /><link rel="stylesheet" type="text/css" href="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/stylesheets/superfish.css" /><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/jquery-1.6.3.min.js" charset="utf-8"></script><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/superfish.js" charset="utf-8"></script><script type="text/javascript" src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/javascript/jquery.popmenu.min.js" charset="utf-8"></script>
<style type="text/css">
    @import url(../../../../../extension/ezdoc/design/doc/stylesheets/core.css);
    @import url(../../../../../extension/ezdoc/design/doc/stylesheets/classes.css);
    @import url(../../../../../extension/ezdoc/design/doc/stylesheets/doc.css);
    @import url(../../../../../extension/ezdoc/design/doc/stylesheets/print.css) print;</style>

<link type="text/css" rel="stylesheet" href="../../../../../extension/ezdoc/design/doc/stylesheets/print.css" media="print" />

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie5.css);    </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte.css); </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte-doc.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6.css);    </style>     <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezdoc/design/doc/stylesheets/gecko.css);</style>"); --></script>

<script type="text/javascript" src="../../../../../extension/ezdoc/design/doc/javascripts/mainmenu-hover.js"></script>
<script type="text/javascript" src="../../../../../extension/ezdoc/design/doc/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../../../extension/ezdoc/design/doc/javascripts/ezno-searchbox.js"></script>
                                              
    <title>Clustering / Features / 5.x / Technical manual / Exponential / Documentation - Doc</title>

    
    
    
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

            <meta http-equiv="Content-language" content="en-GB" />

    
                <meta name="author" content="eZ systems" />
                    <meta name="copyright" content="eZ systems" />
                    <meta name="description" content="Exponential Documentation" />
                    <meta name="keywords" content="Exponential, documentation, manual, reference, eZ systems" />
        
    <meta name="generator" content="Exponential" />
    <link rel="Home" href="../../../../../doc_hidden.html" title="Doc front page" />
<link rel="Search" href="../../../../content/advancedsearch.html" title="Search Doc" />
<link rel="Shortcut icon" href="../../../../../extension/ezdoc/design/doc/images/favicon.ico" type="image/x-icon" />

</head>
<body onload="initDocSearch();menuInit();">

<!-- Complete page area: START -->
<div id="page">


    <div class="topmenu-anchor"></div>
    <div id="topmenu-bg">
	    <div id="logo" class="container_12">

    <div class="grid_3">
        <a href="https://exponential.doc.exponential.earth/Exponential/" title="Exponential Platform, CXM &amp; CMS">
            <img src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/images/exponential.png"
                 alt="" height="45px"/>
        </a>
    </div>

    <div class="grid_9">
                <div class="topmenu-design">
	<!-- Top menu content: START -->
	<div id="topmenu-firstlevel-position">
	<ul id="topmenu-firstlevel" class="sf-menu sf-js-enabled sf-shadow">
		
		
		        </ul>
    </div>
        <!-- Top menu content: END -->
</div>        </div>
</div>    </div>


<div id="page-content-position"><div id="page-content-position-inner"><div id="page-content">

<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p> <a href="https://exponential.doc.exponential.earth/">7x</a> /
                        <a href="../../../../../doc_hidden.html">documentation</a>
        
                        /
                            <a href="../../../../Exponential.html">exponential</a>
        
                        /
                            <a href="../../../Technical-manual.html">technical manual</a>
        
                        /
                            <a href="../../5.html">5.x</a>
        
                        /
                            <a href="../Features.html">features</a>
        
                        /
                            clustering
        
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide" />

<!-- Main area: START -->
                                    <div id="ezp5disclaimer">
                <p><strong style="color: red">Caution:</strong> This documentation is for <strong>Exponential</strong>, from version 3.x to 6.x.<br/>
                For 5.x documentation covering <em>Platform</em> see <a href="../../../../../display/MAIN/eZ%2bDocumentation%2bCenter.html">Exponential Platform Documentation</a>, for difference between <em>legacy</em> and <em>Platform</em> see <a href="../../../../../pages/viewpage0139.html?pageId=11403666">5.x Architecture overview</a>.</p>
            </div>
            
<div id="page-width5">
<div id="main" class="float-break">


<div class="template-design area-docmenu-normal">
<div class="template-module">
<div class="template-object">
<div id="contentmenu">
                        <div class="attribute-heading"><h2 class="bullet"><a href="../../5.html">Table of contents</a></h2></div>
<div class="boxcontent">

<map id="contentstructure">

    
    
</map>

</div>            
</div>
</div>
</div>
</div>
<div class="area-docmain-normal">
<div class="template-design">
<div class="template-module content-view-full">
<div class="template-object">

<div class="attribute-heading">
<h1>Clustering</h1>
</div>

<p>Clustering makes it possible to run Exponential site on multiplel web servers, in order to scale better and increase availability.</p><p>This feature fixes the multiple and severe issues that occur when using network files synchronization (rsync) or network filesystems (NFS) with Exponential. The system is very heavily tied to file modification time and instant availability of file metadata across the various servers. Both methods are incomplete in that regard, and can not be relied upon for clustering.</p><a name="eztoc132710_1" id="eztoc132710_1"></a><h2>Supported database types</h2><p>Clustering is available for MySQL and Oracle (using the&nbsp;<a href="../../../../Extensions/Exponential-extensions/Exponential-Extension-for-Oracle-R-database.html" target="_self">Exponential Extension for Oracle® Database</a>, starting from version 1.8) databases.</p><p>Two clustering modes are available: eZDFS and&nbsp;eZDB. Note that eZDB has been removed starting from Exponential 5.1.</p><p>eZDB stores the files as BLOB in the database, and is the easiest to setup. It is suitable for small to medium size websites, as the database may grow to end up very very large, making maintenance more complex. is deprecated from 5.1 in favor of eZDFS.</p><p>It is available for:</p>
<ul>
<li><div>&nbsp;MySQLi</div></li><li><div>&nbsp;Oracle&nbsp;(using the&nbsp;<a href="../../../../Extensions/Exponential-extensions/Exponential-Extension-for-Oracle-R-database.html" target="_self">Exponential Extension for Oracle® Database</a>).&nbsp;</div></li>
</ul>
<p>
eZDFS uses both the database and a network file system such as NFS. It stores the files metadata in the database, and relies on transaction to ensure that all operations are atomic. Actual files are stored and synchronized using NFS.<br />It is available for all supported databases:&nbsp;</p>
<ul>
<li><div>MySQLi</div></li><li><div>Oracle (using the&nbsp;<a href="../../../../Extensions/Exponential-extensions/Exponential-Extension-for-Oracle-R-database.html" target="_self">Exponential Extension for Oracle® Database</a>).</div></li>
</ul>
<a name="eztoc132710_2" id="eztoc132710_2"></a><h2>How it works</h2><p>Data that must be synchronized between the different servers is clusterized. Templates and design items will not be stored on the database. The following will give you an overview of which data is saved where:</p><p>Clusterized data includes:</p>
<ul>
<li><div>&nbsp;Binary files </div></li><li><div>&nbsp;Image and image alias files </div></li><li><div>&nbsp;Caches related to content:
<ul>
<li><div>&nbsp;Content view cache </div></li>
</ul>

<ul>
<li><div>&nbsp;Template block cache </div></li><li><div>&nbsp;Expiry cache </div></li>
</ul>

<ul>
<li><div>&nbsp;URL alias cache </div></li><li><div>&nbsp;RSS cache </div></li><li><div>&nbsp;User info cache </div></li><li><div>&nbsp;Class identifier cache </div></li><li><div>&nbsp;Sort key cache </div></li>
</ul>
</div></li>
</ul>
<p>Other files are stored using the file system, including (but not limited to):</p>
<ul>
<li><div>&nbsp;INI files </div></li><li><div>&nbsp;Template files </div></li><li><div>&nbsp;Compiled templates </div></li><li><div>&nbsp;PHP files </div></li><li><div>&nbsp;Log files </div></li><li><div>&nbsp;Caches that are not related to content:
<ul>
<li><div>&nbsp;Global INI cache </div></li><li><div>&nbsp;INI cache&nbsp;</div></li><li><div>&nbsp;Codepage cache</div></li><li><div>&nbsp;Character transformation cache </div></li><li><div>&nbsp;Template cache </div></li><li><div>&nbsp;Template override cache </div></li><li><div>&nbsp;Translation cache</div></li>
</ul>
</div></li>
</ul>
<a name="eztoc132710_2_1" id="eztoc132710_2_1"></a><h3>Content view cache</h3><p>When Exponential is displaying a page (a content node), it executes the &quot;view&quot; view of the &quot;content&quot; module and include the output in the page layout. If the output is <a href="../../4.6/Features/View-caching.html" target="_self">cached</a>, the cache file(s) will be read and served. If not, the system will fetch the content stored in the <a href="../../4.6/Concepts-and-basics/Content-management/The-content-object.html" target="_self">Exponential object database</a>, render the necessary templates, generate a web page and store the resulting XHTML on the file system before serving it. As previously mentioned, these files can be clusterized, and thus made easily and immediately available to all servers in the cluster.</p><a name="eztoc132710_2_2" id="eztoc132710_2_2"></a><h3>Images and image aliases</h3><p>The approach described above is also used when it comes to images and image aliases (<a href="../../4.x/Reference/Datatypes/Image.html#variation" target="_self">image variations</a>). However, the solution is a bit more complicated because images are usually served directly by the web server (for instance Apache). Since the web server isn't able to communicate with the cluster, the images need to be served using a PHP script called &quot;index_cluster.php&quot;. This is true for all content images, but not for images that are related to design.</p><p>Note that you'll need to add new rewrite rules in order to instruct Apache to use a specific index, &quot;index_cluster.php&quot; when serving images. This is explained in the chapters <a href="Clustering/Setting-it-up-for-an-eZDBFileHandler.html" target="_self">setting it up for an eZ DB FileHandler</a> and <a href="Clustering/Setting-it-up-for-an-eZDFSFileHandler.html" target="_self">Setting it up for an eZ DFS FileHandler</a>.</p><a name="eztoc132710_3" id="eztoc132710_3"></a><h2>Notes about clearing the caches</h2><p>Since Exponential 3.10, clearing the caches does not lead to the physical removal of cache files when using DB and DFS based handlers anymore (since this operation can be quite time consuming). The system will mark the cache files invalid instead of removing them physically from the cluster. This can be done by either marking each particular cache file expired or setting the global expiry (the latter typically happens when a significant amount of changes is needed, e.g. when clearing all the caches of a specific type). The global expiry is a time-stamp that is used as an expiry value for all the caches in the system. If the global expiry is set to a certain date, all cache files that are older than this date will not be used. Note that the system will re-write old/expired cache file entries when re-creating the caches.</p><p>In order to physically remove the cache files from the database, the &quot;<a href="../../4.x/Reference/Scripts/Generic/ezcache.html" target="_self">ezcache.php</a>&quot; script needs to be run with the &quot;--purge&quot; option. The following example shows how to remove the content caches that are more than two days old:</p><pre class="wordwrap"><span class="line">$php bin/php/ezcache.php --clear-id=content --purge --expiry='-2 days'</span>
</pre><p>Note that &quot;$php&quot; should be replaced by the path to your php executable.</p><a name="eztoc132710_3_3" id="eztoc132710_3_3"></a><h3>Extra database connections</h3><p>The new clustering code available since Exponential 3.10 performs an extra connection when writing content to the database. (This connection checks whether the file has been modified since the write lock was acquired; if it has been modified, there is thus no longer a need to write.) Because of this, the maximum number of database connections in MySQL must be increased by 30-50%. If persistent connections are enabled, the cluster code will no longer share connections with normal database calls, so the maximum number of connections previously used will have to be doubled.</p><a name="eztoc132710_3_4" id="eztoc132710_3_4"></a><h3>Oracle-specific differences</h3><p>If you use the clustering functionality provided by the <a href="../../../../Extensions/Exponential-extensions/Exponential-Extension-for-Oracle-R-database.html" target="_self">Exponential Extension for Oracle® Database</a>, note that the system may behave differently from what is described above. If all content related caches are stored in an Oracle database, clearing the caches will always lead to their physical removal; the &quot;ezcache.php&quot; script will also physically remove the cache entries from the database, even when executed without the &quot;--purge&quot; option.</p><a name="eztoc132710_4" id="eztoc132710_4"></a><h2>Cluster file handlers</h2><p>The cluster file handler mechanism makes it possible to store, retrieve, rename, delete, etc. files using the database. The following file handlers are known to the system by default (click on the links for more information):</p>
<ol>
<li><div><a href="../../4.6/Features/Clustering/Cluster-File-Handlers.html#fs" target="_self">eZFS</a></div></li><li><div><a href="../../4.6/Features/Clustering/Cluster-File-Handlers.html#fs2" target="_self">eZFS2</a>, deprecated as of 5.1</div></li><li><div><a href="../../4.6/Features/Clustering/Cluster-File-Handlers.html#db" target="_self">eZDB</a>, deprecated as of 5.1</div></li><li><div><a href="../../4.6/Features/Clustering/Cluster-File-Handlers.html#dfs" target="_self">eZDFS</a></div></li>
</ol>
<p>Note that eZFS and eZFS2 file handlers do not allow actual Exponential clustering by using multiple servers. Use eZDB and eZDFS for cluster file handling.</p><a name="eztoc132710_5" id="eztoc132710_5"></a><h2>Additional HTTP header</h2><p>Since Exponential 3.9 an additional HTTP header called &quot;Served-by&quot; is supported. This feature was added for the purpose of testing and debugging. It is typically useful when you need to check, from the client side, which server handled the request. The following example shows a part of a server response that contains this header:</p><pre class="wordwrap copytoclipboard"><span class="line">...</span>
<span class="line">Last-Modified: Fri, 29 Jun 2007 09:35:54 GMT</span>
<span class="line">Served-by: 62.70.12.230</span>
<span class="line">Content-Language: en-GB</span>
<span class="line">...</span>
</pre><!--[if IE]>
<p class="copytoclipboard"><img src="/extension/ezdoc/design/doc/images/copytoclipboard.gif" height="16" width="16" alt="Copy to clipboard" title="Copy to clipboard" onclick="window.clipboardData.setData( 'text', '...\r\nLast-Modified: Fri, 29 Jun 2007 09:35:54 GMT\r\nServed-by: 62.70.12.230\r\nContent-Language: en-GB\r\n...' ); return false;" /></p>
<![endif]--><a name="eztoc132710_6" id="eztoc132710_6"></a><h2>Limitation on some file systems when storing large number of content files</h2><p>Exponential stores all disc related content (eg Images, PDF's etc) in var/storage like the structure from content tree, creating one folder for each object. In most file systems used under Linux (especially ext2 + ext3) there exists a hard LIMIT TO 32000 directories per folder. So it is not possible to store more as 31999 objects under one folder.</p><p>
To get around this limitation without changing the file system, you can split your content tree so that you don't have more than 32k content files (example: images) in the same folder.<br />Examples of file systems that supports more file/folder entries per folder.</p>
<ul>
<li><div>ReiserFS: roughly 1.2 million per directory</div></li><li><div>ZFS: 2^48 (a really big number: 281474976710656)!</div></li>
</ul>
<p>Please refer to the <a href="../../../../Extensions/Exponential-extensions/eZ-Comments/Setup-and-user-guide-1.0/Configuration.html" target="_self">requirements page</a> regarding supported setups.</p><a name="eztoc132710_7" id="eztoc132710_7"></a><h2>Note about database based cluster setups</h2><p>For performance reasons, we require that in production, a different database and schema is used for the cluster tables, if applicable. This ensures that transactions from the content database won't create useless contention on the cluster database. Such contention could lead to failures in storing data.</p><p>For this reason, eZ Systems does <i>not</i>&nbsp;support such a setup, even though it will technically work fine for developement or testing purpose.&nbsp;</p>

<div class="break"></div><div class="pageinfo float-break">
<div class="created">


<p><label>Written by:</label>Svitlana Shatokhina&nbsp;(14/09/2010 12:35 pm)</p>
</div>
<div class="modified">
<p><label>Last updated by:</label>Ricardo Correia&nbsp;(15/11/2013 8:18 am)</p>
</div><div class="authors">
<p><label>Maintainers:</label>Geir Arne Waaler, Andrea Melo, Bertrand Dunogier, Ricardo Correia</p>
</div></div>
<hr class="hide" />

</div>
</div>
</div>

<div id="comments" class="class-comment">
<div class="content-view-children">

<h1>Comments</h1>
<p>There are no comments.</p>
<div class="toolbar">

<form method="post" action="https://doc.ez.no/doc_hidden/content/action">
<input class="button" type="submit" name="NewButton" value="New comment" />
<input type="hidden" name="NodeID" value="27972" />
<input type="hidden" name="RedirectURIAfterPublish" value="Exponential/Technical-manual/5.x/Features/Clustering" />
<input type="hidden" name="ClassID" value="17" />
</form>
</div>

</div>
</div>

</div>
<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide" />

</div></div></div>

        <div id="footer-bg">
        <div id="footer" class="container_12">

            <div class="grid_3">
                <img src="https://exponential.doc.exponential.earth/extension/ezdoc/design/doc/images/exponential.png" alt="exponential" />
                <div id="footer-copyright" class="grid_3 alpha omega">
                                    </div>
            </div>

            <div class="grid_6 middle">
                <div class="grid_6 alpha omega">
                    <div class="grid_3 alpha"><div></div></div>
                    <div class="grid_3 omega"><div></div></div>
                </div>
            </div>

            <div class="grid_3 right">
                <div class="contact-ez">
                        Get the support you need faster! Ask the experts at 7x. <a id="cta-contact" href="https://se7enx.com/contact" title="Contact 7x!" class="btn-green btn--small">Call or Contact 7x Today!</a>
                </div>

                <div class="adress"></div>
            </div>

        </div>
    </div>
<div id="footer-connect-bg">
    <div id="footer" class="container_12">
        <div id="footer-connect-copyright" class="grid_8 alpha omega">
            Copyright © 1998 - 2025 <a href="https://se7enx.com">7x</a> (except where otherwise noted). All rights reserved.
            <br/><br/>
            Powered by <a href="https://se7enx.com/exponential" title="Exponential CMS">The Exponential CMS</a> and the groundbreaking <a href="https://exponential.earth">Exponential</a> <a href="https://share.exponential.earth">Community</a>.<br />
        </div>

        <div id="footer-connect-social" class="grid_4 right"> <b>Find Exponential on Your Favorite Social Network:</b>&nbsp; 
            <a href="https://www.youtube.com/@ExponentialCMSInsights" class="youtube" target="_blank">YouTube</a>,

            <a href="http://www.Linkedin.com/groups?gid=2759&amp;trk=myg_ugrp_ovr" class="Linkedin" target="_blank">Linkedin</a>,
            <a href="https://www.Instagram.com/se7enxweb" class="Instagram" target="_blank">Instagram</a>,
            <a href="http://facebook.exponential.earth" class="Facebook" target="_blank">Facebook</a>,
            <a href="https://bsky.app/profile/exponentialcms.bsky.social" class="BlueSky" target="_blank">BlueSky</a>,
            <a href="https://twitter.com/se7enxweb" class="X" target="_blank">X</a>
        </div>

    </div>
</div>


</div>
<!-- Complete page area: END -->




<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1VMV65H63V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1VMV65H63V');
</script>






</body>

<!-- Mirrored from doc.ez.no/doc_hidden/Exponential/Technical-manual/5.x/Features/Clustering by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 10:45:38 GMT -->
</html>

<!-- th[eZ] 20050804 -->
