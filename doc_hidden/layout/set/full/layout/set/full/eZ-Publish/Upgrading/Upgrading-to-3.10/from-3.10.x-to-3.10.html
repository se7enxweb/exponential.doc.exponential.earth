

<!DOCTYPE html>
<html lang="en-GB">


<!-- Mirrored from doc.ez.no/doc_hidden/layout/set/full/layout/set/full/Exponential/Upgrading/Upgrading-to-3.10/from-3.10.x-to-3.10.y by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 23:43:13 GMT -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <link rel="stylesheet" type="text/css" href="../../../../../../../../../../extension/ezdoc/design/doc/stylesheets/core.css" />
<style type="text/css"></style>
                                        
    <title>from 3.10.x to 3.10.y / Upgrading to 3.10 / Upgrading / Exponential / Documentation - Doc</title>

    
    
    
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

            <meta http-equiv="Content-language" content="en-GB" />

    
                <meta name="author" content="eZ systems" />
                    <meta name="copyright" content="eZ systems" />
                    <meta name="description" content="Exponential Documentation" />
                    <meta name="keywords" content="Exponential, documentation, manual, reference, eZ systems" />
        
    <meta name="generator" content="Exponential" />
    <link rel="Home" href="../../../../full.html" title="Doc front page" />
<link rel="Search" href="../../../content/advancedsearch.html" title="Search Doc" />
<link rel="Shortcut icon" href="../../../../../../../../../../extension/ezdoc/design/doc/images/favicon.ico" type="image/x-icon" />

</head>

<body>



<div class="attribute-heading">
<h1>from 3.10.x to 3.10.y</h1>
</div>

 <p>This section describes how to upgrade your existing Exponential 3.10.x installation to version 3.10.y, for example from 3.10.0 to 3.10.1. If you are upgrading from a version prior to Exponential 3.10.0, refer to the &quot;<a href="from-3.9.x-to-3.10.html" target="_self">Upgrading from 3.9.x to 3.10.y</a>&quot; section for upgrade instructions.</p> <p>It is recommended to upgrade directly to the latest stable release in the 3.10 branch, which contains all important bug fixes. Refer to the <a href="https://github.com/ezsystems/exponential-legacy/blob/master/doc/changelogs/3.10/CHANGELOG-3.9.0-to-3.10.0" target="_blank">changelogs</a> and <a href="http://ez.no/developer/security/security_advisories/ez_publish_3_10" target="_blank">security advisories</a> for more information about the issues that were fixed in the latest releases or view the short list of changes <a href="from-3.9.x-to-3.10.html#latest_release_advantages" target="_self">here</a>.</p> <p>The upgrade procedure described below is generic and does not cover any specific cases. If you are running Exponential in a clustered environment, refer to the <a href="https://github.com/ezsystems/exponential-legacy/blob/master/doc/features/3.10/cluster_enhancement.txt" target="_blank">developer documentation</a> for upgrade instructions. In case the Exponential Extension for OracleÂ® Database is used, refer to the <a href="../../../Extensions/Exponential-extensions/Exponential-Extension-for-Oracle-R-database.html" target="_self">documentation of the database extension</a>.</p> <p>Make sure that you have a working <a href="../../Upgrading.html#backup" target="_self">backup</a> of the site before you do the actual upgrade. The upgrade procedure consists of the following steps:</p> 
<ol>
 <li><div> Upgrading the distribution files to 3.10.1 </div></li> <li><div> Upgrading the database to 3.10.1 </div></li> <li><div> Running the system upgrade scripts </div></li> <li><div> Updating the system configuration </div></li> <li><div> Clearing the caches </div></li> 
</ol>
  <a name="eztoc96179_1" id="eztoc96179_1"></a><h2>Step 1: Upgrading the distribution files</h2> <p>The easiest way to upgrade the distribution files is to unpack Exponential 3.10.1 to a directory and then copy the directories that contain site-specific files from the existing installation. Make sure that you copy the following directories: </p> 
<ul>
 <li><div> design/example </div></li> <li><div> design/example_admin </div></li> <li><div> var </div></li> <li><div> settings/siteaccess </div></li> <li><div> settings/override </div></li> 
</ul>
 <p>Replace &quot;example&quot; and &quot;example_admin&quot; with the actual names of your siteaccesses.</p>  <a name="eztoc96179_1_1" id="eztoc96179_1_1"></a><h3>Custom extensions</h3> <p>If you are using custom extensions, the subdirectories inside the &quot;extension&quot; directory will also have to be copied. However, make sure that you do not overwrite any extensions that come with Exponential (currently &quot;ezdhtml&quot;, &quot;ezodf&quot;, &quot;ezpaypal&quot; and &quot;ezurlaliasmigration&quot;).</p> <p>If you are using the <a href="../../../Extensions/Exponential-extensions/Website-Interface.html" target="_self">Website Interface</a> front-end, be sure to copy the &quot;extension/ezwebin/&quot; directory. It is also possible to upgrade the Website Interface extension to a newer version (you can find more information and instructions in the &quot;Upgrading the Website Interface&quot; chapter of the <a href="../../../Extensions/Exponential-extensions/Website-Interface.html#download" target="_self">Website Interface installation guide</a>).</p>   <a name="eztoc96179_1_2" id="eztoc96179_1_2"></a><h3>Important bug fix for remote IDs</h3> <p>Due to some bugs in previous versions of Exponential (3.9.0 and others), it might happen that not all content objects in your database have unique <a href="../../Technical-manual/3.10/Reference/Objects/ezcontentobject.html#remote_id" target="_self">remote IDs</a>. This basically means that the &quot;remote_id&quot; column of the &quot;ezcontentobject&quot; table in the database might contain duplicate values. In Exponential 3.10.1, a database schema change was introduced in order to ensure that only unique remote IDs can be stored in this table. Because of this, you need to make sure that there are no content objects with identical remote IDs before upgrading the database. This can be done by running the &quot;fixobjectremoteid.php&quot; upgrade script. (Note that both the database schema change and the upgrade script were added to Exponential 3.9.5 and 4.0.1 as well.) </p> <p>This script should be run once for each database, specifying one siteaccess per database. If you only have a public and an administration siteaccess that share the same database (which is the most typical/usual case), you only need to run the script for one of the siteaccesses. If the siteaccess isn't specified, the <a href="../../Technical-manual/3.10/Reference/Configuration-files/site.ini/SiteSettings/DefaultAccess.html" target="_self">default siteaccess</a> will be used. </p> <p>The following example shows how to run the script:</p> 
<ol>
 <li><div> Navigate into the Exponential 3.10.1 directory. </div></li> <li><div> <p>Run the script (replace &quot;example&quot; with the actual name of your siteaccess):</p> <pre class="wordwrap"><span class="line">php update/common/scripts/3.10/fixobjectremoteid.php -s example</span>
</pre> </div></li> 
</ol>
 <p>The script will search for objects with non-unique remote IDs. Every time such an object is found, the script will suggest to either display more detailed information or fix the problem automatically. If you choose the first option, the script will display the list of objects that have the same remote ID and let you decide which one should remain unchanged; all other objects in the list will get new remote IDs. Otherwise, the script will fix the problem automatically based on the objects' creation dates. This means that the script will generate new remote IDs for all objects in the list except the one that was created first.</p> <p>The optional &quot;--mode&quot; parameter makes it possible to run the script in either &quot;auto-fix&quot; or &quot;manual-fix&quot; mode as shown below.</p> <pre class="wordwrap"><span class="line">php update/common/scripts/3.10/fixobjectremoteid.php -s example --mode=value</span>
</pre> <p>If you replace &quot;value&quot; with &quot;a&quot; in the command above, the script will automatically fix all non-unique remote IDs that are found in the database based on the objects' creation dates. In this case, no further input is required from the user. If you specify &quot;--mode=d&quot;, the script will display the list of objects for each non-unique remote ID so that you can manually choose which objects should keep their remote IDs.</p>    <a name="eztoc96179_2" id="eztoc96179_2"></a><h2>Step 2: Upgrading the database</h2> <p>The following text describes how a 3.10.0 database can be upgraded to 3.10.1.</p>  <a name="eztoc96179_2_3" id="eztoc96179_2_3"></a><h3>MySQL</h3> 
<ol>
 <li><div> Navigate into the Exponential 3.10.1 directory. </div></li> <li><div> Run the database upgrade script: <pre class="wordwrap"><span class="line">mysql -u &lt;username&gt; -p&lt;password&gt; &lt;database&gt; &lt; update/database/mysql/3.10/dbupdate-3.10.0-to-3.10.1.sql</span>
</pre>  </div></li> 
</ol>
 <p>
Note that the CREATE TABLE statement in the database upgrade script does not specify which storage engine to use (no ENGINE or TYPE option), and thus the default storage engine will be used. Normally, it is MyISAM (starting from MySQL v.3.23). If you are using InnoDB, make sure the default storage engine is set to InnoDB before you run the database upgrade script (refer to the <a href="http://dev.mysql.com/doc/refman/5.0/en/storage-engines.html" target="_blank">MySQL documentation</a> for information about how to set the default engine). If you were not able to change the MySQL configuration on your server, and the upgrade left you with a mix of table types, you can convert the newly created table to InnoDB using the following SQL query: <br /></p><pre class="wordwrap"><span class="line">ALTER TABLE ezurlwildcard TYPE = innodb;</span>
</pre><p>
 <br />It is also possible to use the &quot;bin/php/ezconvertmysqltabletype.php&quot; script for database conversion.</p>   <a name="eztoc96179_2_4" id="eztoc96179_2_4"></a><h3>PostgreSQL</h3> 
<ol>
 <li><div> Navigate into the Exponential 3.10.1 directory. </div></li> <li><div> Run the database upgrade script: <pre class="wordwrap"><span class="line">psql -d &lt;database&gt; -U &lt;dbowner&gt; &lt; update/database/postgresql/3.10/dbupdate-3.10.0-to-3.10.1.sql</span>
</pre>  </div></li> 
</ol>
    <a name="eztoc96179_3" id="eztoc96179_3"></a><h2>Step 3: Running the system upgrade scripts</h2> <p>The 3.10.1 version of Exponential introduces a couple of important bug fixes and functionality changes. In order to make sure that your site is compatible with these changes, you may need to run a few upgrade scripts.</p>  <a name="eztoc96179_3_5" id="eztoc96179_3_5"></a><h3>Multi-language support for URL aliases</h3> <p>In Exponential 3.10.1, the <a href="../../Technical-manual/3.10/Features/Multi-language-support-for-URL-aliases.html" target="_self">multi-language support for URL aliases</a> was substantially improved, along with some important bug fixes related to this functionality. In addition, the &quot;bin/php/updateniceurls.php&quot; script was updated and the support for new parameters was added. When upgrading, you need to regenerate all URL aliases that are stored in the &quot;ezurlalias_ml&quot; database table. This basically means that all <a href="../../Technical-manual/3.10/Features/Multi-language-support-for-URL-aliases.html#auto" target="_self">auto-generated URL aliases</a> will be deleted and then created from scratch by using the &quot;updateniceurls.php&quot; script. However, <a href="../../Technical-manual/3.10/Features/Multi-language-support-for-URL-aliases.html#manual" target="_self">manual/user-defined URL aliases</a> and <a href="../../Technical-manual/3.10/Features/Multi-language-support-for-URL-aliases.html#history" target="_self">URL history entries</a> cannot be regenerated automatically. Instead, these items will be transfered/migrated into a temporary table in the database (hereinafter called &quot;migration table&quot;) and then restored at a later stage. This must be done by using the &quot;migrate.php&quot; script, which is included in the &quot;ezurlaliasmigration&quot; extension. This new extension is included in Exponential 3.10.1 and provides tools for the purpose of URL alias migration. (Note that the &quot;ezurlaliasmigration&quot; extension was added to Exponential 4.0.1 as well.)</p> <p>Follow the instructions below in order to update your URL aliases.</p>  <a name="eztoc96179_3_5_1" id="eztoc96179_3_5_1"></a><h4>1. Create a database backup.</h4> <p>Before you continue, create a backup of your database (or at least make sure that you have a backup of the &quot;ezurlalias_ml&quot; table itself).</p>   <a name="eztoc96179_3_5_2" id="eztoc96179_3_5_2"></a><h4>2. Review your configuration settings.</h4> <p>In Exponential 3.10.1 the default type of URL transformation was changed from &quot;urlalias_iri&quot; to &quot;urlalias&quot;. Because of this, you must review your URL alias configuration settings as described below.</p>
<ul>
 <li><div> If the &quot;<a href="../../Technical-manual/3.10/Reference/Configuration-files/site.ini/URLTranslator/TransformationGroup.html" target="_self">TransformationGroup</a>&quot; directive is present in either global override for &quot;site.ini&quot; or &quot;settings/siteaccess/&lt;your_siteaccess&gt;/site.ini.append.php&quot; for all siteaccesses, no configuration changes are required. </div></li> <li><div> Otherwise, your site makes use of the default type of URL transformation. In Exponential 3.10.0, it was &quot;urlalias_iri&quot;. When upgrading to 3.10.1, you must explicitly specify &quot;urlalias_iri&quot; using the &quot;TransformationGroup&quot; directive located in the [URLTranslator] section of either &quot;settings/siteaccess/&lt;your_siteaccess&gt;/site.ini.append.php&quot; (for each siteaccess) or &quot;settings/override/site.ini.append.php&quot; (if all your siteaccesses are using the same database). </div></li> 
</ul>
 <p>In other words, make sure that your existing URL alias configuration does not change because of the new default value of the &quot;<a href="../../Technical-manual/3.10/Reference/Configuration-files/site.ini/URLTranslator/TransformationGroup.html" target="_self">TransformationGroup</a>&quot; directive introduced in 3.10.1. Without this, there might be some broken or inconsistent URLs on your site after upgrading to 3.10.1.</p>   <a name="eztoc96179_3_5_3" id="eztoc96179_3_5_3"></a><h4>3. Enable the &quot;ezurlaliasmigration&quot; extension.</h4> <p>The &quot;ezurlaliasmigration&quot; extension must be enabled for all of your siteaccesses. To do this, edit the &quot;site.ini.append.php&quot; file located in the &quot;settings/override&quot; directory and add the following line under the [ExtensionSettings] section:</p> <pre class="wordwrap"><span class="line">ActiveExtensions[]=ezurlaliasmigration</span>
</pre> <p>Alternatively, you can enable the extension separately for each siteaccess. To do this, edit the &quot;site.ini.append.php&quot; file located in the &quot;settings/siteaccess/example&quot; directory (replace &quot;example&quot; with the name of the target siteaccess) and add the following line under the [ExtensionSettings] section:</p> <pre class="wordwrap"><span class="line">ActiveAccessExtensions[]=ezurlaliasmigration</span>
</pre>   <a name="eztoc96179_3_5_4" id="eztoc96179_3_5_4"></a><h4>4. Proceed with updating your URL aliases.</h4> <p>In order to update your URL aliases, you need to do the following:</p>
<ul>
 <li><div> Create the migration table. </div></li> <li><div> Transfer your URL aliases to the migration table. </div></li> <li><div> Remove old URL alias data. </div></li> <li><div> Create new auto-generated URL aliases. </div></li> <li><div> Restore migrated URL data. </div></li> 
</ul>
 <p>When upgrading from 3.10.0 to 3.10.1, these operations are exactly the same as when upgrading from version 4.0.0 to 4.0.1. Read the corresponding subsections of the &quot;Upgrading from 4.0.x to 4.0.y&quot; documentation page starting from &quot;<a href="../Upgrading-to-4.0/from-4.0.x-to-4.0.html#create_migration_table" target="_self">4. Create the migration table</a>&quot;.</p>    <a name="eztoc96179_3_6" id="eztoc96179_3_6"></a><h3>Binary files uploaded via WebDAV (optional)</h3> <p>In Exponential 3.10.0, there is a bug in the &quot;<a href="../../Technical-manual/3.10/Reference/Datatypes/File.html" target="_self">File</a>&quot; datatype which may cause problems with binary file uploading via WebDAV. The typical symptoms are that the file extension of the uploaded file is missing and that you may not be able to download the file once it is uploaded (refer to <a href="http://issues.ez.no/9450" target="_blank">http://issues.ez.no/9450</a> for more information). The same bug exists in Exponential 3.9.4 and earlier versions. This issue was fixed in Exponential 3.9.5, 3.10.1 and 4.0.0.</p> <p>If your site has objects that were created by uploading files via WebDAV and you have configured <a href="../../Technical-manual/3.10/Features/WebDAV.html#mapping_mime_types" target="_self">MIME-type-to-class mapping</a> using the &quot;MimeClassMap[]&quot; directive in an override for &quot;upload.ini&quot;, you need to run the &quot;updatebinaryfile.php&quot; script in order to fix the file extensions. (If a content class does not have any attributes that make use of the &quot;File&quot; datatype, instances of this class are not affected.)</p> <p>Refer to the <a href="from-3.9.x-to-3.10.html#updatebinaryfile" target="_self">corresponding part</a> of the &quot;Upgrading from 3.9.x to 3.10.y&quot; documentation page for instructions about how to run the &quot;updatebinaryfile.php&quot; script.</p>   <a name="eztoc96179_3_7" id="eztoc96179_3_7"></a><h3>Changes to system upgrade scripts (optional)</h3> <p>If your solution was initially built on Exponential 3.9 or an earlier version and then upgraded to 3.10.0, read this part carefully. Otherwise, skip this part.</p> <p>The &quot;updatevatcountries.php&quot; upgrade script in Exponential 3.10.0 contains a bug. The same bug exists in Exponential 3.9.4 and 3.9.3 (refer to <a href="http://issues.ez.no/11955" target="_blank">http://issues.ez.no/11955</a> for more information). The updated version of the script is available in Exponential 3.9.5, 3.10.1 and 4.0.0. If you previously upgraded to 3.10.0 using the original version of the script, you need to run the updated version of the script when upgrading from 3.10.0 to 3.10.1. Refer to the <a href="from-3.9.x-to-3.10.html#updatevatcountries" target="_self">corresponding part</a> of the &quot;Upgrading from 3.9.x to 3.10.y&quot; documentation page for instructions about how to run the &quot;updatevatcountries.php&quot; script.</p> <p>If you are running Exponential on Windows, note that in Exponential 3.10.0 there is a bug in the &quot;updatetipafriendpolicy.php&quot; upgrade script that prevents it from granting access to the &quot;Tip a friend&quot; feature to the users. The same bug exists in Exponential 3.9.3 - 3.9.4 and 3.8.9 - 3.8.10 (refer to <a href="http://issues.ez.no/11663" target="_blank">http://issues.ez.no/11663</a> for more information). The updated version of the script is available in Exponential 3.9.5, 3.10.1 and 4.0.0. Windows users that previously upgraded to 3.10.0 using the original version of the script are encouraged to re-run this script when upgrading from 3.10.0 to 3.10.1. Refer to the <a href="from-3.9.x-to-3.10.html#updatetipafriendpolicy" target="_self">corresponding part</a> of the &quot;Upgrading from 3.9.x to 3.10.y&quot; documentation page for instructions about how to run the &quot;updatetipafriendpolicy.php&quot; script.</p>    <a name="eztoc96179_4" id="eztoc96179_4"></a><h2>Step 4: Updating the system configuration</h2> <p>You are not required to do any configuration changes when upgrading from 3.10.0 to 3.10.1. </p>  <a name="eztoc96179_4_8" id="eztoc96179_4_8"></a><h3>Tree menu configuration (optional)</h3> <p>Exponential 3.10.1 introduces some changes to the dynamic tree menu functionality. In particular, the &quot;<a href="../../Technical-manual/3.10/Reference/Modules/content/Views/treemenu.html" target="_self">treemenu</a>&quot; view of the &quot;content&quot; module no longer makes use of parameters that are transferred using GET variables (this improves tree menu compatibility when running PHP in <a href="http://en.wikipedia.org/wiki/Fastcgi" target="_blank">FastCGI</a> mode; refer to <a href="http://issues.ez.no/11806" target="_blank">http://issues.ez.no/11806</a> for more information).</p> <p>If you have instructed Apache to use &quot;index_treemenu.php&quot; instead of &quot;index.php&quot; when the treemenu view of the content module is requested, this feature will stop working after upgrading to version 3.10.1. To make it work, update your rewrite rules as described below.</p> <p>If your &quot;<a href="http://en.wikipedia.org/wiki/.htaccess" target="_blank">.htaccess</a>&quot; file contains the following line:</p> <pre class="wordwrap"><span class="line">RewriteRule content/treemenu/?$ index_treemenu.php</span>
</pre> <p>you need to remove &quot;$&quot; from there. The updated line should look like this:</p> <pre class="wordwrap"><span class="line">RewriteRule content/treemenu/? index_treemenu.php</span>
</pre> <p>If no &quot;.htaccess&quot; file is used, check whether the following line is present in your Apache configuration file:</p> <pre class="wordwrap"><span class="line">RewriteRule content/treemenu/?$ /index_treemenu.php [L]</span>
</pre> <p>If found, remove &quot;$&quot; from this line. The result will look like this:</p> <pre class="wordwrap"><span class="line">RewriteRule content/treemenu/? /index_treemenu.php [L]</span>
</pre> <p>Note that due to a bug in Exponential 3.10.1, you need to download the updated version of &quot;index_treemenu.php&quot; from <a href="https://github.com/ezsystems/exponential-legacy/blob/master/index_treemenu.php" target="_blank">http://pubsvn.ez.no</a> and replace the corresponding file in your installation. The same <a href="http://issues.ez.no/13528" target="_blank">bug</a> exists in Exponential 4.0.1.</p>    <a name="eztoc96179_5" id="eztoc96179_5"></a><h2>Step 5: Clearing the caches</h2> <p>Whenever an Exponential solution is upgraded, all caches must be cleared in a proper way. This should be done from within a system shell:</p> 
<ol>
 <li><div> Navigate into the Exponential 3.10.1 directory. </div></li> <li><div> 
Run the script using the following shell command:<br /> <pre class="wordwrap"><span class="line">php bin/php/ezcache.php --clear-all --purge</span>
</pre>  </div></li> 
</ol>
 <p>Purging ensures that the caches are physically removed. When the &quot;--purge&quot; parameter is not specified, the caches will be expired but not removed.</p> <p>Sometimes the script is unable to clear all cache files because of restrictive file/directory permission settings. Make sure that all cache files have been cleared by inspecting the contents of the various cache subdirectories within the &quot;var&quot; directory (typically &quot;var/cache/&quot; and &quot;var/&lt;name_of_siteaccess&gt;/cache/&quot; directories). If there are any cache files left, you need to remove them manually.</p> 




<address>
Powered by <a href="http://ez.no/exponential" title="Exponential&trade; CMS Open Source Web Content Management">Exponential&trade; CMS Open Source Web Content Management</a>. Copyright &copy; 1999-2013 <a href="http://ez.no/" title="eZ Systems AS">eZ Systems AS</a> (except where otherwise noted). All rights reserved.
</address>


</body>

<!-- Mirrored from doc.ez.no/doc_hidden/layout/set/full/layout/set/full/Exponential/Upgrading/Upgrading-to-3.10/from-3.10.x-to-3.10.y by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 31 Jan 2017 23:43:14 GMT -->
</html>
